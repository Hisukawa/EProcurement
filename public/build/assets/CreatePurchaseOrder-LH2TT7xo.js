import{a,u as L,j as e,H as M}from"./app-LfMCLqwU.js";import"./Dropdown-D7C0naGa.js";import"./toaster-B0JEbWJx.js";import{D as S,a as C,b as D,c as P,d as O,e as F}from"./dialog-BBhguyz6.js";import{B as c}from"./button-nnpcbEsU.js";import{A as Q}from"./ApproverLayout-C1so-X6z.js";import{T as $}from"./triangle-alert-COt5otoa.js";import"./transition-jwGWCpDe.js";import"./use-toast-C4OTCvr6.js";import"./index-BLL_YMKG.js";import"./index-CqkR9r7Y.js";import"./createLucideIcon-BuIiU6c-.js";import"./utils-DBc7E8Ow.js";import"./index-Q-4oXGeN.js";import"./index-Vf4ZGyQN.js";import"./index-DjMSlEdA.js";import"./XMarkIcon-X8B6ni_0.js";import"./file-text-BfWB7Pj5.js";import"./BellAlertIcon-Bk4-wOo5.js";function oe({pr:j,rfq:q,suppliers:_,winners:l}){const y=a.useMemo(()=>[...new Set(l.map(t=>t.supplier_id))],[l]),h=a.useMemo(()=>_.filter(t=>y.includes(t.id)),[_,y]),[I,b]=a.useState(!1),[N,v]=a.useState(null),[g,f]=a.useState(""),[R,m]=a.useState(!1),T=t=>{const i=l.filter(r=>r.supplier_id===t),o=new Set(l.map(r=>r.supplier_id)).size>1;return i.map(r=>{const d=o&&r.unit_price_edited!=null,s=Number(d?r.unit_price_edited:r.unit_price);return{pr_detail_id:r.pr_detail_id,item:r.item,specs:r.specs,unit:r.unit,quantity:r.quantity,unit_price:s,total_price:Number(r.quantity)*s,priceSource:d?"As Calculated Price":"Quoted Price",supplier_id:t,supplier_total:r.supplier_total??null}})},{data:n,setData:p,post:E,processing:u,errors:x}=L({rfq_id:q.id,items:[]});a.useEffect(()=>{const t=h.flatMap(i=>T(i.id));p("items",t)},[h]);const k=()=>{if(!N)return;const{index:t,field:i,value:o}=N,r=[...n.items];r[t][i]=o,r[t].total_price=Number(r[t].quantity)*Number(r[t].unit_price),r[t].change_reason=g,p("items",r),v(null),f(""),b(!1)},w=t=>{t.preventDefault(),m(!0)},A=()=>{E(route("bac_user.store_po"),{onFinish:()=>m(!1)})};return e.jsxs(Q,{header:"Schools Divisions Office - Ilagan | Create Purchase Order",children:[e.jsx(M,{title:`Create PO for PR #${j.pr_number}`}),e.jsxs("form",{onSubmit:w,className:"bg-white p-6 rounded shadow mx-auto max-w-6xl",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Create PO for PR #",j.pr_number]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"mode_of_procurement",className:"block font-semibold mb-2",children:["Mode of Procurement ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"mode_of_procurement",name:"mode_of_procurement",value:n.mode_of_procurement||"",onChange:t=>p("mode_of_procurement",t.target.value),className:"border rounded px-3 py-2 w-full",placeholder:"Enter mode of procurement...",required:!0}),x.mode_of_procurement&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:x.mode_of_procurement})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"delivery_term",className:"block font-semibold mb-2",children:["Delivery Term ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"delivery_term",name:"delivery_term",value:n.delivery_term||"",onChange:t=>p("delivery_term",t.target.value),className:"border rounded px-3 py-2 w-full",placeholder:"Enter Delivery Term...",required:!0}),x.delivery_term&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:x.delivery_term})]}),h.map(t=>{var r,d;const i=n.items.filter(s=>s.supplier_id===t.id);(r=i.find(s=>s.supplier_total!==null))==null||r.supplier_total;const o=((d=l.find(s=>s.supplier_id===t.id))==null?void 0:d.supplier_total)||i.reduce((s,U)=>s+Number(U.total_price),0);return e.jsxs("div",{className:"mb-8 border rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 font-semibold text-lg",children:["Supplier: ",t.company_name]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-separate border-spacing-0 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-y border-l px-4 py-2 text-left",children:"Item"}),e.jsx("th",{className:"border-y px-4 py-2 text-left",children:"Specs"}),e.jsx("th",{className:"border-y px-4 py-2 text-center",children:"Unit"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Total Price"})]})}),e.jsxs("tbody",{children:[i.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-b border-l px-4 py-2",children:s.item}),e.jsx("td",{className:"border-b px-4 py-2 text-gray-600",children:s.specs}),e.jsx("td",{className:"border-b px-4 py-2 text-center",children:s.unit}),e.jsx("td",{className:"border-b px-4 py-2 text-right",children:s.quantity}),e.jsxs("td",{className:"border-b px-4 py-2 text-right",children:["₱",Number(s.unit_price).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),e.jsx("div",{className:`text-xs ${s.priceSource==="Quoted Price"?"text-green-600":"text-gray-500"}`,children:s.priceSource})]}),e.jsxs("td",{className:"border-b px-4 py-2 text-right",children:["₱",(s.unit_price*s.quantity).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},`${t.id}-${s.pr_detail_id}`)),e.jsxs("tr",{className:"bg-gray-100 font-semibold",children:[e.jsx("td",{colSpan:"5",className:"border-t px-4 py-2 text-right",children:"Supplier Total:"}),e.jsxs("td",{className:"border-t border-r px-4 py-2 text-right",children:["₱",o.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]},t.id)}),e.jsx(c,{type:"submit",disabled:u||n.items.length===0,className:"mt-6",children:u?"Submitting...":"Submit Purchase Order"})]}),e.jsx(S,{open:R,onOpenChange:m,children:e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx($,{className:"text-yellow-500"}),"Confirm Submission"]}),e.jsx(O,{className:"pt-4 text-base",children:"Are you sure you want to create this Purchase Order? Please review the items and quantities before proceeding."})]}),e.jsxs(F,{children:[e.jsx(c,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{onClick:A,disabled:u,className:"bg-green-600 hover:bg-green-700",children:u?"Submitting...":"Confirm & Create PO"})]})]})}),e.jsx(S,{open:I,onOpenChange:b,children:e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsx(P,{children:"Reason for Quantity Change"}),e.jsx(O,{className:"pt-2",children:"You changed the quantity from the original PR. Please provide a reason for this adjustment."})]}),e.jsx("textarea",{value:g,onChange:t=>f(t.target.value),className:"w-full border rounded px-3 py-2 mt-3",rows:"3",placeholder:"Enter reason..."}),e.jsxs(F,{children:[e.jsx(c,{variant:"outline",onClick:()=>{b(!1),v(null),f("")},children:"Cancel"}),e.jsx(c,{onClick:k,disabled:!g.trim(),className:"bg-blue-600 hover:bg-blue-700",children:"Save Change"})]})]})})]})}export{oe as default};
