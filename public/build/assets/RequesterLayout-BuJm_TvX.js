import{a as t,b as T,j as e,L as E,d as w}from"./app-B7_UX2sh.js";import{N as j,D as x}from"./Dropdown-Cr-ssEUb.js";import{l as M,F as U,T as Y}from"./toaster-CYWm_-9N.js";import{F as W,d as q}from"./index-iU02Ez0U.js";import{F,a as G}from"./XMarkIcon-5mCUXE4W.js";function J({title:l,titleId:n,...d},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},d),l?t.createElement("title",{id:n},l):null,t.createElement("path",{fillRule:"evenodd",d:"M9 1.5H5.625c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5Zm6.61 10.936a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 14.47a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}),t.createElement("path",{d:"M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"}))}const K=t.forwardRef(J);function Q({title:l,titleId:n,...d},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},d),l?t.createElement("title",{id:n},l):null,t.createElement("path",{fillRule:"evenodd",d:"M11.986 3H12a2 2 0 0 1 2 2v6a2 2 0 0 1-1.5 1.937V7A2.5 2.5 0 0 0 10 4.5H4.063A2 2 0 0 1 6 3h.014A2.25 2.25 0 0 1 8.25 1h1.5a2.25 2.25 0 0 1 2.236 2ZM10.5 4v-.75a.75.75 0 0 0-.75-.75h-1.5a.75.75 0 0 0-.75.75V4h3Z",clipRule:"evenodd"}),t.createElement("path",{fillRule:"evenodd",d:"M3 6a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H3Zm1.75 2.5a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5h-3.5ZM4 11.75a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 0 1.5h-3.5a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}const X=t.forwardRef(Q);function ee({title:l,titleId:n,...d},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},d),l?t.createElement("title",{id:n},l):null,t.createElement("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm.75-10.25v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5a.75.75 0 0 1 1.5 0Z",clipRule:"evenodd"}))}const se=t.forwardRef(ee);function ie({header:l,children:n}){const{user:d}=T().props.auth,[o,D]=t.useState(new Date),[y,_]=t.useState(!1),[I,R]=t.useState(!1),[c,k]=t.useState([]),[A,P]=t.useState(""),[Z,C]=t.useState(!1),[ae,te]=t.useState(0),[b,$]=t.useState(!1),[z,g]=t.useState(!1),[B,H]=t.useState(""),N=t.useRef(null),S=c.filter(s=>!s.read).length;t.useEffect(()=>{const s=setInterval(()=>D(new Date),1e3);return()=>clearInterval(s)},[]),t.useEffect(()=>{const s=async()=>{var h;try{const m=(await w.get("/notifications",{timeout:1e4})).data.map(r=>({...r,read:r.read_at!==null})),f=m.filter(r=>!r.read).length,p=c.filter(r=>!r.read).length;if(b&&f>p){const r=m.find(u=>!u.read);if(r){const u=((h=r.data)==null?void 0:h.message)||r.message||"📬 You have a new purchase request update!";O(u)}}k(m),b||$(!0)}catch(i){w.isCancel(i)?console.log("Request canceled:",i.message):console.error("Error fetching notifications:",i)}};s();const a=setInterval(s,1e4);return()=>clearInterval(a)},[b]),t.useEffect(()=>{function s(a){N.current&&!N.current.contains(a.target)&&R(!1)}return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const O=s=>{P(s),C(!0),setTimeout(()=>C(!1),1e4)};o.toLocaleString("en-PH",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0});const V=async(s,a)=>{var h,i,m,f,p;try{await w.post(`/notifications/${s}/read`);const r=((h=a==null?void 0:a.data)==null?void 0:h.type)||"",u=r==="send_back"||(a==null?void 0:a.type)==="App\\Notifications\\PurchaseRequestSentBack",L=r==="rejected"||(a==null?void 0:a.type)==="App\\Notifications\\PurchaseRequestRejected",v=((i=a==null?void 0:a.data)==null?void 0:i.pr_id)||((m=a==null?void 0:a.data)==null?void 0:m.prID)||((f=a==null?void 0:a.data)==null?void 0:f.pr_id_fk);if(u&&v){q.Inertia.visit(route("requester.add_details",v),{preserveScroll:!0});return}if(L&&v){q.Inertia.visit(route("requester.add_details",v),{preserveScroll:!0});return}if(L){H(((p=a.data)==null?void 0:p.reason)||"No reason provided."),g(!0);return}}catch(r){console.error("Failed to mark notification as read:",r)}};return e.jsxs(e.Fragment,{children:[Z&&e.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[9999] bg-indigo-600 text-white px-6 py-4 rounded-lg shadow-lg text-center text-lg animate-fade-in-out",children:A}),e.jsxs("div",{className:"min-h-screen flex flex-col md:flex-row bg-gray-100",children:[e.jsxs("div",{className:"md:hidden bg-gray-900 text-white flex items-center justify-between px-4 py-3 shadow-md",children:[e.jsx(E,{href:"/",children:e.jsx("img",{src:M,alt:"Logo",className:"h-10 w-auto"})}),e.jsx("button",{onClick:()=>_(!y),className:"focus:outline-none",children:y?e.jsx(F,{className:"h-6 w-6"}):e.jsx(G,{className:"h-6 w-6"})})]}),e.jsx("aside",{className:`${y?"block":"hidden"} md:block md:w-64 w-full bg-gray-900 text-white md:sticky md:top-0 h-screen sticky z-50`,children:e.jsxs("div",{className:"p-6 flex flex-col h-full",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(E,{href:"/",children:e.jsx("img",{src:M,alt:"Department Logo",className:"h-20 w-[200px] object-contain",draggable:"false"})})}),e.jsx("div",{className:"text-center text-xs text-gray-400 font-mono mb-6 select-none",children:"Supply and Property Office"}),e.jsxs("nav",{className:"flex flex-col gap-2",children:[e.jsxs(j,{href:route("requester.dashboard"),active:route().current("requester.dashboard"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Dashboard"})]}),e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs(j,{href:route("requester.create"),active:route().current("requester.create"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(se,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Create PR"})]}),e.jsxs(j,{href:route("requester.manage_requests"),active:route().current("requester.manage_requests"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(X,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Manage Requests"})]}),e.jsxs(j,{href:route("requester.ris_issued"),active:route().current("requester.ris_issued"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(K,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Issued"})]})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("header",{className:"bg-white shadow sticky top-0 z-30 px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:l||"Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"e-Procurement & Inventory Management System"})]}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>R(s=>!s),className:"relative focus:outline-none",children:[e.jsx(W,{className:"w-6 h-6 text-gray-600 hover:text-gray-800"}),S>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full px-1.5 py-0.5",children:S})]}),I&&e.jsxs("div",{ref:N,className:"absolute right-0 top-8 w-96 bg-white border border-gray-200 rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-gray-50 text-sm font-semibold text-gray-700",children:"Notifications"}),c.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-center text-gray-500",children:"You're all caught up!"}):e.jsx("ul",{className:"max-h-[420px] overflow-y-auto divide-y divide-gray-100",children:c.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at)).slice(0,10).map(s=>{var a;return e.jsxs("li",{onClick:()=>V(s.id,s),className:`flex items-start gap-3 px-4 py-3 cursor-pointer hover:bg-gray-50 transition duration-150 ${s.read?"bg-white text-gray-500":"bg-gray-50 text-gray-900 font-semibold"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:s.read?e.jsx("svg",{className:"w-5 h-5 text-gray-300",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 17h5l-1.405-1.405M19.595 15.595A2.1 2.1 0 0120 14.5V11a8.001 8.001 0 00-6.536-7.874m0 0A8 8 0 0119 11v3.5c0 .397.158.779.439 1.06M12.5 21a3.5 3.5 0 01-3.5-3.5"})}):e.jsx("svg",{className:"w-5 h-5 text-indigo-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586L2.707 14.879a1 1 0 001.414 1.414L6 14.414V16a2 2 0 002 2h4a2 2 0 002-2v-1.586l1.879 1.879a1 1 0 001.414-1.414L16 11.586V8a6 6 0 00-6-6z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm leading-tight",children:((a=s.data)==null?void 0:a.message)||s.message||"You have a new notification."}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs",children:[e.jsx("span",{className:"text-gray-400",children:new Date(s.created_at).toLocaleString("en-PH",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),s.read?e.jsx("span",{className:"text-gray-400",children:"Read"}):e.jsx("span",{className:"text-blue-500 font-medium",children:"Unread"})]})]})]},s.id)})}),c.some(s=>!s.read)&&e.jsx("button",{onClick:async()=>{try{await Promise.all(c.map(s=>s.read?null:w.post(`/notifications/${s.id}/read`))),k(s=>s.map(a=>({...a,read:!0})))}catch(s){console.error("Failed to mark all as read:",s)}},className:"w-full text-center py-3 text-sm text-indigo-600 hover:bg-gray-100 border-t",children:"Mark all as read"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(x,{children:[e.jsx(x.Trigger,{children:e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 cursor-pointer",children:[d.firstname," ",d.lastname,e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),e.jsxs(x.Content,{children:[e.jsx(x.Link,{href:route("profile.edit"),children:"Profile"}),e.jsx(x.Link,{href:route("logout"),method:"post",as:"button",children:"Log Out"})]})]})})]})]}),e.jsx("main",{className:"p-6 flex-1 overflow-y-auto bg-gray-300",children:n}),e.jsx(Y,{})]})]}),z&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-[10000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity animate-fadeIn",onClick:()=>g(!1)}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-[90%] max-w-md p-6 animate-scaleIn",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Reason for Send Back"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg border border-gray-200",children:B}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>g(!1),className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-md transition",children:"Close"})})]})]})]})}export{ie as R};
