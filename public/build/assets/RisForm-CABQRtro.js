import{u as $,a as u,j as e}from"./app-duXzzImO.js";import{u as H}from"./use-toast-D7hdoR5h.js";import{D as M,a as L,b as P,c as Q,d as U,e as Y}from"./dialog-DS-DoP21.js";import{B as w}from"./button-D0lWBgCo.js";import{F as G}from"./file-text-CrQxbWaj.js";import{M as J}from"./minus-DSm_5CkB.js";import{S as K}from"./send-horizontal-DHZttDD3.js";import"./index-3jnUzLIS.js";import"./index-CSqca6Ux.js";import"./createLucideIcon-CoZQ0qwL.js";import"./utils-C5BPRwjQ.js";import"./index-CoOSbRev.js";function de({purchaseOrder:o,inventoryItems:k=[],user:x,risNumber:d}){var g,f,j,v,y,N,_;const t=((f=(g=o==null?void 0:o.detail)==null?void 0:g.pr_detail)==null?void 0:f.purchase_request)??null,D=t?`${((j=t==null?void 0:t.focal_person)==null?void 0:j.firstname)??""} ${((v=t==null?void 0:t.focal_person)==null?void 0:v.middlename)??""} ${((y=t==null?void 0:t.focal_person)==null?void 0:y.lastname)??""}`.trim():"N/A",{data:l,setData:n,post:R,processing:p,errors:h}=$({po_id:(o==null?void 0:o.id)??null,ris_number:d??"",requested_by:((N=t==null?void 0:t.focal_person)==null?void 0:N.id)??null,issued_by:(x==null?void 0:x.id)??null,remarks:"",items:k.map(s=>{var a;return{inventory_item_id:s.id,recipient:"",recipient_division:"",quantity:s.total_stock>0?1:0,unit_cost:s.unit_cost??0,total_cost:s.unit_cost??0,total_stock:s.total_stock??0,description:s.item_desc??((a=s.product)==null?void 0:a.item_description)??"N/A"}})}),[S,r]=u.useState(!1),{toast:b}=H();u.useEffect(()=>{d&&!l.ris_number&&n("ris_number",d)},[d]);const C=(s,a,m)=>{const i=[...l.items];{let c=parseFloat(m)||0;c>i[s].total_stock&&(c=i[s].total_stock),i[s].quantity=c,i[s].total_cost=c*(i[s].unit_cost??0)}n("items",i)},I=s=>{const a=l.items.filter((m,i)=>i!==s);n("items",a)},q=s=>{s.preventDefault(),r(!0)},F=()=>{R(route("supply_officer.store_ris"),{preserveScroll:!0,onSuccess:()=>{r(!1),b({title:"RIS Recorded",description:"Requisition and Issue Slip successfully saved!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{b({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})},[z,A]=u.useState(""),[E,T]=u.useState(""),B=s=>{A(s.target.value),n("items",l.items.map(a=>({...a,recipient:s.target.value})))},O=s=>{T(s.target.value),n("items",l.items.map(a=>({...a,recipient_division:s.target.value})))};return e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 mb-4 flex items-center gap-2",children:[e.jsx(G,{size:24})," Requisition and Issue Slip (RIS)"]}),Object.keys(h).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(h).map(([s,a])=>e.jsx("li",{children:a},s))})}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"p-5 border rounded-md bg-blue-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-700 mb-4",children:"Requisition Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{value:((_=t==null?void 0:t.division)==null?void 0:_.division)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RIS No."}),e.jsx("input",{type:"text",value:l.ris_number,onChange:s=>n("ris_number",s.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested By"}),e.jsx("input",{value:D,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]})]})]}),l.items.map((s,a)=>e.jsxs("div",{className:"p-5 border rounded-md bg-green-50 relative",children:[l.items.length>1&&e.jsx("button",{type:"button",onClick:()=>I(a),className:"absolute top-2 right-2 text-red-600 hover:text-red-800",children:e.jsx(J,{size:20})}),e.jsxs("h3",{className:"text-lg font-semibold text-green-700 mb-4",children:["Item ",a+1]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("input",{value:s.description,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:s.total_stock,value:s.quantity,onChange:m=>C(a,"quantity",m.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),e.jsx("input",{type:"number",value:s.unit_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),e.jsx("input",{type:"number",value:s.total_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-gray-50"})]})]})]})]},a)),e.jsxs("div",{className:"p-5 border rounded-md bg-yellow-50 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-700 mb-4",children:"Default Recipient (applied to all items)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Name"}),e.jsx("input",{type:"text",value:z,onChange:B,placeholder:"Leave blank to issue to requester",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Division"}),e.jsx("input",{type:"text",value:E,onChange:O,placeholder:"Optional",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:l.remarks,onChange:s=>n("remarks",s.target.value),rows:"4",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm",placeholder:"Optional"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",disabled:p,children:[e.jsx(K,{size:16,className:"mr-2"})," ",p?"Saving...":"Submit Issuance"]})})]}),e.jsx(M,{open:S,onOpenChange:r,children:e.jsxs(L,{className:"sm:max-w-md",children:[e.jsxs(P,{children:[e.jsx(Q,{children:"Confirm Issuance"}),e.jsx(U,{children:"Are you sure you want to record this RIS issuance?"})]}),e.jsxs(Y,{className:"mt-4 flex justify-end gap-2",children:[e.jsx(w,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"}),e.jsx(w,{onClick:F,children:"Yes, Record RIS"})]})]})})]})}export{de as default};
