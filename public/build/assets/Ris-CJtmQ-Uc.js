import{r as _,j as e,H as O,L as J}from"./app-z2zUCIH2.js";import{I as U}from"./IssuanceTabs--S0mGmWN.js";import{S as z}from"./SupplyOfficerLayout-BfXjfZkg.js";import{P as G}from"./printer-check-D4e9EvtI.js";import"./Dropdown-DTp9JO5b.js";import"./transition-Mdjj0t_f.js";import"./toaster-De5hWt1k.js";import"./use-toast-Byxe34qQ.js";import"./index-CMYY62sn.js";import"./index-BPRSbHGy.js";import"./createLucideIcon-B5xgoSjl.js";import"./utils-Cf4Ri238.js";import"./index-ZeHC1oZz.js";import"./XMarkIcon--6nDV5HQ.js";import"./clipboard-check-DtUsxnJ2.js";import"./package-check-DGQj4OaT.js";function me({purchaseOrders:Q,inventoryItems:T,ris:r,user:W}){var I,R,L;const[c,$]=_.useState(""),[d,k]=_.useState(""),[m,P]=_.useState(new Date().getFullYear()),[A,Y]=_.useState([]),E=t=>{Y(i=>i.includes(t)?i.filter(p=>p!==t):[...i,t])};new Map(T.map(t=>{var i;return[`${t.item_desc}_${(i=t.inventory)==null?void 0:i.unit}`,t.inventory]}));const S=new Map;(I=r==null?void 0:r.data)==null||I.forEach(t=>{const i=`${t.po_id}_${t.inventory_item_id}`;S.has(i)||S.set(i,[]),S.get(i).push(t)});const C=((R=r==null?void 0:r.data)==null?void 0:R.filter(t=>{var x,h,u,y,j,f,s,a,g,b,M,q,D;const i=((x=t.ris_number)==null?void 0:x.toLowerCase())??"",p=`${((h=t.issued_to)==null?void 0:h.firstname)??""} ${((u=t.issued_to)==null?void 0:u.lastname)??""}`.toLowerCase(),l=((b=(g=(a=(s=(f=(j=(y=t.po)==null?void 0:y.details)==null?void 0:j[0])==null?void 0:f.pr_detail)==null?void 0:s.purchase_request)==null?void 0:a.division)==null?void 0:g.division)==null?void 0:b.toLowerCase())??"",n=(M=t.items)==null?void 0:M.map(H=>{var F;return((F=H.inventory_item)==null?void 0:F.item_desc)??""}).join(" ").toLowerCase(),N=i.includes(c.toLowerCase())||p.includes(c.toLowerCase())||l.includes(c.toLowerCase())||n.includes(c.toLowerCase()),o=(D=(q=t.items)==null?void 0:q[0])!=null&&D.created_at?new Date(t.items[0].created_at):null,v=d?o&&o.getMonth()+1===parseInt(d):!0,w=m?o&&o.getFullYear()===parseInt(m):!0;return N&&v&&w}))||[];return e.jsxs(z,{header:"Schools Divisions Office - Ilagan | Requisition and Issue Slip",children:[e.jsx(O,{title:"RIS"}),e.jsx(U,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Requisition and Issue Slip (RIS)"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{onClick:()=>window.location.href=route("supply_officer.export_excel"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Report for this Month"}),e.jsx("button",{onClick:()=>{const t=new URLSearchParams;d&&t.append("month",d),m&&t.append("year",m),window.location.href=route("supply_officer.generate_report")+"?"+t.toString()},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-7 py-1 text-sm",value:d,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map((t,i)=>e.jsx("option",{value:i+1,children:t},i))]}),e.jsx("label",{className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-20 text-sm",value:m,onChange:t=>P(t.target.value)})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search Focal Person, RIS number...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm",value:c,onChange:t=>$(t.target.value)})})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-semibold uppercase tracking-wider text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"#"}),e.jsx("th",{className:"px-4 py-2",children:"RIS No."}),e.jsx("th",{className:"px-4 py-2",children:"Division"}),e.jsx("th",{className:"px-4 py-2",children:"Issued To/Focal Person"}),e.jsx("th",{className:"px-4 py-2",children:"Item Description"}),e.jsx("th",{className:"px-4 py-2",children:"Quantity"}),e.jsx("th",{className:"px-4 py-2",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-2",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-2",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:C.length>0?C.map((t,i)=>{var N,o,v,w,x,h,u,y,j,f;const p=((N=t.items)==null?void 0:N.length)>2,l=A.includes(t.id),n=((o=t.items)==null?void 0:o.map(s=>{var a,g,b;return{description:((a=s.inventory_item)==null?void 0:a.item_desc)??"N/A",quantity:s.quantity,unitCost:Number(((g=s.inventory_item)==null?void 0:g.unit_cost)??0),totalCost:Number(((b=s.inventory_item)==null?void 0:b.unit_cost)??0)*s.quantity,date:new Date(s.created_at).toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric"})}}))||[];return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:i+1}),e.jsx("td",{className:"px-4 py-2",children:t.ris_number}),e.jsx("td",{className:"px-4 py-2",children:((y=(u=(h=(x=(w=(v=t.po)==null?void 0:v.details)==null?void 0:w[0])==null?void 0:x.pr_detail)==null?void 0:h.purchase_request)==null?void 0:u.division)==null?void 0:y.division)??"N/A"}),e.jsxs("td",{className:"px-4 py-2",children:[(j=t.requested_by)==null?void 0:j.firstname," ",(f=t.requested_by)==null?void 0:f.lastname]}),e.jsxs("td",{className:"px-4 py-2",children:[n.slice(0,2).map((s,a)=>e.jsx("div",{children:s.description},a)),p&&!l&&e.jsxs("button",{onClick:()=>E(t.id),className:"text-blue-600 hover:underline text-sm mt-1",children:["+",n.length-2," more"]}),l&&n.slice(2).map((s,a)=>e.jsx("div",{children:s.description},a+2))]}),e.jsxs("td",{className:"px-4 py-2",children:[n.slice(0,2).map((s,a)=>e.jsx("div",{children:s.quantity},a)),l&&n.slice(2).map((s,a)=>e.jsx("div",{children:s.quantity},a+2))]}),e.jsxs("td",{className:"px-4 py-2",children:[n.slice(0,2).map((s,a)=>e.jsxs("div",{children:["₱",s.unitCost.toFixed(2)]},a)),l&&n.slice(2).map((s,a)=>e.jsxs("div",{children:["₱",s.unitCost.toFixed(2)]},a+2))]}),e.jsxs("td",{className:"px-4 py-2",children:[n.slice(0,2).map((s,a)=>e.jsxs("div",{children:["₱",s.totalCost.toFixed(2)]},a)),l&&n.slice(2).map((s,a)=>e.jsxs("div",{children:["₱",s.totalCost.toFixed(2)]},a+2))]}),e.jsxs("td",{className:"px-4 py-2",children:[n.slice(0,2).map((s,a)=>e.jsx("div",{children:s.date},a)),l&&n.slice(2).map((s,a)=>e.jsx("div",{children:s.date},a+2))]}),e.jsxs("td",{className:"px-4 py-2 text-center space-x-2 flex",children:[e.jsxs("a",{href:route("supply_officer.print_ris",t.id),className:"bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700 transition flex items-center justify-center gap-1",target:"_blank",children:[e.jsx(G,{size:16})," Print"]}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-2 rounded",children:"Switch Type"})]})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center",children:"No RIS records found"})})})]})}),((L=r==null?void 0:r.links)==null?void 0:L.length)>3&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:r.links.map((t,i)=>e.jsx(J,{href:t.url||"#",className:`
                  px-3 py-1 text-sm rounded-md
                  ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
                  ${!t.url&&"opacity-50 cursor-not-allowed"}
                `,dangerouslySetInnerHTML:{__html:t.label}},i))})]})]})}export{me as default};
