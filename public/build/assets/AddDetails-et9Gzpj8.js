import{u as W,a,j as e,H as X,c as Y}from"./app-2dY0mcfJ.js";import{R as Z}from"./RequesterLayout-Q1PZDWC9.js";import{D as c,a as d,b as x,c as u,d as p,e as h}from"./dialog-BOrtGsCV.js";import{B as l}from"./button-lZCF6GJV.js";import{F as $}from"./PencilSquareIcon-CvchwK8u.js";import{T as ee}from"./trash-CyNsZTg2.js";import"./Dropdown-7J_2QaEs.js";import"./transition-CcrEs0gU.js";import"./toaster-CGUaQDjW.js";import"./use-toast-DLLEHaaE.js";import"./index-t44Pv__V.js";import"./index-ptG2qq3X.js";import"./createLucideIcon-BSM3CWrD.js";import"./utils-C_hDN855.js";import"./index-6nanuBrI.js";import"./index-Cz20RxEC.js";import"./XMarkIcon-3E_2Wiyu.js";import"./BellAlertIcon-DwMWr0_X.js";import"./index-BT060lhp.js";function ve({prId:_,products:S,pr_number:g,prDetails:b,purpose:P,sendBackReason:N,units:w,rejectionReason:se}){const{data:t,setData:n,post:O,put:D,processing:te,errors:f,reset:E}=W({id:null,pr_number:g,product_id:"",item:"",specs:"",unit_id:"",custom_unit:"",unit_price:"",quantity:"",purpose:P||""}),[F,o]=a.useState(!1),[A,q]=a.useState(!1),[R,m]=a.useState(!1),[k,U]=a.useState(null),[T,v]=a.useState(!1),H=s=>{const r=b.find(i=>i.product_id==s);if(r)n({...t,product_id:r.product_id,item:r.item,specs:r.specs,unit_id:r.unit_id,custom_unit:"",unit_price:r.unit_price,quantity:r.quantity}),o(!0);else{const i=S.find(y=>y.id==s);i&&(n({...t,product_id:i.id,item:i.name,specs:i.specs,unit_id:i.unit_id||"",custom_unit:"",unit_price:i.default_price||"",quantity:""}),o(!0))}},L=()=>{const s=t.custom_unit.trim();let r=t.unit_id;if(s){const I=w.find(V=>V.unit.toLowerCase()===s.toLowerCase());I?(r=I.id,n("custom_unit","")):r=""}if(!r&&!s&&(t.unit_id||console.warn("No unit selected or entered.")),!t.quantity)return;const i=t.id?route("requester.update_details",t.id):route("requester.store_details",_);(t.id?D:O)(i,{preserveScroll:!0,data:{...t,unit_id:r,purpose:t.purpose},onSuccess:()=>{o(!1),E()}})},M=s=>{n({...t,id:s.id,product_id:s.product_id,item:s.item,specs:s.specs,unit_id:s.unit_id,custom_unit:"",unit_price:s.unit_price,quantity:s.quantity}),o(!0)},Q=s=>{s&&s.id?(U(s.id),m(!0)):console.error("Error: Invalid detail provided for deletion")},B=()=>{k?Y.delete(route("requester.delete_details",{detailId:k}),{preserveScroll:!0,onSuccess:()=>{m(!1),v(!0)},onError:s=>{console.error("Delete failed:",s),m(!1)}}):console.error("Error: No valid ID provided for deletion.")},z=()=>{j(!0)},G=()=>{D(route("requester.update_purpose",_),{preserveScroll:!0,data:{purpose:t.purpose},onSuccess:()=>{j(!1),C(!0)},onError:s=>{j(!1),alert("Failed to update purpose.")}})},[J,j]=a.useState(!1),[K,C]=a.useState(!1);return e.jsxs(Z,{header:"Schools Division Office - Ilagan | Add Details",children:[e.jsx(X,{title:"PR Details"}),e.jsxs("div",{className:"mx-auto mt-10 bg-white p-10 shadow-2xl",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-8 text-left text-gray-800",children:["Purchase Request Details — ",e.jsx("span",{className:"text-blue-600",children:g})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Purpose"}),e.jsx("textarea",{value:t.purpose,onChange:s=>n("purpose",s.target.value),className:"w-full border rounded px-3 py-1 mt-2",placeholder:"Enter the purpose of the request"}),f.purpose&&e.jsx("p",{className:"text-red-500 mt-1 text-sm",children:f.purpose}),e.jsx("button",{onClick:z,className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded",children:"Save Purpose"})]}),N&&N!==null&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-200 border-l-4 border-yellow-600 text-yellow-800",children:[e.jsx("strong",{children:"Send Back Reason/s: "}),N]}),e.jsx(c,{open:A,onOpenChange:q,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(u,{children:"Finish PR?"})}),e.jsx(p,{children:"Once you finish, you will go back to the request list."}),e.jsxs(h,{children:[e.jsx(l,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>{window.location.href=route("requester.manage_requests")},children:"Confirm"})]})]})}),e.jsx(c,{open:J,onOpenChange:j,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(u,{children:"Save Purpose"})}),e.jsx(p,{children:"Are you sure you want to save the updated purpose?"}),e.jsxs(h,{children:[e.jsx(l,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(l,{onClick:G,children:"Save"})]})]})}),e.jsx(c,{open:R,onOpenChange:m,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(u,{children:"Are you sure?"})}),e.jsx(p,{children:"Delete item? This action cannot be undone."}),e.jsxs(h,{children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(l,{onClick:B,children:"Delete"})]})]})}),e.jsx(c,{open:T,onOpenChange:v,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(u,{className:"text-green-600",children:"Success"})}),e.jsx(p,{children:"Item deleted successfully."}),e.jsx(h,{children:e.jsx(l,{onClick:()=>v(!1),children:"Close"})})]})}),e.jsx(c,{open:K,onOpenChange:C,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(u,{className:"text-green-600",children:"Success"})}),e.jsx(p,{children:"Purpose saved successfully."}),e.jsx(h,{children:e.jsx(l,{onClick:()=>C(!1),children:"Close"})})]})}),e.jsx(c,{open:F,onOpenChange:o,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(u,{children:"Edit Item"})}),e.jsx(p,{children:"Edit the details of the selected item."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Item Name"}),e.jsx("input",{type:"text",value:t.item,onChange:s=>n("item",s.target.value),className:"w-full border rounded px-3 py-1 mt-2"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Specifications"}),e.jsx("textarea",{type:"text",value:t.specs,onChange:s=>n("specs",s.target.value),className:"w-full border rounded px-3 py-1 mt-2 h-32"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Unit"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:t.unit_id,onChange:s=>n("unit_id",s.target.value),className:"w-1/2 border rounded px-3 py-1 mt-2",children:[e.jsx("option",{value:"",children:"-- Select Unit --"}),w.map(s=>e.jsx("option",{value:s.id,children:s.unit},s.id))]}),e.jsx("input",{type:"text",value:t.custom_unit,onChange:s=>n("custom_unit",s.target.value),className:"w-1/2 border rounded px-3 py-1 mt-2",placeholder:"Enter custom unit"})]}),f.unit_id&&e.jsx("p",{className:"text-red-500 mt-1 text-sm",children:f.unit_id})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>n("quantity",s.target.value),className:"w-full border rounded px-3 py-1 mt-2"})]}),e.jsxs(h,{children:[e.jsx(l,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(l,{onClick:L,children:"Save Changes"})]})]})}),e.jsx("div",{className:"overflow-x-auto mb-10",children:e.jsxs("table",{className:"w-full min-w-[700px] border border-gray-300 shadow rounded-lg text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b",children:"Item"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Specs"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Default Unit Price (₱)"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Total (₱)"}),e.jsx("th",{className:"px-4 py-3 border-b text-center",children:"Actions"})]})}),e.jsx("tbody",{children:b.length>0?b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 border-b",children:s.item}),e.jsx("td",{className:"px-4 py-3 border-b",children:s.specs}),e.jsx("td",{className:"px-4 py-3 border-b",children:s.unit}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:s.quantity}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:Number(s.unit_price).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:(Number(s.unit_price)*s.quantity).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs("button",{onClick:()=>M(s),className:"inline-flex items-center px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs(l,{onClick:()=>Q(s),className:"inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Delete"]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-6 text-gray-500",children:"No items added yet."})})})]})}),e.jsxs("h3",{className:"text-2xl font-semibold mb-6 text-center text-gray-700",children:["Add Item to PR ",e.jsx("span",{className:"text-blue-600",children:g})]}),e.jsx("form",{onSubmit:s=>s.preventDefault(),className:"mx-auto space-y-8",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-800",children:"Select a Product"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border border-gray-300 rounded-lg shadow",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Item"}),e.jsx("th",{className:"px-3 py-2 border",children:"Specifications"}),e.jsx("th",{className:"px-3 py-2 border",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 border",children:"Default Price (₱)"}),e.jsx("th",{className:"px-3 py-2 border text-center",children:"Select"})]})}),e.jsx("tbody",{children:S.map(s=>{var i;const r=b.some(y=>y.product_id===s.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 border",children:s.name}),e.jsx("td",{className:"px-3 py-2 border",children:s.specs}),e.jsx("td",{className:"px-3 py-2 border",children:((i=s.unit)==null?void 0:i.unit)||"-"}),e.jsx("td",{className:"px-3 py-2 border",children:Number(s.default_price).toFixed(2)}),e.jsx("td",{className:"px-3 py-2 border text-center",children:r?e.jsx("span",{className:"text-green-600 font-semibold text-xs",children:"Added"}):e.jsx("button",{type:"button",onClick:()=>H(s.id),className:"bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full text-lg font-bold transition",title:"Add Product",children:"+"})})]},s.id)})})]})})]})})]})]})}export{ve as default};
