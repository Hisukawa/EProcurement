import{u as G,a as y,j as e,H as Y,c as Z}from"./app-LfMCLqwU.js";import{S as J}from"./SupplyOfficerLayout-DzVySqH-.js";import{D as R,a as S,b as q,c as D,d as I,e as M}from"./dialog-BBhguyz6.js";import{B as o}from"./button-nnpcbEsU.js";import{I as f}from"./input-BWft8Wgo.js";import{T as K}from"./textarea-D3h8a1sw.js";import{L as X}from"./label-D0PIKdXG.js";import{u as ee}from"./use-toast-C4OTCvr6.js";import{c as u}from"./createLucideIcon-BuIiU6c-.js";import{B as A}from"./package-check-D1BTswej.js";import{U as te}from"./users-CzKJfcqM.js";import{S as se}from"./save-TOrnQZNd.js";import"./toaster-B0JEbWJx.js";import"./index-BLL_YMKG.js";import"./index-CqkR9r7Y.js";import"./utils-DBc7E8Ow.js";import"./index-Q-4oXGeN.js";import"./Dropdown-D7C0naGa.js";import"./transition-jwGWCpDe.js";import"./XMarkIcon-X8B6ni_0.js";import"./clipboard-check--atYlHJL.js";import"./trash-D4YYDTp7.js";import"./index-Vf4ZGyQN.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],re=u("badge-dollar-sign",ae);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],ie=u("calendar-check",le);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",key:"1oijnt"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-.5",key:"1but9f"}],["path",{d:"M16 4h2a2 2 0 0 1 1.73 1",key:"1p8n7l"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}]],ce=u("clipboard-pen-line",ne);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],de=u("info",oe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]],xe=u("message-square-text",me);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],ue=u("package",pe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],$=u("scan-line",he),p=({icon:i,label:r,children:j,error:a,className:d=""})=>e.jsxs("div",{className:`flex flex-col gap-2 ${d}`,children:[e.jsxs(X,{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[i,r]}),j,a&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a})]}),w=()=>{const i=new Date,r=i.getFullYear(),j=String(i.getMonth()+1).padStart(2,"0"),a=String(i.getDate()).padStart(2,"0");return`${r}-${j}-${a}`};function Te({po:i,inspectionCommittee:r,iarNumber:j}){var O;const{data:a,setData:d,post:L,processing:C,errors:m}=G({po_id:i.id,iar_number:j??"",date_received:w(),inspection_committee_id:(r==null?void 0:r.id)||"",items:(i.details||[]).map(t=>{var n,c,l;const s=(l=(c=(n=i.rfq)==null?void 0:n.purchase_request)==null?void 0:c.details)==null?void 0:l.find(x=>x.id===t.pr_detail_id);return{pr_details_id:t.pr_detail_id,product_name:(s==null?void 0:s.item)||"Unknown Item",specs:s!=null&&s.specs&&s.specs.trim()!==""?s.specs:(s==null?void 0:s.item)||"No specs provided",quantity_ordered:parseFloat(t.quantity||0),unit_price:parseFloat(t.unit_price||0),quantity_received:"",remarks:"",total_price:0}}),committee_members:((r==null?void 0:r.members)||[]).map(t=>({id:t.id,name:t.name,position:t.position,status:t.status}))}),[T,h]=y.useState(!1),{toast:v}=ee(),[H,_]=y.useState(!1),z=(t,s,n)=>{d("items",a.items.map((c,l)=>{if(l===t){const x={...c};if(s==="quantity_received"){let b=parseFloat(n)||0;b<1&&(b=1),b>c.quantity_ordered&&(b=c.quantity_ordered),x.quantity_received=b,x.total_price=b*x.unit_price}return s==="remarks"&&(x.remarks=n),x}return c}))},P=y.useMemo(()=>a.items.reduce((t,s)=>t+s.total_price,0),[a.items]),E=t=>{t.preventDefault(),a.items.some(n=>parseFloat(n.quantity_received||0)<n.quantity_ordered)?_(!0):h(!0)},U=()=>{L(route("supply_officer.store_iar"),{preserveScroll:!0,onSuccess:()=>{h(!1),v({title:"IAR Recorded",description:"Inspection & Acceptance Report successfully saved!",duration:3e3,className:"bg-green-600 text-white"})},onError:t=>{h(!1),console.error("IAR Save Error:",t),v({title:"Save Failed",description:"Please review the inputs and try again.",variant:"destructive",duration:4e3})}})},[B,N]=y.useState(!1),[g,Q]=y.useState(null),[k,F]=y.useState(""),V=t=>{Q(t),F(""),N(!0)},W=()=>{Z.post(route("inspection.committee.save",{id:r==null?void 0:r.id}),{member_id:g.id,replacementName:k},{preserveScroll:!0,onSuccess:()=>{d("committee_members",a.committee_members.map(t=>t.id===g.id?{...t,status:"inactive"}:t).concat({id:Date.now(),name:k,position:g.position,status:"active"})),N(!1),v({title:"Member Replaced",description:"Inspection Committee updated successfully!",duration:3e3})},onError:t=>{N(!1),console.error("Member Replace Error:",t),v({title:"Replace Failed",description:"Please check inputs and try again.",variant:"destructive",duration:4e3})}})};return e.jsxs(J,{header:"Schools Divisions Office - Ilagan | Record Inspection and Acceptance",children:[e.jsx(Y,{title:"Record IAR"}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 p-4 sm:p-6 md:p-10",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm p-6 sm:p-8 md:p-10 shadow-2xl rounded-2xl max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8 pb-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-extrabold text-gray-900 leading-tight",children:"Record Inspection and Acceptance Report"}),e.jsxs("p",{className:"text-base sm:text-lg text-gray-600 mt-2",children:["For Purchase Order"," ",e.jsxs("span",{className:"font-semibold text-blue-700",children:["#",i.po_number]})]})]}),Object.keys(m).length>0&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Please correct the following:"}),e.jsx("ul",{className:"list-disc list-inside text-sm",children:Object.entries(m).map(([t,s])=>!t.startsWith("items.")&&e.jsx("li",{children:s},t))})]}),e.jsxs("form",{onSubmit:E,className:"space-y-10",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold text-gray-800 flex items-center gap-2 sm:gap-3",children:[e.jsx(ce,{className:"text-blue-600",size:22}),"Global Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-6 border border-blue-100 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 shadow-sm",children:[e.jsx(p,{icon:e.jsx($,{size:18,className:"text-gray-500"}),label:"IAR Number",error:m.iar_number,children:e.jsx(f,{type:"text",value:a.iar_number,onChange:t=>d("iar_number",t.target.value),placeholder:"Enter IAR Number",className:"h-12 text-base",required:!0})}),e.jsx(p,{icon:e.jsx(ie,{size:18,className:"text-gray-500"}),label:"Date Received",error:m.date_received,children:e.jsx(f,{type:"date",value:a.date_received,max:w(),onChange:t=>{const s=t.target.value;if(s>w()){d("date_received",w()),v({title:"Invalid Date",description:"Future dates are not allowed.",variant:"destructive"});return}d("date_received",s)},className:"h-12 text-base bg-gray-50",required:!0})})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold text-gray-800 flex items-center gap-2 sm:gap-3",children:[e.jsx(A,{className:"text-blue-600",size:22}),"Received Items"]}),e.jsx("div",{className:"grid gap-6",children:a.items.map((t,s)=>{const n=(parseFloat(t.quantity_received)||0)*t.unit_price,c=parseFloat(t.quantity_received||0)!==t.quantity_ordered&&parseFloat(t.quantity_received||0)>0;return e.jsxs("div",{className:"bg-gradient-to-br from-blue-100 to-white border border-blue-100 rounded-xl p-6 shadow-md hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 pb-4 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg sm:text-xl font-semibold text-blue-800",children:t.product_name}),e.jsx("p",{className:"text-sm sm:text-md text-gray-600 mt-1",children:t.specs})]}),e.jsxs("div",{className:"text-right mt-4 sm:mt-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500 flex items-center justify-end gap-1",children:[e.jsx(re,{size:14})," Unit Price"]}),e.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-green-700",children:["₱",t.unit_price.toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6",children:[e.jsx(p,{icon:e.jsx(ue,{size:16}),label:"Quantity Ordered",children:e.jsx(f,{type:"text",className:"text-center font-bold h-12 border-gray-200 cursor-not-allowed",value:t.quantity_ordered,onWheel:l=>l.currentTarget.blur(),readOnly:!0})}),e.jsxs(p,{icon:e.jsx(A,{size:16}),label:"Quantity Received *",error:m[`items.${s}.quantity_received`],children:[e.jsx(f,{type:"number",className:`text-center focus-visible:ring-yellow-400 bg-gray-50 font-bold h-12 ${c?"border-yellow-500 focus-visible:ring-yellow-400":"border-gray-300"}`,value:t.quantity_received,onChange:l=>z(s,"quantity_received",l.target.value),onWheel:l=>l.currentTarget.blur(),min:"1",placeholder:"Quantity Received",required:!0}),c&&e.jsxs("p",{className:"text-yellow-600 text-xs mt-1 flex items-center gap-1",children:[e.jsx(de,{size:12})," Discrepancy with ordered qty"]})]}),e.jsx(p,{icon:e.jsx($,{size:16}),label:"Total for Item",children:e.jsx(f,{type:"text",className:"bg-blue-50 text-blue-800 text-center font-extrabold h-12 border-blue-200 cursor-not-allowed",value:n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),readOnly:!0})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(p,{icon:e.jsx(xe,{size:16}),label:"Remarks",error:m[`items.${s}.remarks`],children:e.jsx(K,{placeholder:"Add remarks (e.g., damaged, incomplete)",value:t.remarks,onChange:l=>z(s,"remarks",l.target.value),rows:3,className:"min-h-[70px] focus-visible:ring-yellow-400 bg-gray-50"})})})]},t.pr_details_id)})})]}),e.jsxs("section",{className:"border-t border-gray-200 pt-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-2 p-6 border border-blue-100 rounded-xl bg-blue-50/70 shadow-sm",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold mb-4 text-gray-800 flex items-center gap-2",children:[e.jsx(te,{size:20,className:"text-blue-600"}),"Inspection Committee"]}),e.jsx("ul",{className:"space-y-3",children:(O=a.committee_members)==null?void 0:O.filter(t=>t.status==="active").sort((t,s)=>t.position.toLowerCase().includes("leader")?-1:s.position.toLowerCase().includes("leader")?1:0).map(t=>e.jsxs("li",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center bg-blue-50 p-4 rounded-lg shadow-sm border border-blue-100",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.position})]}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>V(t),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:"Replace"})]},t.id))})]}),e.jsx("div",{className:"lg:col-span-1 flex justify-center lg:justify-end",children:e.jsxs("div",{className:"text-center p-6 sm:p-8 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-md w-full sm:w-auto",children:[e.jsx("p",{className:"text-base sm:text-lg font-semibold mb-2 opacity-90",children:"Grand Total Received"}),e.jsxs("p",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold tracking-tight break-words",children:["₱",P.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(o,{type:"submit",className:"px-8 sm:px-10 py-3 sm:py-4 text-base sm:text-lg bg-blue-700 hover:bg-blue-800 text-white flex items-center gap-2 shadow-md hover:shadow-lg transition rounded-xl",children:[e.jsx(se,{size:18}),"Save Inspection Report"]})})]})]})]})}),e.jsx(R,{open:B,onOpenChange:N,children:e.jsxs(S,{className:"sm:max-w-md p-6",children:[e.jsxs(q,{children:[e.jsx(D,{className:"text-2xl font-bold",children:"Replace Committee Member"}),e.jsxs(I,{className:"text-md text-gray-600",children:["Replace ",e.jsx("strong",{className:"text-blue-700",children:g==null?void 0:g.name})," with a new inspector."]})]}),e.jsxs(p,{label:"New Inspector Name",className:"mt-4",error:m.replacementName,children:[" ",e.jsx(f,{type:"text",value:k,onChange:t=>F(t.target.value),placeholder:"Enter new inspector's full name",className:"h-10 text-base"})]}),e.jsxs(M,{className:"mt-6 flex justify-end gap-3",children:[e.jsx(o,{variant:"outline",onClick:()=>N(!1),className:"px-6 py-2",children:"Cancel"}),e.jsx(o,{onClick:W,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700",children:"Confirm Replace"})]})]})}),e.jsx(R,{open:T,onOpenChange:h,children:e.jsxs(S,{className:"sm:max-w-md p-6",children:[e.jsxs(q,{children:[e.jsx(D,{className:"text-2xl font-bold",children:"Confirm Record IAR"}),e.jsx(I,{className:"text-md text-gray-600",children:"Are you sure you want to record this Inspection & Acceptance Report? Please ensure all details are correct."})]}),e.jsxs(M,{className:"mt-6 flex justify-end gap-3",children:[e.jsx(o,{variant:"outline",onClick:()=>h(!1),className:"px-6 py-2",children:"Cancel"}),e.jsx(o,{disabled:C,onClick:U,className:"px-6 py-2 bg-green-600 hover:bg-green-700",children:C?"Saving...":"Confirm"})]})]})}),e.jsx(R,{open:H,onOpenChange:_,children:e.jsxs(S,{className:"sm:max-w-md p-6",children:[e.jsxs(q,{children:[e.jsx(D,{className:"text-2xl font-bold text-yellow-700",children:"Quantity Discrepancy Detected"}),e.jsxs(I,{className:"text-md text-gray-700",children:["One or more items have ",e.jsx("strong",{children:"received quantity less than ordered"}),". Are you sure you want to continue recording this Inspection & Acceptance Report?"]})]}),e.jsxs(M,{className:"mt-6 flex justify-end gap-3",children:[e.jsx(o,{variant:"outline",onClick:()=>_(!1),className:"px-6 py-2",children:"Cancel"}),e.jsx(o,{onClick:()=>{_(!1),h(!0)},className:"px-6 py-2 bg-yellow-600 hover:bg-yellow-700",children:"Continue"})]})]})})]})}export{Te as default};
