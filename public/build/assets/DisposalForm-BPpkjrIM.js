import{a as Q,u as P,j as e,H as L}from"./app-CtTXRvSW.js";import{u as U}from"./use-toast-n7ss-q37.js";import{D as Y,a as G,b as J,c as K,d as V,e as W}from"./dialog-Bx8Sq_PR.js";import{B as T}from"./button-BXv_ZNaU.js";import{S as X}from"./SupplyOfficerLayout-BkfKkaPs.js";import{F as Z}from"./file-text-CFdLJT4B.js";import{S as ee}from"./send-horizontal-sD9lN6En.js";import"./index-B2vGw--Q.js";import"./index-Dow8KyZk.js";import"./createLucideIcon-BS5JQiMA.js";import"./utils-_QWm-tM-.js";import"./index-Bhk03iWx.js";import"./toaster-BHX75O9a.js";import"./index-ClPfL8xw.js";import"./Dropdown-BOTfWPms.js";import"./transition-CwMeo9Sp.js";import"./XMarkIcon-B3-C-RCN.js";import"./clipboard-check-CQy8bL28.js";import"./package-check-BilTQm-G.js";import"./trash-CMtWkb3K.js";function _e({record:s,user:se,type:te,rrsp_number:A,selected_items:r=[]}){var c,y,b,h,g,f,j;const{toast:d}=U(),[B,l]=Q.useState(!1),E=Q.useMemo(()=>{var t;return!Array.isArray(r)||r.length===0?(s==null?void 0:s.items)??[]:((t=s==null?void 0:s.items)==null?void 0:t.filter(a=>{var i;return r.includes((i=a.id)==null?void 0:i.toString())}))??[]},[s,r]),{data:n,setData:o,errors:u,processing:p,post:H}=P({rrsp_number:A??"",ics_number:((c=s==null?void 0:s.po)==null?void 0:c.po_number)??"",items:E.map(t=>{var N,_,D,w,S,C,q,k,I,F,O,R;const a=Number(t.quantity??0),i=Number(((N=t.reissued_item)==null?void 0:N.quantity)??0),m=Number(((_=t.disposed_item)==null?void 0:_.quantity)??0),v=Math.max(a-(i+m),0);return{inventory_item_id:t.inventory_item_id,returned_by:((D=s==null?void 0:s.requested_by)==null?void 0:D.id)??((w=s==null?void 0:s.received_from)==null?void 0:w.id)??"",recipient:"",quantity:v,max_quantity:v,remarks:"",item_desc:((S=t.inventory_item)==null?void 0:S.item_desc)??((q=(C=t.inventoryItem)==null?void 0:C.product)==null?void 0:q.name)??"N/A",unit:((I=(k=t.inventory_item)==null?void 0:k.unit)==null?void 0:I.unit_name)??((R=(O=(F=t.inventoryItem)==null?void 0:F.product)==null?void 0:O.unit)==null?void 0:R.unit_name)??""}})}),z=`${((y=s==null?void 0:s.requested_by)==null?void 0:y.firstname)??((b=s==null?void 0:s.received_from)==null?void 0:b.firstname)??""} ${((h=s==null?void 0:s.requested_by)==null?void 0:h.middlename)??((g=s==null?void 0:s.received_from)==null?void 0:g.middlename)??""} ${((f=s==null?void 0:s.requested_by)==null?void 0:f.lastname)??((j=s==null?void 0:s.received_from)==null?void 0:j.lastname)??""}`.trim(),$=t=>{t.preventDefault(),l(!0)},M=()=>{const t={ics_number:n.ics_number||null,date_disposed:new Date().toISOString().split("T")[0],items:n.items.map(a=>({inventory_item_id:a.inventory_item_id,returned_by:a.returned_by,quantity:a.quantity,remarks:a.remarks||""}))};H(route("supply_officer.submit_disposal"),t,{preserveScroll:!0,onSuccess:()=>{l(!1),d({title:"Disposal Recorded",description:"Disposal record successfully saved!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{d({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})},x=(t,a,i)=>{const m=[...n.items];m[t][a]=i,o("items",m)};return e.jsxs(X,{header:"Schools Division Office - Ilagan | Disposal Form",children:[e.jsx(L,{title:"Disposal Form"}),e.jsx("div",{className:"flex items-center justify-center py-10 px-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg w-full max-w-7xl border border-gray-200",children:[e.jsxs("h2",{className:"text-3xl font-bold text-red-700 mb-4 flex items-center gap-2",children:[e.jsx(Z,{size:24})," Disposal Form"]}),Object.keys(u).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(u).map(([t,a])=>e.jsx("li",{children:a},t))})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-6",children:[e.jsx("strong",{children:"Note:"})," This form records items returned for disposal."]}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"p-5 border rounded-md bg-red-50 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Returned By / End-User"}),e.jsx("input",{type:"text",value:z,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RRSP No."}),e.jsx("input",{type:"text",value:n.rrsp_number,onChange:t=>o("rrsp_number",t.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ICS No."}),e.jsx("input",{type:"text",value:n.ics_number,onChange:t=>o("ics_number",t.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:"Returned Items"}),n.items.length===0?e.jsx("p",{className:"text-gray-600 text-sm p-2 italic",children:"No items selected for disposal."}):e.jsx("div",{className:"overflow-x-auto border rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-gray-200 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Item Description"}),e.jsx("th",{className:"p-2 border",children:"Quantity"}),e.jsx("th",{className:"p-2 border",children:"Remarks"})]})}),e.jsx("tbody",{children:n.items.map((t,a)=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:t.item_desc}),e.jsx("td",{className:"p-2 border text-center",children:e.jsx("input",{type:"number",value:t.quantity,onChange:i=>x(a,"quantity",i.target.value),className:"w-20 text-center border-gray-300 rounded-md"})}),e.jsx("td",{className:"p-2 border",children:e.jsx("textarea",{value:t.remarks||"",onChange:i=>x(a,"remarks",i.target.value),className:"w-full border-gray-300 rounded-md text-sm p-1"})})]},a))})]})})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-red-700 text-white text-sm font-medium rounded-md hover:bg-red-800 transition",disabled:p,children:[e.jsx(ee,{size:16,className:"mr-2"}),p?"Saving...":"Confirm"]})})]}),e.jsx(Y,{open:B,onOpenChange:l,children:e.jsxs(G,{className:"sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(K,{children:"Confirm Disposal"}),e.jsx(V,{children:"Are you sure you want to record this disposal entry?"})]}),e.jsxs(W,{className:"mt-4",children:[e.jsx(T,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),e.jsx(T,{onClick:M,children:"Yes, Record Disposal"})]})]})})]})})]})}export{_e as default};
