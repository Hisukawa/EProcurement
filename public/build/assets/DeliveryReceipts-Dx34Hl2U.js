import{a as d,u as D,j as e,H as q,c as A}from"./app-Jgvv-yKo.js";import{S as R}from"./SupplyOfficerLayout-DlvjDNX7.js";import{P as b}from"./package-check-BKFuf3LY.js";import{C as O}from"./circle-plus-CxXwm7Hm.js";import{P as T}from"./printer-check-Bp4Zn4E2.js";import{X as z}from"./index-CRnmTKup.js";import{a as g}from"./transition-BmjiGauW.js";import{h}from"./dialog-BBq9GBlM.js";import"./toaster-CLANAnOh.js";import"./use-toast-DZJ0CZ1q.js";import"./index-CGhHbKNs.js";import"./utils-CGP8CCBD.js";import"./index-t7H54O1R.js";import"./Dropdown-7JK11hb3.js";import"./XMarkIcon-DKAoFHwK.js";import"./clipboard-check-D0KmGB_7.js";import"./createLucideIcon-Dscs4hQv.js";import"./trash-DwZrDYA2.js";import"./with-selector-yzpG_OMZ.js";import"./disabled-BmBYWNyc.js";function le({inventoryData:c,filters:j,units:N}){var f;const[x,_]=d.useState(j.search||""),{data:a,setData:i,get:v,post:w,reset:k}=D({dr_number:"",dr_date:"",remarks:"",quantity:"",unit_id:"",custom_unit:"",item_desc:"",unit_price:""}),[S,u]=d.useState(!1);d.useEffect(()=>{const t=setTimeout(()=>{v(route("supply_officer.delivery_receipts"),{preserveState:!0,replace:!0,data:{search:x}})},300);return()=>clearTimeout(t)},[x]),(t=>{if(!t||!t.data)return[];const l=new Map;return t.data.forEach(r=>{var n;const s=((n=r.po_detail)==null?void 0:n.purchase_order)??null,o=(s==null?void 0:s.id)??`no_po_${r.id}`;l.has(o)||l.set(o,{po_id:(s==null?void 0:s.id)??null,po:s??null,requested_by:r.requested_by??null,items:[]}),l.get(o).items.push(r)}),Array.from(l.values())})(c);const C=t=>{t.preventDefault();const l=new Date,r=a.dr_date||l.toISOString().split("T")[0],s=new Date(r),o=`${s.getFullYear().toString().slice(-2)}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate()}`;w(route("supply_officer.store_central_delivery"),{data:{...a,dr_number:a.dr_number||o,dr_date:a.dr_date||r},onSuccess:()=>{u(!1),k()}})},[m,I]=d.useState([]),F=(t,l)=>{l<=0||I(r=>r.includes(t)?r.filter(s=>s!==t):[...r,t])};return e.jsxs(R,{header:"Schools Divisions Office - Ilagan | Inventory",children:[e.jsx(q,{title:"Inventory"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Inventory"}),m.length>0&&e.jsxs("button",{onClick:()=>A.visit(route("supply_officer.issuance"),{method:"get",data:{items:m}}),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center gap-2",children:[e.jsx(b,{size:18})," Issue Selected Items (",m.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("form",{onSubmit:t=>t.preventDefault(),className:"flex gap-3",children:e.jsx("input",{type:"text",placeholder:"Search item",className:"w-64 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:x,onChange:t=>_(t.target.value)})}),e.jsxs("button",{onClick:()=>u(!0),className:"bg-green-600 text-white px-4 py-2 rounded-md shadow hover:bg-green-700 flex items-center gap-2 transition",children:[e.jsx(O,{size:18}),"Add Delivery Receipt"]})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"w-full table-auto text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["#","DR Number","Item Description","Unit","Remaining Stock/Qty","Unit Price","Total Price","Status","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wide text-center",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-center",children:((f=c==null?void 0:c.data)==null?void 0:f.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"py-12 text-gray-500 text-lg font-medium",children:"No Inventory Found."})}):c.data.map(t=>{var y;const l=((y=t.unit)==null?void 0:y.unit)??"N/A",r=parseFloat(t.unit_cost)||0,s=parseFloat(t.issued_qty)||0,o=parseFloat(t.total_stock)||0,n=Math.max(o-s,0),P=(r*t.total_stock).toFixed(2);let p="Available";return t.total_stock===0?p="Fully Issued":t.total_stock<o&&(p="Partially Issued"),e.jsxs("tr",{className:"hover:bg-blue-50 transition duration-200",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsx("input",{type:"checkbox",checked:m.includes(t.id),disabled:n<=0,onChange:()=>F(t.id,n),className:"w-4 h-4 cursor-pointer disabled:cursor-not-allowed"})}),e.jsx("td",{className:"px-6 py-4",children:t.dr_number??"N/A"}),e.jsx("td",{className:"px-6 py-4",children:t.item_desc??"No description"}),e.jsx("td",{className:"px-6 py-4",children:l}),e.jsx("td",{className:"px-6 py-4",children:n}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",r.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",P]}),e.jsx("td",{className:"px-6 py-4",children:p}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.total_stock<=0?e.jsxs("span",{className:"bg-gray-300 text-gray-600 px-3 py-2 rounded cursor-not-allowed flex items-center justify-center gap-1",children:[e.jsx(b,{size:16})," All Items Are Issued"]}):e.jsxs("a",{href:route("supply_officer.issuance",{inventory_id:t.id}),className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition flex items-center justify-center gap-1",children:[e.jsx(b,{size:16})," Issue Item"]}),e.jsxs("a",{href:route("supply_officer.print_iar",t.iar_id),className:"bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700 transition flex items-center justify-center gap-1",target:"_blank",children:[e.jsx(T,{size:16})," Print IAR"]})]})})]},t.id)})})]})}),e.jsx(g,{appear:!0,show:S,as:d.Fragment,children:e.jsxs(h,{as:"div",className:"relative z-50",onClose:()=>u(!1),children:[e.jsx(g.Child,{as:d.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(g.Child,{as:d.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(h.Panel,{className:"bg-white w-full max-w-md rounded-xl shadow-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3 mb-4",children:[e.jsx(h.Title,{className:"text-lg font-bold text-gray-800",children:"Add Delivery Receipt"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(z,{size:20})})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"DR Number"}),e.jsx("input",{type:"text",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.dr_number||"",onChange:t=>i("dr_number",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"DR Date"}),e.jsx("input",{type:"date",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.dr_date||"",onChange:t=>{i("dr_date",t.target.value)},required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Item Description"}),e.jsx("textarea",{className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.item_desc||"",onChange:t=>i("item_desc",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.quantity||"",onChange:t=>i("quantity",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Unit"}),e.jsxs("select",{className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 mb-2",value:a.unit_id||"",onChange:t=>{const l=t.target.value;l==="custom"?i("unit_id",""):(i("unit_id",l),i("custom_unit",""))},children:[e.jsx("option",{value:"",children:"Select Unit"}),N.map(t=>e.jsx("option",{value:t.id,children:t.unit},t.id)),e.jsx("option",{value:"custom",children:"Other"})]}),a.unit_id===""&&e.jsx("input",{type:"text",placeholder:"Enter custom unit",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.custom_unit||"",onChange:t=>i("custom_unit",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Unit Price (₱)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.unit_price||"",onChange:t=>i("unit_price",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Remarks"}),e.jsx("textarea",{rows:"2",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:a.remarks,onChange:t=>i("remarks",t.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save"})]})]})]})})})]})})]})}export{le as default};
