import{a as x,j as e,H as ye,R as ge,L as be,c as ee}from"./app-zuVoyez-.js";import{I as Ne,C as fe}from"./IssuanceTabs-BFYE8XLe.js";import{S as je}from"./SupplyOfficerLayout-CuL2gRYi.js";import{B as v}from"./button-Bd4n87L7.js";import{D as te,a as se,b as ae,c as re,d as le,e as ie}from"./dialog-B6VI6JKr.js";import{P as ve}from"./printer-check-Wo9nWyFi.js";import{C as we}from"./circle-plus-Djm8NChw.js";import{F as _e}from"./file-text-iOcejavA.js";import"./createLucideIcon-yNS56xQp.js";import"./Dropdown-GMzF1VTu.js";import"./transition-BRwssZxH.js";import"./toaster-7z5SWXdC.js";import"./use-toast-C9nVJKHC.js";import"./index-D8JXm84Z.js";import"./index-D7OkRBNC.js";import"./utils-Db1sp63L.js";import"./index-I8tQg3sx.js";import"./XMarkIcon-Drp7UHZX.js";import"./clipboard-check-gNAz5LFA.js";import"./package-check-DEDO-_P-.js";import"./trash-BuP5qZ1-.js";import"./index-2LgRYPne.js";function Je({purchaseOrders:Ce,inventoryItems:Se,par:p,user:Pe}){var G,U;const[N,ne]=x.useState(""),[k,oe]=x.useState(""),[q,ce]=x.useState(new Date().getFullYear()),[de,me]=x.useState([]),F=(G=p==null?void 0:p.data)==null?void 0:G.filter(t=>{var i,n,m,o,c;const r=N===""||((i=t.par_number)==null?void 0:i.toLowerCase().includes(N.toLowerCase()))||((m=(n=t.inventory_item)==null?void 0:n.item_desc)==null?void 0:m.toLowerCase().includes(N.toLowerCase()))||(((c=(o=t.items)==null?void 0:o[0])==null?void 0:c.recipient)??"").toLowerCase().includes(N.toLowerCase()),a=new Date(t.created_at),l=k===""||a.getMonth()+1===Number(k),s=q===""||a.getFullYear()===Number(q);return r&&l&&s});console.log(F);const xe=t=>{me(r=>r.includes(t)?r.filter(a=>a!==t):[...r,t])},[ue,A]=x.useState(!1),[h,E]=x.useState(null),[f,w]=x.useState([]),[u,Q]=x.useState(""),pe=(t,r)=>{const a=t.target.value;if(t.target.value="",a==="return"){E(r),w([]),Q(""),A(!0);return}if(a==="reissuance"||a==="disposal"){const l=a==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";window.location.href=route(l,{id:r.id,type:"par"})}},[he,O]=x.useState(!1),[L,z]=x.useState([]),[T,B]=x.useState(null);return e.jsxs(je,{header:"Schools Divisions Office - Ilagan | PAR",children:[e.jsx(ye,{title:"PAR"}),e.jsx(Ne,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Property Acknowledgement Receipt (PAR)"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>window.location.href=route("supply_officer.generate_par_report",{month:k,year:q,search:N}),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-2 py-1 text-sm",value:k,onChange:t=>oe(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),[...Array(12)].map((t,r)=>e.jsx("option",{value:r+1,children:new Date(0,r).toLocaleString("en",{month:"long"})},r))]}),e.jsx("label",{className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-20 text-sm",value:q,onChange:t=>ce(t.target.value)})]}),e.jsx("input",{type:"text",placeholder:"Search PAR number, item...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm",value:N,onChange:t=>ne(t.target.value)})]}),e.jsx("div",{className:"overflow-x-auto mt-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-semibold uppercase tracking-wider text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"PAR No."}),e.jsx("th",{className:"px-4 py-3",children:"Division"}),e.jsx("th",{className:"px-4 py-3",children:"Requested By"}),e.jsx("th",{className:"px-4 py-3",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:F&&F.length>0?F.map((t,r)=>{var o,c,y,g,_,b,M,j,C,S,P,R,I,$,D,H,V,W,J,K,X,Z;const a=((o=t.items)==null?void 0:o.map(d=>{var Y;return{description:((Y=d.inventory_item)==null?void 0:Y.item_desc)??"N/A",quantity:d.quantity,unitCost:Number(d.unit_cost??0),totalCost:Number(d.unit_cost??0)*d.quantity,date:new Date(d.created_at).toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric"})}}))||[],l=de.includes(t.id),s=a[0]??{description:((g=(y=(c=t.items)==null?void 0:c[0])==null?void 0:y.inventory_item)==null?void 0:g.item_desc)??"N/A",quantity:((b=(_=t.items)==null?void 0:_[0])==null?void 0:b.quantity)??0,unitCost:Number(((C=(j=(M=t.items)==null?void 0:M[0])==null?void 0:j.inventory_item)==null?void 0:C.unit_cost)??0),totalCost:(((P=(S=t.items)==null?void 0:S[0])==null?void 0:P.quantity)??0)*((($=(I=(R=t.items)==null?void 0:R[0])==null?void 0:I.inventory_item)==null?void 0:$.unit_cost)??0),date:new Date(((H=(D=t.items)==null?void 0:D[0])==null?void 0:H.created_at)??t.created_at).toLocaleDateString("en-PH")},i=a.slice(1),n=((W=(V=t.items)==null?void 0:V[0])==null?void 0:W.recipient)??"N/A",m=((K=(J=t.items)==null?void 0:J[0])==null?void 0:K.recipient_division)??"N/A";return e.jsxs(ge.Fragment,{children:[e.jsxs("tr",{className:"bg-white hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800 align-top",children:r+1}),e.jsx("td",{className:"px-4 py-3 text-blue-600 font-medium align-top",children:t.par_number}),e.jsx("td",{className:"px-4 py-3 align-top",children:m}),e.jsx("td",{className:"px-4 py-3 align-top",children:n}),e.jsx("td",{className:"px-4 py-3 font-medium",children:s.description}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",(X=s.unitCost)==null?void 0:X.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",(Z=s.totalCost)==null?void 0:Z.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:s.date}),e.jsxs("td",{className:"px-4 py-3 text-center align-top",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center relative z-10",children:[e.jsxs("a",{href:route("supply_officer.print_par",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium pointer-events-auto",children:[e.jsx(ve,{size:14}),"Print"]}),e.jsx(v,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm pointer-events-auto",onClick:()=>{B(t),z([]),O(!0)},children:"Switch Type"}),e.jsx(v,{type:"button",onClick:d=>pe(d,t),value:"return",className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm pointer-events-auto",children:"Return"})]}),t.items.length>1&&e.jsx("button",{onClick:()=>xe(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{size:14})," Show More (",t.items.length-1," more)"]})})]})]}),l&&i.map((d,Y)=>e.jsxs("tr",{className:"bg-gray-50 hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2"}),e.jsx("td",{className:"px-4 py-2 font-medium",children:d.description}),e.jsx("td",{className:"px-4 py-2 text-center",children:d.quantity}),e.jsxs("td",{className:"px-4 py-2 text-right",children:["₱",d.unitCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2 text-right",children:["₱",d.totalCost.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-left",children:d.date}),e.jsx("td",{className:"px-4 py-2"})]},Y))]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(_e,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No PAR records found"})]})})})})]})}),((U=p==null?void 0:p.links)==null?void 0:U.length)>0&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:p.links.map((t,r)=>e.jsx(be,{href:t.url||"#",className:`px-3 py-1 text-sm rounded-md ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"} ${!t.url&&"opacity-50 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:t.label}},r))})]}),e.jsx(te,{open:ue,onOpenChange:A,children:e.jsxs(se,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(ae,{className:"pb-3 border-b border-gray-100",children:[e.jsx(re,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Return Items"}),e.jsx(le,{className:"text-sm text-gray-500",children:"Select items to return and specify whether they are for reissuance or disposal."})]}),h?(()=>{const t=h.items||[],r=t.every(a=>a.reissuedItem||a.disposedItem||a.status==="reissued"||a.status==="disposed");return e.jsxs("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2 py-1 rounded-md hover:bg-gray-100",children:[e.jsx("input",{id:"select-all-return",type:"checkbox",checked:t.every(a=>f.includes(a.id))||!1,onChange:a=>{a.target.checked?w(l=>[...new Set([...l,...t.map(s=>s.id)])]):w(l=>l.filter(s=>!t.map(i=>i.id).includes(s)))},className:"h-4 w-4 accent-blue-600"}),e.jsx("label",{htmlFor:"select-all-return",className:"text-sm font-medium text-gray-700 cursor-pointer select-none",children:"Select all"})]}),(()=>{const a=h.items||[];return console.log({lowItems:a}),a.every(s=>{const i=Number(s.quantity??0),n=Number(s.total_reissued_quantity??0),m=Number(s.total_disposed_quantity??0);return n+m>=i})?e.jsxs("div",{className:"p-4 text-center text-gray-500 text-sm italic bg-gray-50 rounded-md border border-gray-200",children:["All items in this issuance have already been"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"reissued"})," or"," ",e.jsx("span",{className:"font-semibold text-rose-600",children:"disposed"}),"."]}):a.map(s=>{var C,S,P,R,I;const i=((S=(C=s.inventoryItem)==null?void 0:C.product)==null?void 0:S.name)??((P=s.inventory_item)==null?void 0:P.item_desc)??"N/A",n=((I=(R=s.inventory_item)==null?void 0:R.product)==null?void 0:I.specs)??"",m=Number(s.quantity??0),o=Number(s.total_reissued_quantity??0),c=Number(s.total_disposed_quantity??0),y=o+c,g=Math.max(m-y,0),_=g===0&&o>0,b=g===0&&c>0,M=g>0&&(o>0||c>0),j=_||b;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${f.includes(s.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"} ${j?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:f.includes(s.id),disabled:j,onChange:$=>{j||w(D=>$.target.checked?[...D,s.id]:D.filter(H=>H!==s.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-gray-800",children:i}),_||b?e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${b?"bg-rose-100 text-rose-700 border border-rose-300":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:b?"Disposed":"Reissued"}):M?e.jsxs("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-300",children:["Some Items are returned (",y,"/",m,")"]}):e.jsxs("span",{className:"text-xs text-gray-600",children:["Remaining: ",g]})]}),n&&e.jsx("div",{className:"text-gray-500 text-xs",children:n}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",s.quantity," | ₱",Number(s.unit_cost??0).toFixed(2)]}),(o>0||c>0)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Returned:"," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:[o," reissued"]})," ","|"," ",e.jsxs("span",{className:"text-rose-600 font-medium",children:[c," disposed"]})]})]})]},s.id)})})()]})})():e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs("div",{className:"mt-5 border-t pt-4",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${u==="reissuance"?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"reissuance",checked:u==="reissuance",onChange:t=>Q(t.target.value),className:"h-4 w-4 accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Reissuance"})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${u==="disposal"?"border-rose-400 bg-rose-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"disposal",checked:u==="disposal",onChange:t=>Q(t.target.value),className:"h-4 w-4 accent-rose-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Disposal"})]})]})]}),e.jsxs(ie,{className:"pt-5 border-t mt-4",children:[e.jsx(v,{variant:"outline",className:"w-28",onClick:()=>{A(!1),w([]),Q(""),E(null)},children:"Cancel"}),e.jsx(v,{className:`w-28 text-white ${u==="disposal"?"bg-rose-600 hover:bg-rose-700":"bg-blue-600 hover:bg-blue-700"}`,disabled:!f.length||!u||h&&(h.items||[]).every(t=>{const r=Number(t.quantity??0),a=Number(t.total_reissued_quantity??0),l=Number(t.total_disposed_quantity??0),s=a+l;return console.log({totalQty:r,reissuedQty:a,disposedQty:l,totalProcessed:s}),s>=r}),onClick:()=>{if((h.items||[]).every(l=>{const s=Number(l.quantity??0),i=Number(l.total_reissued_quantity??0),n=Number(l.total_disposed_quantity??0);return i+n>=s})){toast({title:"All items already processed",description:"There are no items left to return.",variant:"destructive"});return}if(f.length===0){toast({title:"No items selected",description:"Please select at least one item to return.",variant:"destructive"});return}if(!u){toast({title:"No return type chosen",description:"Please specify whether this return is for reissuance or disposal.",variant:"destructive"});return}const a=u==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";ee.visit(route(a,{id:h.id,type:"par",items:f.join(",")})),A(!1)},children:"Proceed"})]})]})}),e.jsx(te,{open:he,onOpenChange:O,children:e.jsxs(se,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(ae,{className:"pb-3 border-b border-gray-100",children:[e.jsx(re,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(le,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),T?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(T.items||[]).map(t=>{var l,s,i,n,m;const r=((s=(l=t.inventoryItem)==null?void 0:l.product)==null?void 0:s.name)??((i=t.inventory_item)==null?void 0:i.item_desc)??"N/A",a=((m=(n=t.inventoryItem)==null?void 0:n.product)==null?void 0:m.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${L.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:L.includes(t.id),onChange:o=>{z(c=>o.target.checked?[...c,t.id]:c.filter(y=>y!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:r}),a&&e.jsx("div",{className:"text-gray-500 text-xs",children:a}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | ₱",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(ie,{className:"pt-5 border-t mt-4",children:[e.jsx(v,{variant:"outline",className:"w-28",onClick:()=>{O(!1),z([]),B(null)},children:"Cancel"}),e.jsx(v,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!L.length,onClick:()=>{var t;ee.visit(route("supply_officer.switch_type",{type:"par",id:T.id,po_id:(t=T.po)==null?void 0:t.id,items:L}))},children:"Continue"})]})]})})]})}export{Je as default};
