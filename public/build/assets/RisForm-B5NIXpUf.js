import{u as H,a as x,j as e}from"./app-DqNKJLgr.js";import{u as L}from"./use-toast-CL8hAUqx.js";import{D as M,a as P,b as Q,c as U,d as Y,e as G}from"./dialog-K3Udw0HJ.js";import{B as R}from"./button-CskkiS1y.js";import{F as J}from"./file-text-DPSMfJ5_.js";import{M as K}from"./minus-DtLKptXg.js";import{S as V}from"./send-horizontal-5lov6HBT.js";import"./index-Dl_JvOZ6.js";import"./index-4KP02Cg3.js";import"./createLucideIcon-4VTRvRLE.js";import"./utils-CV84Dt2y.js";import"./index-DiY8fTyq.js";function re({purchaseOrder:o,inventoryItems:h=[],user:p,risNumber:r}){var j,v,y,N,_,w,k;const t=((v=(j=o==null?void 0:o.detail)==null?void 0:j.pr_detail)==null?void 0:v.purchase_request)??null,C=t?`${((y=t==null?void 0:t.focal_person)==null?void 0:y.firstname)??""} ${((N=t==null?void 0:t.focal_person)==null?void 0:N.middlename)??""} ${((_=t==null?void 0:t.focal_person)==null?void 0:_.lastname)??""}`.trim():"N/A",{data:l,setData:n,post:D,processing:b,errors:g}=H({po_id:(o==null?void 0:o.id)??null,ris_number:r??"",requested_by:((w=t==null?void 0:t.focal_person)==null?void 0:w.id)??null,issued_by:(p==null?void 0:p.id)??null,remarks:"",items:h.map(s=>{var a;return{inventory_item_id:s.id,recipient:"",recipient_division:"",quantity:s.total_stock>0?1:0,unit_cost:s.unit_cost??0,total_cost:s.unit_cost??0,total_stock:s.total_stock??0,description:s.item_desc??((a=s.product)==null?void 0:a.item_description)??"N/A"}})}),[S,m]=x.useState(!1),{toast:f}=L();x.useEffect(()=>{r&&!l.ris_number&&n("ris_number",r)},[r]);const q=(s,a,c)=>{const i=[...l.items];{let u=parseFloat(c)||0;u>i[s].total_stock&&(u=i[s].total_stock),i[s].quantity=u,i[s].total_cost=u*(i[s].unit_cost??0)}n("items",i)},I=s=>{const a=l.items.filter((c,i)=>i!==s);n("items",a)},F=s=>{s.preventDefault(),m(!0)},A=()=>{D(route("supply_officer.store_ris"),{preserveScroll:!0,onSuccess:()=>{m(!1),f({title:"RIS Recorded",description:"Requisition and Issue Slip successfully saved!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{f({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})},[E,T]=x.useState(""),[z,B]=x.useState(""),O=s=>{T(s.target.value),n("items",l.items.map(a=>({...a,recipient:s.target.value})))},$=s=>{B(s.target.value),n("items",l.items.map(a=>({...a,recipient_division:s.target.value})))},d=h.some(s=>s.source_type==="central");return e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 mb-4 flex items-center gap-2",children:[e.jsx(J,{size:24})," Requisition and Issue Slip (RIS)"]}),Object.keys(g).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(g).map(([s,a])=>e.jsx("li",{children:a},s))})}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"p-5 border rounded-md bg-blue-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-700 mb-4",children:"Requisition Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{value:((k=t==null?void 0:t.division)==null?void 0:k.division)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RIS No."}),e.jsx("input",{type:"text",value:l.ris_number,onChange:s=>n("ris_number",s.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested By"}),e.jsx("input",{value:C,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]})]})]}),l.items.map((s,a)=>e.jsxs("div",{className:"p-5 border rounded-md bg-green-50 relative",children:[l.items.length>1&&e.jsx("button",{type:"button",onClick:()=>I(a),className:"absolute top-2 right-2 text-red-600 hover:text-red-800",children:e.jsx(K,{size:20})}),e.jsxs("h3",{className:"text-lg font-semibold text-green-700 mb-4",children:["Item ",a+1]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("input",{value:s.description,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:s.total_stock,value:s.quantity,onChange:c=>q(a,"quantity",c.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),e.jsx("input",{type:"number",value:s.unit_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),e.jsx("input",{type:"number",value:s.total_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-gray-50"})]})]})]})]},a)),e.jsxs("div",{className:"p-5 border rounded-md bg-yellow-50 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-yellow-700 mb-4",children:["Default Recipient (applied to all items)",d&&e.jsx("span",{className:"text-red-600 ml-2 text-sm font-normal",children:"* Required for CENTRAL sourced items"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Recipient Name ",d&&e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:E,onChange:O,placeholder:"Leave blank to issue to requester",required:d,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Recipient Division ",d&&e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:z,onChange:$,placeholder:"Optional",required:d,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:l.remarks,onChange:s=>n("remarks",s.target.value),rows:"4",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm",placeholder:"Optional"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",disabled:b,children:[e.jsx(V,{size:16,className:"mr-2"})," ",b?"Saving...":"Submit Issuance"]})})]}),e.jsx(M,{open:S,onOpenChange:m,children:e.jsxs(P,{className:"sm:max-w-md",children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Confirm Issuance"}),e.jsx(Y,{children:"Are you sure you want to record this RIS issuance?"})]}),e.jsxs(G,{className:"mt-4 flex justify-end gap-2",children:[e.jsx(R,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(R,{onClick:A,children:"Yes, Record RIS"})]})]})})]})}export{re as default};
