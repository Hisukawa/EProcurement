import{a as u,j as e,H as fe,R as Ne,L as je,c as te}from"./app-4Pod7gxo.js";import{I as ve,C as we}from"./IssuanceTabs-CQlAXuRA.js";import{S as _e}from"./SupplyOfficerLayout-QQiPTqhi.js";import{B as k}from"./button-4Gr1dIEf.js";import{D as se,a as ae,b as re,c as ie,d as ne,e as le}from"./dialog-Cci81-gQ.js";import{P as Se}from"./printer-check-eAaKA8Aq.js";import{C as Ce}from"./circle-plus-BYvzwFS8.js";import{F as Ie}from"./file-text-DNWG4gJQ.js";import"./createLucideIcon-BEvhKV3k.js";import"./Dropdown-C-56s-Rd.js";import"./transition-DMlcWJtq.js";import"./toaster-7VG6md4U.js";import"./use-toast-CB6HWlEV.js";import"./index-BfYVPKni.js";import"./index-Cit4VXVP.js";import"./utils-C-V6Xxww.js";import"./index-CdoXXacn.js";import"./XMarkIcon-DnTBuP1q.js";import"./clipboard-check-D1Pydy-f.js";import"./package-check-BY0RwSiY.js";import"./trash-BNgLmuZm.js";import"./index-CTRViXCj.js";function Xe({purchaseOrders:Re,inventoryItems:oe,ris:x,user:qe}){var K,W,X;const[g,ce]=u.useState(""),[D,de]=u.useState(""),[$,me]=u.useState(new Date().getFullYear()),[ue,xe]=u.useState([]),pe=t=>{xe(r=>r.includes(t)?r.filter(s=>s!==t):[...r,t])};new Map(oe.map(t=>{var r;return[`${t.item_desc}_${(r=t.inventory)==null?void 0:r.unit}`,t.inventory]}));const z=new Map;(K=x==null?void 0:x.data)==null||K.forEach(t=>{const r=`${t.po_id}_${t.inventory_item_id}`;z.has(r)||z.set(r,[]),z.get(r).push(t)});const J=((W=x==null?void 0:x.data)==null?void 0:W.filter(t=>{var N,p,R,b,j,v,w,_,S,q,C,P,m,E,M,Q,T,Z;const r=((N=t.ris_number)==null?void 0:N.toLowerCase())??"",s=((p=t.requested_by)==null?void 0:p.firstname)??((R=t.issued_to)==null?void 0:R.firstname)??"",i=((b=t.requested_by)==null?void 0:b.lastname)??((j=t.issued_to)==null?void 0:j.lastname)??"",a=`${s} ${i}`.trim().toLowerCase(),o=((_=(w=(v=t.items)==null?void 0:v[0])==null?void 0:w.recipient)==null?void 0:_.toLowerCase())??"",c=((M=(E=(m=(P=(C=(q=(S=t.po)==null?void 0:S.details)==null?void 0:q[0])==null?void 0:C.pr_detail)==null?void 0:P.purchase_request)==null?void 0:m.division)==null?void 0:E.division)==null?void 0:M.toLowerCase())??"",d=(Q=t.items)==null?void 0:Q.map(ge=>{var ee;return((ee=ge.inventory_item)==null?void 0:ee.item_desc)??""}).join(" ").toLowerCase(),l=r.includes(g.toLowerCase())||a.includes(g.toLowerCase())||c.includes(g.toLowerCase())||d.includes(g.toLowerCase())||o.includes(g.toLowerCase()),n=(Z=(T=t.items)==null?void 0:T[0])!=null&&Z.created_at?new Date(t.items[0].created_at):null,h=D?n&&n.getMonth()+1===parseInt(D):!0,y=$?n&&n.getFullYear()===parseInt($):!0;return l&&h&&y}))||[],[he,A]=u.useState(!1),[I,G]=u.useState(null),[F,L]=u.useState([]),[f,H]=u.useState(""),ye=(t,r)=>{const s=t.target.value;if(t.target.value="",s==="return"){G(r),L([]),H(""),A(!0);return}if(s==="reissuance"||s==="disposal"){const i=s==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";window.location.href=route(i,{id:r.id,type:"ris"})}},[be,B]=u.useState(!1),[O,U]=u.useState([]),[Y,V]=u.useState(null);return e.jsxs(_e,{header:"Schools Divisions Office - Ilagan | Requisition and Issue Slip",children:[e.jsx(fe,{title:"RIS"}),e.jsx(ve,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Requisition and Issue Slip (RIS)"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>{const t=new URLSearchParams;D&&t.append("month",D),$&&t.append("year",$),g&&t.append("search",g),window.location.href=route("supply_officer.generate_report")+"?"+t.toString()},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-7 py-1 text-sm",value:D,onChange:t=>de(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map((t,r)=>e.jsx("option",{value:r+1,children:t},r))]}),e.jsx("label",{className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-20 text-sm",value:$,onChange:t=>me(t.target.value)})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search Focal Person, RIS number...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm",value:g,onChange:t=>ce(t.target.value)})})]}),e.jsx("div",{className:"overflow-x-auto mt-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-semibold uppercase tracking-wider text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"RIS No."}),e.jsx("th",{className:"px-4 py-3",children:"Division"}),e.jsx("th",{className:"px-4 py-3",children:"Issued To / Focal Person"}),e.jsx("th",{className:"px-4 py-3",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:J&&J.length>0?J.map((t,r)=>{var o,c,d,l,n,h,y,N,p,R,b,j,v,w,_,S,q,C,P;const s=ue.includes(t.id);s?t.items:t.items.slice(0,1);const i=((c=(o=t.items)==null?void 0:o[0])==null?void 0:c.recipient)??(t.requested_by?`${t.requested_by.firstname??""} ${t.requested_by.lastname??""}`.trim():"N/A"),a=((l=(d=t.items)==null?void 0:d[0])==null?void 0:l.recipient_division)??((R=(p=(N=(y=(h=(n=t.po)==null?void 0:n.details)==null?void 0:h[0])==null?void 0:y.pr_detail)==null?void 0:N.purchase_request)==null?void 0:p.division)==null?void 0:R.division)??"N/A";return console.log(t),e.jsxs(Ne.Fragment,{children:[e.jsxs("tr",{className:"bg-white hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800",children:r+1}),e.jsx("td",{className:"px-4 py-3 text-blue-600 font-medium",children:t.ris_number}),e.jsx("td",{className:"px-4 py-3",children:a}),e.jsx("td",{className:"px-4 py-3",children:i}),e.jsx("td",{className:"px-4 py-3 font-medium",children:((j=(b=t.items[0])==null?void 0:b.inventory_item)==null?void 0:j.item_desc)??"N/A"}),e.jsx("td",{className:"px-4 py-3 text-center",children:((v=t.items[0])==null?void 0:v.quantity)??0}),e.jsx("td",{className:"px-4 py-3 text-right",children:Number(((_=(w=t.items[0])==null?void 0:w.inventory_item)==null?void 0:_.unit_cost)??0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:((((S=t.items[0])==null?void 0:S.quantity)??0)*(((C=(q=t.items[0])==null?void 0:q.inventory_item)==null?void 0:C.unit_cost)??0)).toFixed(2)}),e.jsx("td",{className:"px-4 py-3",children:new Date((P=t.items[0])==null?void 0:P.created_at).toLocaleDateString("en-PH")}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs("a",{href:route("supply_officer.print_ris",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium",children:[e.jsx(Se,{size:14})," Print"]}),e.jsx(k,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",onClick:()=>{V(t),U([]),B(!0)},children:"Switch Type"}),e.jsx(k,{type:"button",value:"return",onClick:m=>ye(m,t),className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",children:"Return"})]}),t.items.length>1&&e.jsx("button",{onClick:()=>pe(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:s?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:14})," Show More (",t.items.length-1," more)"]})})]})]}),s&&t.items.slice(1).map((m,E)=>{var M,Q,T;return e.jsxs("tr",{className:"bg-gray-50 hover:bg-blue-50 transition",children:[e.jsx("td",{colSpan:"4"}),e.jsx("td",{className:"px-4 py-3 font-medium",children:((M=m.inventory_item)==null?void 0:M.item_desc)??"N/A"}),e.jsx("td",{className:"px-4 py-3 text-center",children:m.quantity}),e.jsx("td",{className:"px-4 py-3 text-right",children:Number(((Q=m.inventory_item)==null?void 0:Q.unit_cost)??0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:((m.quantity??0)*(((T=m.inventory_item)==null?void 0:T.unit_cost)??0)).toFixed(2)}),e.jsx("td",{className:"px-4 py-3",children:new Date(m.created_at).toLocaleDateString("en-PH")}),e.jsx("td",{})]},`${t.id}-${E}`)})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(Ie,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No RIS records found"})]})})})})]})}),((X=x==null?void 0:x.links)==null?void 0:X.length)>3&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:x.links.map((t,r)=>e.jsx(je,{href:t.url||"#",className:`
                  px-3 py-1 text-sm rounded-md
                  ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
                  ${!t.url&&"opacity-50 cursor-not-allowed"}
                `,dangerouslySetInnerHTML:{__html:t.label}},r))})]}),e.jsx(se,{open:he,onOpenChange:A,children:e.jsxs(ae,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(re,{className:"pb-3 border-b border-gray-100",children:[e.jsx(ie,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Return Items"}),e.jsx(ne,{className:"text-sm text-gray-500",children:"Select items to return and specify whether they are for reissuance or disposal."})]}),I?(()=>{const t=I.items||[],r=t.every(s=>s.reissuedItem||s.disposedItem||s.status==="reissued"||s.status==="disposed");return e.jsxs("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2 py-1 rounded-md hover:bg-gray-100",children:[e.jsx("input",{id:"select-all-return",type:"checkbox",checked:t.every(s=>F.includes(s.id))||!1,onChange:s=>{s.target.checked?L(i=>[...new Set([...i,...t.map(a=>a.id)])]):L(i=>i.filter(a=>!t.map(o=>o.id).includes(a)))},className:"h-4 w-4 accent-blue-600"}),e.jsx("label",{htmlFor:"select-all-return",className:"text-sm font-medium text-gray-700 cursor-pointer select-none",children:"Select all"})]}),(()=>{const s=I.items||[];return console.log({lowItems:s}),s.every(a=>{const o=Number(a.quantity??0),c=Number(a.total_reissued_quantity??0),d=Number(a.total_disposed_quantity??0);return c+d>=o})?e.jsxs("div",{className:"p-4 text-center text-gray-500 text-sm italic bg-gray-50 rounded-md border border-gray-200",children:["All items in this issuance have already been"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"reissued"})," or"," ",e.jsx("span",{className:"font-semibold text-rose-600",children:"disposed"}),"."]}):s.map(a=>{var j,v,w,_,S;const o=((v=(j=a.inventoryItem)==null?void 0:j.product)==null?void 0:v.name)??((w=a.inventory_item)==null?void 0:w.item_desc)??"N/A",c=((S=(_=a.inventory_item)==null?void 0:_.product)==null?void 0:S.specs)??"",d=Number(a.quantity??0),l=Number(a.total_reissued_quantity??0),n=Number(a.total_disposed_quantity??0),h=l+n,y=Math.max(d-h,0),N=y===0&&l>0,p=y===0&&n>0,R=y>0&&(l>0||n>0),b=N||p;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${F.includes(a.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"} ${b?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:F.includes(a.id),disabled:b,onChange:q=>{b||L(C=>q.target.checked?[...C,a.id]:C.filter(P=>P!==a.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-gray-800",children:o}),N||p?e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${p?"bg-rose-100 text-rose-700 border border-rose-300":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:p?"Returned":"Reissued"}):R?e.jsxs("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-300",children:["Some Items are returned (",h,"/",d,")"]}):e.jsxs("span",{className:"text-xs text-gray-600",children:["Remaining: ",y]})]}),c&&e.jsx("div",{className:"text-gray-500 text-xs",children:c}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",a.quantity," | ₱",Number(a.unit_cost??0).toFixed(2)]}),(l>0||n>0)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Returned:"," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:[l," reissued"]})," ","|"," ",e.jsxs("span",{className:"text-rose-600 font-medium",children:[n," disposed"]})]})]})]},a.id)})})()]})})():e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs("div",{className:"mt-5 border-t pt-4",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${f==="reissuance"?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"reissuance",checked:f==="reissuance",onChange:t=>H(t.target.value),className:"h-4 w-4 accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Reissuance"})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${f==="disposal"?"border-rose-400 bg-rose-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"disposal",checked:f==="disposal",onChange:t=>H(t.target.value),className:"h-4 w-4 accent-rose-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Disposal"})]})]})]}),e.jsxs(le,{className:"pt-5 border-t mt-4",children:[e.jsx(k,{variant:"outline",className:"w-28",onClick:()=>{A(!1),L([]),H(""),G(null)},children:"Cancel"}),e.jsx(k,{className:`w-28 text-white ${f==="disposal"?"bg-rose-600 hover:bg-rose-700":"bg-blue-600 hover:bg-blue-700"}`,disabled:!F.length||!f||I&&(I.items||[]).every(t=>{const r=Number(t.quantity??0),s=Number(t.total_reissued_quantity??0),i=Number(t.total_disposed_quantity??0),a=s+i;return console.log({totalQty:r,reissuedQty:s,disposedQty:i,totalProcessed:a}),a>=r}),onClick:()=>{if((I.items||[]).every(i=>{var l,n;const a=Number(i.quantity??0),o=Number(((l=i.reissued_item)==null?void 0:l.quantity)??0),c=Number(((n=i.disposed_item)==null?void 0:n.quantity)??0);return o+c>=a})){toast({title:"All items already processed",description:"There are no items left to return.",variant:"destructive"});return}if(F.length===0){toast({title:"No items selected",description:"Please select at least one item to return.",variant:"destructive"});return}if(!f){toast({title:"No return type chosen",description:"Please specify whether this return is for reissuance or disposal.",variant:"destructive"});return}const s=f==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";te.visit(route(s,{id:I.id,type:"ris",items:F.join(",")})),A(!1)},children:"Proceed"})]})]})}),e.jsx(se,{open:be,onOpenChange:B,children:e.jsxs(ae,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(re,{className:"pb-3 border-b border-gray-100",children:[e.jsx(ie,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(ne,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),Y?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(Y.items||[]).map(t=>{var i,a,o,c,d;const r=((a=(i=t.inventoryItem)==null?void 0:i.product)==null?void 0:a.name)??((o=t.inventory_item)==null?void 0:o.item_desc)??"N/A",s=((d=(c=t.inventoryItem)==null?void 0:c.product)==null?void 0:d.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${O.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:O.includes(t.id),onChange:l=>{U(n=>l.target.checked?[...n,t.id]:n.filter(h=>h!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:r}),s&&e.jsx("div",{className:"text-gray-500 text-xs",children:s}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | ₱",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(le,{className:"pt-5 border-t mt-4",children:[e.jsx(k,{variant:"outline",className:"w-28",onClick:()=>{B(!1),U([]),V(null)},children:"Cancel"}),e.jsx(k,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!O.length,onClick:()=>{var t;te.visit(route("supply_officer.switch_type",{type:"ris",id:Y.id,po_id:(t=Y.po)==null?void 0:t.id,items:O}))},children:"Continue"})]})]})})]})}export{Xe as default};
