import{a,u as M,j as e,H as Q}from"./app-4Pod7gxo.js";import{S as $}from"./SupplyOfficerLayout-QQiPTqhi.js";import{D as S,a as C,b as D,c as P,d as O,e as F}from"./dialog-Cci81-gQ.js";import{B as p}from"./button-4Gr1dIEf.js";import{T as A}from"./triangle-alert-BwBASS8a.js";import"./toaster-7VG6md4U.js";import"./use-toast-CB6HWlEV.js";import"./index-BfYVPKni.js";import"./index-Cit4VXVP.js";import"./createLucideIcon-BEvhKV3k.js";import"./utils-C-V6Xxww.js";import"./index-CdoXXacn.js";import"./Dropdown-C-56s-Rd.js";import"./transition-DMlcWJtq.js";import"./XMarkIcon-DnTBuP1q.js";import"./clipboard-check-D1Pydy-f.js";import"./package-check-BY0RwSiY.js";import"./trash-BNgLmuZm.js";import"./index-CTRViXCj.js";function oe({pr:y,rfq:q,suppliers:j,winners:o}){const _=a.useMemo(()=>[...new Set(o.map(t=>t.supplier_id))],[o]),h=a.useMemo(()=>j.filter(t=>_.includes(t.id)),[j,_]),[T,b]=a.useState(!1),[N,v]=a.useState(null),[g,f]=a.useState(""),[I,u]=a.useState(!1),R=t=>{const i=o.filter(r=>r.supplier_id===t),m=new Set(o.map(r=>r.supplier_id)).size>1;return i.map(r=>{const c=m&&r.unit_price_edited!=null,s=Number(c?r.unit_price_edited:r.unit_price);return{pr_detail_id:r.pr_detail_id,item:r.item,specs:r.specs,unit:r.unit,quantity:r.quantity,unit_price:s,total_price:Number(r.quantity)*s,priceSource:c?"As Calculated Price":"Quoted Price",supplier_id:t,supplier_total:r.supplier_total??null}})},{data:l,setData:d,post:E,processing:x,errors:n}=M({rfq_id:q.id,items:[]});a.useEffect(()=>{const t=h.flatMap(i=>R(i.id));d("items",t)},[h]);const k=()=>{if(!N)return;const{index:t,field:i,value:m}=N,r=[...l.items];r[t][i]=m,r[t].total_price=Number(r[t].quantity)*Number(r[t].unit_price),r[t].change_reason=g,d("items",r),v(null),f(""),b(!1)},w=t=>{t.preventDefault(),u(!0)},U=()=>{E(route("supply_officer.store_po"),{onFinish:()=>u(!1)})};return e.jsxs($,{header:"Schools Divisions Office - Ilagan | Create Purchase Order",children:[e.jsx(Q,{title:`Create PO for PR #${y.pr_number}`}),e.jsxs("form",{onSubmit:w,className:"bg-white p-6 rounded shadow mx-auto max-w-6xl",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Create PO for PR #",y.pr_number]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"mode_of_procurement",className:"block font-semibold mb-2",children:["Mode of Procurement ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"mode_of_procurement",name:"mode_of_procurement",value:l.mode_of_procurement||"",onChange:t=>d("mode_of_procurement",t.target.value),className:"border rounded px-3 py-2 w-full",placeholder:"Enter mode of procurement...",required:!0}),n.mode_of_procurement&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.mode_of_procurement})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"delivery_term",className:"block font-semibold mb-2",children:["Delivery Term ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"delivery_term",name:"delivery_term",value:l.delivery_term||"",onChange:t=>d("delivery_term",t.target.value),className:"border rounded px-3 py-2 w-full",placeholder:"Enter Delivery Term...",required:!0}),n.delivery_term&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.delivery_term})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"payment_term",className:"block font-semibold mb-2",children:["Payment Term ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"payment_term",name:"payment_term",value:l.payment_term||"",onChange:t=>d("payment_term",t.target.value),className:"border rounded px-3 py-2 w-full",placeholder:"Enter Payment Term...",required:!0}),n.payment_term&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.payment_term})]}),h.map(t=>{var r,c;const i=l.items.filter(s=>s.supplier_id===t.id);(r=i.find(s=>s.supplier_total!==null))==null||r.supplier_total;const m=((c=o.find(s=>s.supplier_id===t.id))==null?void 0:c.supplier_total)||i.reduce((s,L)=>s+Number(L.total_price),0);return e.jsxs("div",{className:"mb-8 border rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-3 font-semibold text-lg",children:["Supplier: ",t.company_name]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-separate border-spacing-0 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-y border-l px-4 py-2 text-left",children:"Item"}),e.jsx("th",{className:"border-y px-4 py-2 text-left",children:"Specs"}),e.jsx("th",{className:"border-y px-4 py-2 text-center",children:"Unit"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"border-y px-4 py-2 text-right",children:"Total Price"})]})}),e.jsxs("tbody",{children:[i.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border-b border-l px-4 py-2",children:s.item}),e.jsx("td",{className:"border-b px-4 py-2 text-gray-600",children:s.specs}),e.jsx("td",{className:"border-b px-4 py-2 text-center",children:s.unit}),e.jsx("td",{className:"border-b px-4 py-2 text-right",children:s.quantity}),e.jsxs("td",{className:"border-b px-4 py-2 text-right",children:["₱",Number(s.unit_price).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),e.jsx("div",{className:`text-xs ${s.priceSource==="Quoted Price"?"text-green-600":"text-gray-500"}`,children:s.priceSource})]}),e.jsxs("td",{className:"border-b px-4 py-2 text-right",children:["₱",(s.unit_price*s.quantity).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},`${t.id}-${s.pr_detail_id}`)),e.jsxs("tr",{className:"bg-gray-100 font-semibold",children:[e.jsx("td",{colSpan:"5",className:"border-t px-4 py-2 text-right",children:"Supplier Total:"}),e.jsxs("td",{className:"border-t border-r px-4 py-2 text-right",children:["₱",m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]},t.id)}),e.jsx(p,{type:"submit",disabled:x||l.items.length===0,className:"mt-6",children:x?"Submitting...":"Submit Purchase Order"})]}),e.jsx(S,{open:I,onOpenChange:u,children:e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"text-yellow-500"}),"Confirm Submission"]}),e.jsx(O,{className:"pt-4 text-base",children:"Are you sure you want to create this Purchase Order? Please review the items and quantities before proceeding."})]}),e.jsxs(F,{children:[e.jsx(p,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(p,{onClick:U,disabled:x,className:"bg-green-600 hover:bg-green-700",children:x?"Submitting...":"Confirm & Create PO"})]})]})}),e.jsx(S,{open:T,onOpenChange:b,children:e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsx(P,{children:"Reason for Quantity Change"}),e.jsx(O,{className:"pt-2",children:"You changed the quantity from the original PR. Please provide a reason for this adjustment."})]}),e.jsx("textarea",{value:g,onChange:t=>f(t.target.value),className:"w-full border rounded px-3 py-2 mt-3",rows:"3",placeholder:"Enter reason..."}),e.jsxs(F,{children:[e.jsx(p,{variant:"outline",onClick:()=>{b(!1),v(null),f("")},children:"Cancel"}),e.jsx(p,{onClick:k,disabled:!g.trim(),className:"bg-blue-600 hover:bg-blue-700",children:"Save Change"})]})]})})]})}export{oe as default};
