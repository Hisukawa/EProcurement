import{a as O,u as T,j as e,H as $}from"./app-Co243ZaK.js";import{u as L}from"./use-toast-DBpKaziH.js";import{D as U,a as Y,b as G,c as J,d as K,e as V}from"./dialog-B4XRAFoM.js";import{B as p}from"./button-CcwOA2f3.js";import{S as W}from"./SupplyOfficerLayout-BEUvgncf.js";import{F as X}from"./file-text-BDO9e2m7.js";import{S as Z}from"./send-horizontal-UCNE4kLo.js";import"./index-CFFGr-P-.js";import"./index-CAOfQLec.js";import"./createLucideIcon-B43mRYUV.js";import"./utils-BrL_nbis.js";import"./index-x-JSpzr6.js";import"./toaster-CrrGiM3z.js";import"./index-r_rZfXCh.js";import"./Dropdown-CWPfPWSq.js";import"./transition-BwBs8U8x.js";import"./XMarkIcon-Csb-rXM3.js";import"./clipboard-check-DekS40nl.js";import"./package-check-D696je3u.js";import"./trash-DrI2IRKE.js";function ve({record:t,user:ee,type:se,rrsp_number:Q,selected_items:d}){var j,f,N,v;const B=O.useMemo(()=>{var s;return!Array.isArray(d)||d.length===0?(t==null?void 0:t.items)??[]:((s=t==null?void 0:t.items)==null?void 0:s.filter(a=>{var i;return d.includes((i=a.id)==null?void 0:i.toString())}))??[]},[t,d]),{data:l,setData:o,errors:y,processing:b,post:E}=T({rrsp_number:Q??"",ics_number:((j=t==null?void 0:t.po)==null?void 0:j.po_number)??"",items:B.map(s=>{var r,_,w,R,q,S,C,D,I,k,F,A;const a=Number(s.quantity??0),i=Array.isArray(s.reissued_item)?s.reissued_item.reduce((c,x)=>c+Number(x.quantity??0),0):Number(((r=s.reissued_item)==null?void 0:r.quantity)??0),n=Array.isArray(s.disposed_item)?s.disposed_item.reduce((c,x)=>c+Number(x.quantity??0),0):Number(((_=s.disposed_item)==null?void 0:_.quantity)??0),m=Math.max(a-(i+n),0);return{inventory_item_id:s.inventory_item_id,returned_by:((w=t==null?void 0:t.requested_by)==null?void 0:w.id)??((R=t==null?void 0:t.received_from)==null?void 0:R.id)??"",quantity:m,max_quantity:m,remarks:"",item_desc:((q=s.inventory_item)==null?void 0:q.item_desc)??((C=(S=s.inventoryItem)==null?void 0:S.product)==null?void 0:C.name)??"N/A",unit:((I=(D=s.inventory_item)==null?void 0:D.unit)==null?void 0:I.unit_name)??((A=(F=(k=s.inventoryItem)==null?void 0:k.product)==null?void 0:F.unit)==null?void 0:A.unit_name)??""}})}),[H,u]=O.useState(!1),{toast:h}=L(),z=`${((f=t==null?void 0:t.requested_by)==null?void 0:f.firstname)??""} ${((N=t==null?void 0:t.requested_by)==null?void 0:N.middlename)??""} ${((v=t==null?void 0:t.requested_by)==null?void 0:v.lastname)??""}`.trim(),g=(s,a,i)=>{const n=[...l.items];if(a==="quantity"){const m=n[s].max_quantity;let r=parseFloat(i);(isNaN(r)||r<0)&&(r=0),r>m&&(r=m),n[s][a]=r}else n[s][a]=i;o("items",n)},M=s=>{s.preventDefault(),u(!0)},P=()=>{E(route("supply_officer.submit_return"),{...l,preserveScroll:!0,onSuccess:()=>{u(!1),h({title:"Return Recorded",description:"Items successfully reissued!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{h({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})};return e.jsxs(W,{header:"Schools Division Office - Ilagan | Reissuance Form",children:[e.jsx($,{title:"Return Form"}),e.jsx("div",{className:"flex items-center justify-center py-10 px-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg w-full max-w-7xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6",children:[e.jsx(X,{className:"text-blue-700",size:30}),e.jsx("h2",{className:"text-3xl font-bold text-blue-800",children:"Reissuance/Reissuance Form"})]}),Object.keys(y).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(y).map(([s,a])=>e.jsx("li",{children:a},s))})}),e.jsxs("form",{onSubmit:M,className:"space-y-5",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Returned By / End-User"}),e.jsx("input",{type:"text",value:z,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RRSP No."}),e.jsx("input",{type:"text",value:l.rrsp_number,onChange:s=>o("rrsp_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ICS / PAR / RIS No."}),e.jsx("input",{type:"text",value:l.ics_number,onChange:s=>o("ics_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:"Reissued Items"}),e.jsx("div",{className:"overflow-x-auto border rounded-md shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-blue-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Item Description"}),e.jsx("th",{className:"p-2 border w-24 text-center",children:"Qty"}),e.jsx("th",{className:"p-2 border",children:"Remarks"})]})}),e.jsx("tbody",{children:l.items.map((s,a)=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:s.item_desc}),e.jsxs("td",{className:"p-2 border text-center",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",max:s.max_quantity,value:s.quantity,onChange:i=>g(a,"quantity",i.target.value),className:"w-20 text-center border-gray-300 rounded-md p-1"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",s.max_quantity]})]}),e.jsx("td",{className:"p-2 border",children:e.jsx("textarea",{value:s.remarks,onChange:i=>g(a,"remarks",i.target.value),className:"w-full border-gray-300 rounded-md text-sm p-1"})})]},a))})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(p,{type:"submit",className:"flex items-center gap-2 px-6 py-2 bg-blue-700 hover:bg-blue-800 text-white font-medium rounded-md transition",disabled:b,children:[e.jsx(Z,{size:16}),b?"Saving...":"Confirm"]})})]})]})}),e.jsx(U,{open:H,onOpenChange:u,children:e.jsxs(Y,{className:"sm:max-w-md",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Confirm Return"}),e.jsx(K,{children:"Are you sure you want to record this Return?"})]}),e.jsxs(V,{className:"mt-4",children:[e.jsx(p,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(p,{onClick:P,children:"Yes, Record Return"})]})]})})]})}export{ve as default};
