import{a as d,u as V,j as e}from"./app-Bm7zSS5T.js";import{u as X}from"./use-toast-DGq61Nap.js";import L from"./AutoCompleteInput-DGvC91WG.js";import{F as Z}from"./file-text-9-lXCBhD.js";import{S as ee}from"./send-horizontal-B01i6pdb.js";import"./createLucideIcon-DyDUFioL.js";function ie({purchaseOrder:h,inventoryItem:g,user:y,ppeOptions:f}){var C,k,I,E,$;const[O,p]=d.useState(!1),{toast:j}=X(),[l,P]=d.useState(null),[i,v]=d.useState(null),[a,U]=d.useState(null),[n,z]=d.useState(null),[m,N]=d.useState("0001"),[G,B]=d.useState(""),t=h.detail,o=(C=t==null?void 0:t.pr_detail)==null?void 0:C.purchase_request,x=(k=t==null?void 0:t.pr_detail)==null?void 0:k.product,H=o?`${o.focal_person.firstname} ${o.focal_person.middlename} ${o.focal_person.lastname}`:"N/A",Q=x?`${x.name} (${x.specs})`:"N/A",_=(l==null?void 0:l.general_ledger_accounts)??[],{data:c,setData:r,post:W,processing:w,errors:S}=V({po_id:(t==null?void 0:t.po_id)??null,ics_number:(h==null?void 0:h.po_number)??"",requested_by:((I=o==null?void 0:o.focal_person)==null?void 0:I.id)??null,received_from:(y==null?void 0:y.id)??null,remarks:"",items:[{inventory_item_id:(g==null?void 0:g.id)??null,estimated_useful_life:null,inventory_item_number:"",ppe_sub_major_account:"",general_ledger_account:"",office:"",quantity:(t==null?void 0:t.quantity)??0,unit_cost:(t==null?void 0:t.unit_price)??0,total_cost:(t==null?void 0:t.total_price)??0,series_number:m}]});c.items[0].unit_cost<=5e3,d.useEffect(()=>{!l||!i||fetch(`/api/ics-next-series?ppe=${encodeURIComponent(l.name.trim())}&gl=${encodeURIComponent(i.name.trim())}`).then(s=>s.json()).then(s=>{s.series&&(N(s.series),r("items.0.series_number",s.series))}).catch(()=>{N(1),r("items.0.series_number",1)})},[l,i,a,n]),d.useEffect(()=>{var R,T,D;if(!l||!i||!m)return;const s=new Date().getFullYear().toString(),u=((R=l.code)==null?void 0:R.padStart(2,"0"))||"00",b=((T=i.code)==null?void 0:T.padStart(2,"0"))||"00",K=m==null?void 0:m.toString().padStart(4,"0"),M=((D=a==null?void 0:a.code)==null?void 0:D.padStart(2,"0"))||"",A=(a==null?void 0:a.name)==="Schools"&&(n!=null&&n.code)?n.code.padStart(2,"0"):"";let q=[s,u,b,K,M];A&&q.push(A);const F=q.filter(Boolean).join("-");B(F),r("items.0.inventory_item_number",F),r("items.0.ppe_sub_major_account",l.name||""),r("items.0.general_ledger_account",i.name||""),r("items.0.office",(a==null?void 0:a.name)||""),r("items.0.series_number",parseInt(m,10)),n&&r("items.0.school",n.name||"")},[l,i,a,n,m]);const Y=s=>{s.preventDefault(),p(!0)},J=()=>{W(route("supply_officer.store_ics"),{preserveScroll:!0,onSuccess:()=>{j({title:"✅ Success",description:"ICS issuance submitted successfully!",className:"bg-green-600 text-white"}),p(!1)},onError:()=>{j({title:"❌ Error",description:"Failed to submit ICS issuance.",variant:"destructive"}),p(!1)}})};return e.jsxs("div",{className:"bg-blue-50 p-8 rounded-xl shadow-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 mb-1 flex items-center gap-2",children:[e.jsx(Z,{size:24})," Inventory Custodian Slip (ICS)"]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-6",children:[e.jsx("strong",{children:"Note:"})," This is the Inventory Custodian Slip (ICS) form page. Fill out the details below to record an ICS issuance."]}),Object.keys(S).length>0&&e.jsx("div",{className:"col-span-2 bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(S).map(([s,u])=>e.jsx("li",{children:u},s))})}),e.jsxs("form",{onSubmit:Y,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{value:((E=o==null?void 0:o.division)==null?void 0:E.division)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ICS No."}),e.jsx("input",{type:"text",value:c.ics_number,onChange:s=>r("ics_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("input",{value:Q,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",value:c.items[0].quantity,onChange:s=>r("items.0.quantity",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit"}),e.jsx("input",{value:(($=x==null?void 0:x.unit)==null?void 0:$.unit)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),e.jsx("input",{type:"number",value:c.items[0].unit_cost,onChange:s=>r("items.0.unit_cost",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),e.jsx("input",{type:"number",value:c.items[0].total_cost,onChange:s=>r("items.0.total_cost",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested By"}),e.jsx("input",{type:"text",value:H,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PPE Sub-major Account"}),e.jsxs("select",{value:(l==null?void 0:l.id)||"",onChange:s=>{const u=f.find(b=>b.id==s.target.value);P(u||null),v(null)},className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsx("option",{value:"",children:"Select PPE"}),f.map(s=>e.jsx("option",{value:s.id,children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"General Ledger Account"}),e.jsxs("select",{value:(i==null?void 0:i.id)||"",onChange:s=>{const u=_.find(b=>b.id==s.target.value);v(u||null)},disabled:!l,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select GL"}),_.map(s=>e.jsx("option",{value:s.id,children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsx(L,{label:"Location Office",apiRoute:"/api/office-search",value:(a==null?void 0:a.code)||"",onChange:U,placeholder:"Type Location Office..."}),(a==null?void 0:a.name)==="Schools"&&e.jsx(L,{label:"School",apiRoute:"/api/school-search",value:(n==null?void 0:n.name)||"",onChange:z,placeholder:"Type School..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Inventory Item No."}),e.jsx("input",{type:"text",value:G,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100"})]}),e.jsx("input",{type:"number",value:c.items[0].estimated_useful_life??"",onChange:s=>r("items.0.estimated_useful_life",s.target.value),placeholder:"Enter Estimated Useful Life in years (optional)",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white",onWheel:s=>s.currentTarget.blur()}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:c.remarks,onChange:s=>r("remarks",s.target.value),rows:"4",placeholder:"Enter remarks (optional)",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsx("div",{className:"col-span-full flex justify-end mt-4",children:e.jsxs("button",{type:"submit",disabled:w,className:"inline-flex items-center px-6 py-2 bg-blue-700 text-white text-sm font-medium rounded-md hover:bg-blue-800 transition disabled:opacity-50",children:[e.jsx(ee,{size:16,className:"mr-2"}),w?"Submitting...":"Submit Issuance"]})})]}),O&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Confirm Submission"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to submit this ICS issuance?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:J,className:"px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",children:"Confirm"})]})]})})]})}export{ie as default};
