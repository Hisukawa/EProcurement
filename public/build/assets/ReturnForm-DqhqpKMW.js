import{a as I,u as E,j as e,H}from"./app-Cs1McY02.js";import{u as z}from"./use-toast-RAxD_qPw.js";import{D as M,a as P,b as T,c as $,d as L,e as U}from"./dialog-AyJe73wc.js";import{B as p}from"./button-rqNSa_DM.js";import{S as Y}from"./SupplyOfficerLayout-SWi0o-s2.js";import{F as G}from"./file-text--pdc2I_9.js";import{S as J}from"./send-horizontal-CkakJS97.js";import"./index-CnXzlo42.js";import"./index-DmEAzzlf.js";import"./createLucideIcon-CAyUIJle.js";import"./utils-BVseyFTm.js";import"./index-mEOC90f-.js";import"./toaster-CNCOgU5M.js";import"./index-OUqkuChP.js";import"./Dropdown-ckgaHpXR.js";import"./transition-1OrjVXTB.js";import"./XMarkIcon-DDKr4MYC.js";import"./clipboard-check-BH2-nbLx.js";import"./package-check-CNnh4aWJ.js";import"./trash-DcaSG3EI.js";function he({record:r,user:K,type:V,rrsp_number:k,selected_items:o}){var f;const y=I.useMemo(()=>{var s;return!Array.isArray(o)||o.length===0?(r==null?void 0:r.items)??[]:((s=r==null?void 0:r.items)==null?void 0:s.filter(t=>{var a;return o.includes((a=t.id)==null?void 0:a.toString())}))??[]},[r,o]),A=Array.from(new Set(y.map(s=>{if(s.recipient)return s.recipient;const t=(r==null?void 0:r.requested_by)||(r==null?void 0:r.received_from);return t?`${t.firstname??""} ${t.middlename??""} ${t.lastname??""}`.trim():""}).filter(Boolean))).join(", "),{data:l,setData:u,errors:b,processing:h,post:F}=E({rrsp_number:k??"",ics_number:((f=r==null?void 0:r.po)==null?void 0:f.po_number)??"",items:y.map(s=>{var i,N,v,_,w,R,S,q,C,D;const t=Number(s.quantity??0),a=Array.isArray(s.reissued_item)?s.reissued_item.reduce((c,x)=>c+Number(x.quantity??0),0):Number(((i=s.reissued_item)==null?void 0:i.quantity)??0),n=Array.isArray(s.disposed_item)?s.disposed_item.reduce((c,x)=>c+Number(x.quantity??0),0):Number(((N=s.disposed_item)==null?void 0:N.quantity)??0),m=Math.max(t-(a+n),0);return{inventory_item_id:s.inventory_item_id,quantity:m,max_quantity:m,remarks:"",returned_by:s.recipient??"",item_desc:((v=s.inventory_item)==null?void 0:v.item_desc)??((w=(_=s.inventoryItem)==null?void 0:_.product)==null?void 0:w.name)??"N/A",unit:((S=(R=s.inventory_item)==null?void 0:R.unit)==null?void 0:S.unit_name)??((D=(C=(q=s.inventoryItem)==null?void 0:q.product)==null?void 0:C.unit)==null?void 0:D.unit_name)??""}})}),[O,d]=I.useState(!1),{toast:g}=z(),j=(s,t,a)=>{const n=[...l.items];if(t==="quantity"){const m=n[s].max_quantity;let i=parseFloat(a);(isNaN(i)||i<0)&&(i=0),i>m&&(i=m),n[s][t]=i}else n[s][t]=a;u("items",n)},B=s=>{s.preventDefault(),d(!0)},Q=()=>{F(route("supply_officer.submit_return"),{...l,preserveScroll:!0,onSuccess:()=>{d(!1),g({title:"Return Recorded",description:"Items successfully reissued!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{g({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})};return e.jsxs(Y,{header:"Schools Division Office - Ilagan | Reissuance Form",children:[e.jsx(H,{title:"Return Form"}),e.jsx("div",{className:"flex items-center justify-center py-10 px-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg w-full max-w-7xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6",children:[e.jsx(G,{className:"text-blue-700",size:30}),e.jsx("h2",{className:"text-3xl font-bold text-blue-800",children:"Reissuance/Reissuance Form"})]}),Object.keys(b).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(b).map(([s,t])=>e.jsx("li",{children:t},s))})}),e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Returned By / End-User"}),e.jsx("input",{type:"text",value:A,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RRSP No."}),e.jsx("input",{type:"text",value:l.rrsp_number,onChange:s=>u("rrsp_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ICS / PAR / RIS No."}),e.jsx("input",{type:"text",value:l.ics_number,onChange:s=>u("ics_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:"Reissued Items"}),e.jsx("div",{className:"overflow-x-auto border rounded-md shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-blue-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Item Description"}),e.jsx("th",{className:"p-2 border w-24 text-center",children:"Qty"}),e.jsx("th",{className:"p-2 border",children:"Remarks"})]})}),e.jsx("tbody",{children:l.items.map((s,t)=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:s.item_desc}),e.jsxs("td",{className:"p-2 border text-center",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",max:s.max_quantity,value:s.quantity,onChange:a=>j(t,"quantity",a.target.value),className:"w-20 text-center border-gray-300 rounded-md p-1"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Max: ",s.max_quantity]})]}),e.jsx("td",{className:"p-2 border",children:e.jsx("textarea",{value:s.remarks,onChange:a=>j(t,"remarks",a.target.value),className:"w-full border-gray-300 rounded-md text-sm p-1"})})]},t))})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(p,{type:"submit",className:"flex items-center gap-2 px-6 py-2 bg-blue-700 hover:bg-blue-800 text-white font-medium rounded-md transition",disabled:h,children:[e.jsx(J,{size:16}),h?"Saving...":"Confirm"]})})]})]})}),e.jsx(M,{open:O,onOpenChange:d,children:e.jsxs(P,{className:"sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx($,{children:"Confirm Return"}),e.jsx(L,{children:"Are you sure you want to record this Return?"})]}),e.jsxs(U,{className:"mt-4",children:[e.jsx(p,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(p,{onClick:Q,children:"Yes, Record Return"})]})]})})]})}export{he as default};
