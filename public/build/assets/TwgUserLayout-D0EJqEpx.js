import{b as I,a,j as e,L as w,d as h}from"./app-CKujYd7_.js";import{N as j,D as l}from"./Dropdown-CeA5lpHF.js";import{l as y,F as P,T}from"./toaster-BC5ooZuz.js";import{F as $,d as O}from"./index-6toc2nnT.js";import{F as A,a as U}from"./XMarkIcon-CQ1f9l2a.js";import{C as B}from"./clipboard-check-D6W4U-7k.js";function J({header:v,children:N}){const{user:u}=I().props.auth,[b,k]=a.useState(new Date),[c,L]=a.useState(!1),[F,f]=a.useState(!1),[r,d]=a.useState([]),x=a.useRef(null),g=r.filter(t=>!t.read).length,[_,C]=a.useState(""),[S,p]=a.useState(!1),[m,R]=a.useState(!1);a.useEffect(()=>{const t=setInterval(()=>k(new Date),1e3);return()=>clearInterval(t)},[]),a.useEffect(()=>{const t=async()=>{try{const n=(await h.get("/notifications")).data.map(o=>({...o,read:o.read_at!==null})),M=n.filter(o=>!o.read).length,z=r.filter(o=>!o.read).length;m&&M>z&&D("ðŸ“¬ A purchase request has been submitted!"),d(n),m||R(!0)}catch(i){console.error("Error fetching notifications:",i)}};t();const s=setInterval(t,1e4);return()=>clearInterval(s)},[r,m]),a.useEffect(()=>{function t(s){x.current&&!x.current.contains(s.target)&&f(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const D=t=>{C(t),p(!0),setTimeout(()=>p(!1),1e4)};b.toLocaleString("en-PH",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0});const E=async t=>{var s;try{await h.post(`/notifications/${t.id}/read`),d(i=>i.map(n=>n.id===t.id?{...n,read:!0}:n)),(s=t.data)!=null&&s.pr_id&&O.Inertia.visit(route("twg_user.show_details",t.data.pr_id))}catch(i){console.error("Failed to mark notification as read:",i)}};return e.jsxs(e.Fragment,{children:[S&&e.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-indigo-600 text-white px-6 py-4 rounded-lg shadow-lg z-50 animate-pulse text-lg font-semibold",children:_}),e.jsxs("div",{className:"min-h-screen flex flex-col md:flex-row bg-gray-100",children:[e.jsxs("div",{className:"md:hidden bg-gray-900 text-white flex items-center justify-between px-4 py-3 shadow-md",children:[e.jsx(w,{href:"/",children:e.jsx("img",{src:y,alt:"Logo",className:"h-10 w-auto"})}),e.jsx("button",{onClick:()=>L(!c),className:"focus:outline-none",children:c?e.jsx(A,{className:"h-6 w-6"}):e.jsx(U,{className:"h-6 w-6"})})]}),e.jsx("aside",{className:`${c?"block":"hidden"} md:block md:w-64 w-full bg-gray-900 text-white md:sticky md:top-0 h-screen sticky z-50`,children:e.jsxs("div",{className:"p-6 flex flex-col h-full",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(w,{href:"/",children:e.jsx("img",{src:y,alt:"Department Logo",className:"h-20 w-[200px] object-contain",draggable:"false"})})}),e.jsx("div",{className:"text-center text-xs text-gray-400 font-mono mb-6 select-none",children:"Supply & Property Office"}),e.jsxs("nav",{className:"flex flex-col gap-2",children:[e.jsxs(j,{href:route("twg_user.dashboard"),active:route().current("twg_user.dashboard"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(P,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Dashboard"})]}),e.jsxs(j,{href:route("twg_user.for_review"),active:route().current("twg_user.for_review"),className:"flex items-center gap-2 px-4 py-2 hover:bg-indigo-600 rounded-lg",children:[e.jsx(B,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-white font-medium",children:"Purchase Requests"})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("header",{className:"bg-white shadow sticky top-0 z-30 px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:v||"Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"e-Procurement & Inventory Management System"})]}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>f(t=>!t),className:"relative focus:outline-none",children:[e.jsx($,{className:"w-6 h-6 text-gray-600 hover:text-gray-800"}),g>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full px-1.5 py-0.5",children:g})]}),F&&e.jsxs("div",{ref:x,className:"absolute right-0 top-8 w-96 bg-white border border-gray-200 rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-gray-50 text-sm font-semibold text-gray-700",children:"Notifications"}),r.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-center text-gray-500",children:"You're all caught up!"}):e.jsx("ul",{className:"max-h-[420px] overflow-y-auto divide-y divide-gray-100",children:r.sort((t,s)=>new Date(s.created_at)-new Date(t.created_at)).slice(0,10).map(t=>{var s;return e.jsxs("li",{onClick:()=>E(t),className:`flex items-start gap-3 px-4 py-3 cursor-pointer hover:bg-gray-50 transition duration-150 ${t.read?"bg-white text-gray-500":"bg-gray-50 text-gray-900 font-semibold"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:t.read?e.jsx("svg",{className:"w-5 h-5 text-gray-300",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 17h5l-1.405-1.405M19.595 15.595A2.1 2.1 0 0120 14.5V11a8.001 8.001 0 00-6.536-7.874m0 0A8 8 0 0119 11v3.5c0 .397.158.779.439 1.06M12.5 21a3.5 3.5 0 01-3.5-3.5"})}):e.jsx("svg",{className:"w-5 h-5 text-indigo-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586L2.707 14.879a1 1 0 001.414 1.414L6 14.414V16a2 2 0 002 2h4a2 2 0 002-2v-1.586l1.879 1.879a1 1 0 001.414-1.414L16 11.586V8a6 6 0 00-6-6z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm leading-tight",children:((s=t.data)==null?void 0:s.message)||t.message||"You have a new notification."}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs",children:[e.jsx("span",{className:"text-gray-400",children:new Date(t.created_at).toLocaleString("en-PH",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),t.read?e.jsx("span",{className:"text-gray-400",children:"Read"}):e.jsx("span",{className:"text-blue-500 font-medium",children:"Unread"})]})]})]},t.id)})}),r.some(t=>!t.read)&&e.jsx("button",{onClick:async()=>{try{await Promise.all(r.map(t=>t.read?null:h.post(`/notifications/${t.id}/read`))),d(t=>t.map(s=>({...s,read:!0})))}catch(t){console.error("Failed to mark all as read:",t)}},className:"w-full text-center py-3 text-sm text-indigo-600 hover:bg-gray-100 border-t",children:"Mark all as read"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(l,{children:[e.jsx(l.Trigger,{children:e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 cursor-pointer",children:[u.firstname," ",u.lastname,e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),e.jsxs(l.Content,{children:[e.jsx(l.Link,{href:route("profile.edit"),children:"Profile"}),e.jsx(l.Link,{href:route("logout"),method:"post",as:"button",children:"Log Out"})]})]})})]})]}),e.jsx("main",{className:"p-6 flex-1 overflow-y-auto bg-gray-300",children:N}),e.jsx(T,{})]})]})]})}export{J as T};
