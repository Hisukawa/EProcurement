import{R as Oe,r as d,u as bt,a as gt,j as t,H as xt,b as me,c as ht}from"./app-D3NzBgRO.js";import{A as vt}from"./ApproverLayout-BfaXJkJ8.js";import{D as Te,a as Fe,b as Le,c as ke,d as De,e as Ae}from"./dialog-CCQ3M8yy.js";import{S as ee}from"./sweetalert2.esm.all-Bj_ZQUAw.js";import{u as yt}from"./toaster-Dr1dFrOI.js";import{S as wt}from"./scroll-text-C0-Z0Y8E.js";import{F as $t}from"./file-plus-2-BV3WqhP0.js";import{F as jt}from"./PencilSquareIcon-DxAK6CCk.js";import{T as Et}from"./trash-2-DQXbC8J6.js";import{S as St}from"./save-DFBSXXiN.js";import{C as Nt}from"./circle-check-BF6yM4HD.js";import{l as _t,a as Ct,n as Pt}from"./disabled-BeOuaVS-.js";import{p as Tt,o as Me,Y as Ft,V as Lt,K as kt}from"./transition-K1sFJhZS.js";import"./Dropdown-DIPhf4Q5.js";import"./XMarkIcon-B2PBuBOA.js";import"./ClipboardDocumentIcon-BVAgHJPf.js";import"./clipboard-check-CEqv347t.js";import"./index-CbOhMk15.js";import"./index-CzZBlPTW.js";import"./index-CRtz_FGu.js";import"./circle-check-big-HBgRE7qP.js";import"./file-text-C4f0hJf9.js";import"./BellAlertIcon-EVvYTPtN.js";import"./index-BURmFptD.js";const Be=typeof document<"u"?Oe.useLayoutEffect:()=>{};var be;const Dt=(be=Oe.useInsertionEffect)!==null&&be!==void 0?be:Be;function At(e){const r=d.useRef(null);return Dt(()=>{r.current=e},[e]),d.useCallback((...s)=>{const i=r.current;return i==null?void 0:i(...s)},[])}const M=e=>{var r;return(r=e==null?void 0:e.ownerDocument)!==null&&r!==void 0?r:document},H=e=>e&&"window"in e&&e.window===e?e:M(e).defaultView||window;function Mt(e){return e!==null&&typeof e=="object"&&"nodeType"in e&&typeof e.nodeType=="number"}function Ht(e){return Mt(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"host"in e}let Ot=!1;function we(){return Ot}function Re(e,r){if(!we())return r&&e?e.contains(r):!1;if(!e||!r)return!1;let s=r;for(;s!==null;){if(s===e)return!0;s.tagName==="SLOT"&&s.assignedSlot?s=s.assignedSlot.parentNode:Ht(s)?s=s.host:s=s.parentNode}return!1}const ge=(e=document)=>{var r;if(!we())return e.activeElement;let s=e.activeElement;for(;s&&"shadowRoot"in s&&(!((r=s.shadowRoot)===null||r===void 0)&&r.activeElement);)s=s.shadowRoot.activeElement;return s};function Ie(e){return we()&&e.target.shadowRoot&&e.composedPath?e.composedPath()[0]:e.target}function Bt(e){var r;if(typeof window>"u"||window.navigator==null)return!1;let s=(r=window.navigator.userAgentData)===null||r===void 0?void 0:r.brands;return Array.isArray(s)&&s.some(i=>e.test(i.brand))||e.test(window.navigator.userAgent)}function Rt(e){var r;return typeof window<"u"&&window.navigator!=null?e.test(((r=window.navigator.userAgentData)===null||r===void 0?void 0:r.platform)||window.navigator.platform):!1}function We(e){let r=null;return()=>(r==null&&(r=e()),r)}const It=We(function(){return Rt(/^Mac/i)}),Wt=We(function(){return Bt(/Android/i)});function Qe(){let e=d.useRef(new Map),r=d.useCallback((a,p,m,u)=>{let b=u!=null&&u.once?(...g)=>{e.current.delete(m),m(...g)}:m;e.current.set(m,{type:p,eventTarget:a,fn:b,options:u}),a.addEventListener(p,b,u)},[]),s=d.useCallback((a,p,m,u)=>{var b;let g=((b=e.current.get(m))===null||b===void 0?void 0:b.fn)||m;a.removeEventListener(p,g,u),e.current.delete(m)},[]),i=d.useCallback(()=>{e.current.forEach((a,p)=>{s(a.eventTarget,a.type,p,a.options)})},[s]);return d.useEffect(()=>i,[i]),{addGlobalListener:r,removeGlobalListener:s,removeAllGlobalListeners:i}}function Qt(e){return e.pointerType===""&&e.isTrusted?!0:Wt()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function Ve(e){let r=e;return r.nativeEvent=e,r.isDefaultPrevented=()=>r.defaultPrevented,r.isPropagationStopped=()=>r.cancelBubble,r.persist=()=>{},r}function Vt(e,r){Object.defineProperty(e,"target",{value:r}),Object.defineProperty(e,"currentTarget",{value:r})}function Ge(e){let r=d.useRef({isFocused:!1,observer:null});Be(()=>{const i=r.current;return()=>{i.observer&&(i.observer.disconnect(),i.observer=null)}},[]);let s=At(i=>{e==null||e(i)});return d.useCallback(i=>{if(i.target instanceof HTMLButtonElement||i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLSelectElement){r.current.isFocused=!0;let a=i.target,p=m=>{if(r.current.isFocused=!1,a.disabled){let u=Ve(m);s(u)}r.current.observer&&(r.current.observer.disconnect(),r.current.observer=null)};a.addEventListener("focusout",p,{once:!0}),r.current.observer=new MutationObserver(()=>{if(r.current.isFocused&&a.disabled){var m;(m=r.current.observer)===null||m===void 0||m.disconnect();let u=a===document.activeElement?null:document.activeElement;a.dispatchEvent(new FocusEvent("blur",{relatedTarget:u})),a.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:u}))}}),r.current.observer.observe(a,{attributes:!0,attributeFilter:["disabled"]})}},[s])}let Gt=!1,q=null,xe=new Set,U=new Map,O=!1,he=!1;const Kt={Tab:!0,Escape:!0};function $e(e,r){for(let s of xe)s(e,r)}function Ut(e){return!(e.metaKey||!It()&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}function ne(e){O=!0,Ut(e)&&(q="keyboard",$e("keyboard",e))}function Q(e){q="pointer",(e.type==="mousedown"||e.type==="pointerdown")&&(O=!0,$e("pointer",e))}function Ke(e){Qt(e)&&(O=!0,q="virtual")}function Ue(e){e.target===window||e.target===document||Gt||!e.isTrusted||(!O&&!he&&(q="virtual",$e("virtual",e)),O=!1,he=!1)}function qe(){O=!1,he=!0}function ve(e){if(typeof window>"u"||typeof document>"u"||U.get(H(e)))return;const r=H(e),s=M(e);let i=r.HTMLElement.prototype.focus;r.HTMLElement.prototype.focus=function(){O=!0,i.apply(this,arguments)},s.addEventListener("keydown",ne,!0),s.addEventListener("keyup",ne,!0),s.addEventListener("click",Ke,!0),r.addEventListener("focus",Ue,!0),r.addEventListener("blur",qe,!1),typeof PointerEvent<"u"&&(s.addEventListener("pointerdown",Q,!0),s.addEventListener("pointermove",Q,!0),s.addEventListener("pointerup",Q,!0)),r.addEventListener("beforeunload",()=>{Ye(e)},{once:!0}),U.set(r,{focus:i})}const Ye=(e,r)=>{const s=H(e),i=M(e);r&&i.removeEventListener("DOMContentLoaded",r),U.has(s)&&(s.HTMLElement.prototype.focus=U.get(s).focus,i.removeEventListener("keydown",ne,!0),i.removeEventListener("keyup",ne,!0),i.removeEventListener("click",Ke,!0),s.removeEventListener("focus",Ue,!0),s.removeEventListener("blur",qe,!1),typeof PointerEvent<"u"&&(i.removeEventListener("pointerdown",Q,!0),i.removeEventListener("pointermove",Q,!0),i.removeEventListener("pointerup",Q,!0)),U.delete(s))};function qt(e){const r=M(e);let s;return r.readyState!=="loading"?ve(e):(s=()=>{ve(e)},r.addEventListener("DOMContentLoaded",s)),()=>Ye(e,s)}typeof document<"u"&&qt();function ze(){return q!=="pointer"}const Yt=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function zt(e,r,s){let i=M(s==null?void 0:s.target);const a=typeof window<"u"?H(s==null?void 0:s.target).HTMLInputElement:HTMLInputElement,p=typeof window<"u"?H(s==null?void 0:s.target).HTMLTextAreaElement:HTMLTextAreaElement,m=typeof window<"u"?H(s==null?void 0:s.target).HTMLElement:HTMLElement,u=typeof window<"u"?H(s==null?void 0:s.target).KeyboardEvent:KeyboardEvent;return e=e||i.activeElement instanceof a&&!Yt.has(i.activeElement.type)||i.activeElement instanceof p||i.activeElement instanceof m&&i.activeElement.isContentEditable,!(e&&r==="keyboard"&&s instanceof u&&!Kt[s.key])}function Xt(e,r,s){ve(),d.useEffect(()=>{let i=(a,p)=>{zt(!!(s!=null&&s.isTextInput),a,p)&&e(ze())};return xe.add(i),()=>{xe.delete(i)}},r)}function Jt(e){let{isDisabled:r,onFocus:s,onBlur:i,onFocusChange:a}=e;const p=d.useCallback(b=>{if(b.target===b.currentTarget)return i&&i(b),a&&a(!1),!0},[i,a]),m=Ge(p),u=d.useCallback(b=>{const g=M(b.target),E=g?ge(g):ge();b.target===b.currentTarget&&E===Ie(b.nativeEvent)&&(s&&s(b),a&&a(!0),m(b))},[a,s,m]);return{focusProps:{onFocus:!r&&(s||a||i)?u:void 0,onBlur:!r&&(i||a)?p:void 0}}}function Zt(e){let{isDisabled:r,onBlurWithin:s,onFocusWithin:i,onFocusWithinChange:a}=e,p=d.useRef({isFocusWithin:!1}),{addGlobalListener:m,removeAllGlobalListeners:u}=Qe(),b=d.useCallback(h=>{h.currentTarget.contains(h.target)&&p.current.isFocusWithin&&!h.currentTarget.contains(h.relatedTarget)&&(p.current.isFocusWithin=!1,u(),s&&s(h),a&&a(!1))},[s,a,p,u]),g=Ge(b),E=d.useCallback(h=>{if(!h.currentTarget.contains(h.target))return;const P=M(h.target),j=ge(P);if(!p.current.isFocusWithin&&j===Ie(h.nativeEvent)){i&&i(h),a&&a(!0),p.current.isFocusWithin=!0,g(h);let _=h.currentTarget;m(P,"focus",v=>{if(p.current.isFocusWithin&&!Re(_,v.target)){let S=new P.defaultView.FocusEvent("blur",{relatedTarget:v.target});Vt(S,_);let T=Ve(S);b(T)}},{capture:!0})}},[i,a,g,m,b]);return r?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:E,onBlur:b}}}let ye=!1,te=0;function er(){ye=!0,setTimeout(()=>{ye=!1},50)}function He(e){e.pointerType==="touch"&&er()}function tr(){if(!(typeof document>"u"))return te===0&&typeof PointerEvent<"u"&&document.addEventListener("pointerup",He),te++,()=>{te--,!(te>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",He)}}function rr(e){let{onHoverStart:r,onHoverChange:s,onHoverEnd:i,isDisabled:a}=e,[p,m]=d.useState(!1),u=d.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;d.useEffect(tr,[]);let{addGlobalListener:b,removeAllGlobalListeners:g}=Qe(),{hoverProps:E,triggerHoverEnd:h}=d.useMemo(()=>{let P=(v,S)=>{if(u.pointerType=S,a||S==="touch"||u.isHovered||!v.currentTarget.contains(v.target))return;u.isHovered=!0;let T=v.currentTarget;u.target=T,b(M(v.target),"pointerover",k=>{u.isHovered&&u.target&&!Re(u.target,k.target)&&j(k,k.pointerType)},{capture:!0}),r&&r({type:"hoverstart",target:T,pointerType:S}),s&&s(!0),m(!0)},j=(v,S)=>{let T=u.target;u.pointerType="",u.target=null,!(S==="touch"||!u.isHovered||!T)&&(u.isHovered=!1,g(),i&&i({type:"hoverend",target:T,pointerType:S}),s&&s(!1),m(!1))},_={};return typeof PointerEvent<"u"&&(_.onPointerEnter=v=>{ye&&v.pointerType==="mouse"||P(v,v.pointerType)},_.onPointerLeave=v=>{!a&&v.currentTarget.contains(v.target)&&j(v,v.pointerType)}),{hoverProps:_,triggerHoverEnd:j}},[r,s,i,a,u,b,g]);return d.useEffect(()=>{a&&h({currentTarget:u.target},u.pointerType)},[a]),{hoverProps:E,isHovered:p}}function nr(e={}){let{autoFocus:r=!1,isTextInput:s,within:i}=e,a=d.useRef({isFocused:!1,isFocusVisible:r||ze()}),[p,m]=d.useState(!1),[u,b]=d.useState(()=>a.current.isFocused&&a.current.isFocusVisible),g=d.useCallback(()=>b(a.current.isFocused&&a.current.isFocusVisible),[]),E=d.useCallback(j=>{a.current.isFocused=j,m(j),g()},[g]);Xt(j=>{a.current.isFocusVisible=j,g()},[],{isTextInput:s});let{focusProps:h}=Jt({isDisabled:i,onFocusChange:E}),{focusWithinProps:P}=Zt({isDisabled:!i,onFocusWithinChange:E});return{isFocused:p,isFocusVisible:u,focusProps:i?P:h}}function sr(e){let r=e.width/2,s=e.height/2;return{top:e.clientY-s,right:e.clientX+r,bottom:e.clientY+s,left:e.clientX-r}}function ir(e,r){return!(!e||!r||e.right<r.left||e.left>r.right||e.bottom<r.top||e.top>r.bottom)}function or({disabled:e=!1}={}){let r=d.useRef(null),[s,i]=d.useState(!1),a=Tt(),p=Me(()=>{r.current=null,i(!1),a.dispose()}),m=Me(u=>{if(a.dispose(),r.current===null){r.current=u.currentTarget,i(!0);{let b=_t(u.currentTarget);a.addEventListener(b,"pointerup",p,!1),a.addEventListener(b,"pointermove",g=>{if(r.current){let E=sr(g);i(ir(E,r.current.getBoundingClientRect()))}},!1),a.addEventListener(b,"pointercancel",p,!1)}}});return{pressed:s,pressProps:e?{}:{onPointerDown:m,onPointerUp:p,onClick:p}}}let ar="button";function lr(e,r){var s;let i=Ct(),{disabled:a=i||!1,autoFocus:p=!1,...m}=e,{isFocusVisible:u,focusProps:b}=nr({autoFocus:p}),{isHovered:g,hoverProps:E}=rr({isDisabled:a}),{pressed:h,pressProps:P}=or({disabled:a}),j=Lt({ref:r,type:(s=m.type)!=null?s:"button",disabled:a||void 0,autoFocus:p},b,E,P),_=Pt({disabled:a,hover:g,focus:u,active:h,autofocus:p});return kt()({ourProps:j,theirProps:m,slot:_,defaultTag:ar,name:"Button"})}let re=Ft(lr);function Ar({pr:e,suppliers:r,rfqs:s,purchaseRequest:i,rfq_details:a,categories:p}){var _e,Ce,Pe;const{toast:m}=yt();d.useEffect(()=>{if(a&&a.length>0){const n={};a.forEach(o=>{n[o.pr_details_id]||(n[o.pr_details_id]=[]),n[o.pr_details_id].includes(o.supplier_id)||n[o.pr_details_id].push(o.supplier_id)}),J(n)}},[a]);const[u,b]=d.useState(""),[g,E]=d.useState(null);d.useRef({});const[h,P]=d.useState(r??[]),[j,_]=d.useState(""),[v,S]=d.useState(1),T=5,[k,Xe]=d.useState(""),[Je,V]=d.useState(!1),[G,Ze]=d.useState({title:"",message:"",type:"success"}),[je,se]=d.useState(null),[Y,L]=d.useState(null),[z,X]=d.useState({}),[et,B]=d.useState(!1),[$,tt]=d.useState(null),[rt,nt]=d.useState(!1),[st,K]=d.useState(!1),[ie,J]=d.useState({}),[R,I]=d.useState({representative_name:"",company_name:"",address:"",tin_num:"",category_id:""}),[oe,ae]=d.useState(()=>{const n={};return e.details&&e.details.forEach(o=>{n[o.id]=o.unit_price||""}),n}),{data:dr,setData:le}=bt({pr_id:e.id,user_id:((_e=i==null?void 0:i.focal_person)==null?void 0:_e.id)??null,supplier_id:"",selections:[]}),F=({title:n,message:o,type:c,onConfirm:l=null})=>{Ze({title:n,message:o,type:c}),se(()=>l),V(!0)},it=(n,o,c,l)=>{n.preventDefault();const f=l===""?null:l;F({title:"Confirm Submission",message:"Are you sure you want to submit this quoted price?",type:"confirm",onConfirm:()=>de(o,c,f)})},ot=(n,o)=>{const c=a.find(l=>l.pr_details_id===n&&l.supplier_id===o);return(c==null?void 0:c.quoted_price)??null},de=(n,o,c,l=null)=>{const f=c===""?null:c,x={pr_id:e.id,pr_details_id:n,supplier_id:o,quoted_price:f},w=l||`${n}-${o}`;L(w),me.post(route("bac_approver.submit_quoted"),x,{preserveScroll:!0,onSuccess:()=>{L(null),l&&ue(y=>{const N={...y};return delete N[l],N}),F({title:"Submitted!",message:"Quoted price submitted successfully.",type:"success"})},onError:y=>{L(null),F({title:"Oops!",message:(y==null?void 0:y.quoted_price)||"Something went wrong while submitting.",type:"error"})}})},at=()=>{F({title:"Confirm Bulk Submission",message:"Are you sure you want to submit all quoted prices?",type:"confirm",onConfirm:()=>lt()})},lt=()=>{if(!g)return;const n=e.details.map(o=>{const c=`${o.id}-${g}`,l=z[c],f=l===""?null:l;return l!==void 0?{pr_id:e.id,pr_details_id:o.id,supplier_id:g,quoted_price:f}:null}).filter(o=>o!==null);if(n.length===0){F({title:"No Prices to Submit",message:"Please enter at least one quoted price before submitting all.",type:"warning"});return}L("all"),me.post(route("bac_approver.submit_bulk_quoted"),{quotes:n},{preserveScroll:!0,onSuccess:()=>{console.log("Bulk submitted successfully"),X(o=>{const c={...o};return n.forEach(l=>{delete c[`${l.pr_details_id}-${l.supplier_id}`]}),c}),L(null),F({title:"All Quoted Prices Submitted!",message:"All prices for this supplier have been submitted successfully.",type:"success"})},onError:o=>{console.error("Bulk submission failed",o),L(null),F({title:"Oops!",message:(o==null?void 0:o.quoted_price)||"Something went wrong while submitting all prices.",type:"error"})}})},Z=(n,o,c)=>{le(l=>{const f=(l.selections||[]).filter(x=>!(x.pr_detail_id===n&&x.supplier_id===o));return{...l,selections:[...f,{pr_detail_id:n,supplier_id:o,estimated_bid:c}]}})},dt=n=>{tt(n),nt(!1),B(!0);const o=e.details.find(c=>c.id===n);if(o){const c=o.unit_price||"";ae(l=>({...l,[n]:c})),le(l=>({...l,estimated_bid:c}))}},{flash:D}=gt().props,ct=async n=>{var o,c;n.preventDefault();try{const f=(await ht.post(route("bac_approver.store_supplier"),R)).data.supplier;P(N=>[...N,f]),_(String(f.id));const x=f.id,y=($===null?"":oe[$]||"").toString().trim()||((c=(o=e.details)==null?void 0:o.find(N=>N.id===$))==null?void 0:c.unit_price)||"";$!==null?Z($,x,y):e.details.forEach(N=>{const C=N.unit_price||"";Z(N.id,x,C)}),I({company_name:"",address:"",tin_num:"",representative_name:"",category_id:null}),K(!1),B(!1)}catch(l){l.response?console.error("Server error:",l.response.data):console.error("Error adding supplier:",l.message),ee.fire("Error","Failed to add supplier. Please try again.","error")}};$&&((Ce=e.details)!=null&&Ce.length)&&e.details.find(n=>n.id===$);const Ee=h.filter(n=>{var c,l,f;if(!k)return!0;const o=k.toLowerCase();return((c=n.representative_name)==null?void 0:c.toLowerCase().includes(o))||((l=n.company_name)==null?void 0:l.toLowerCase().includes(o))||((f=n.address)==null?void 0:f.toLowerCase().includes(o))}).filter(n=>!a.some(o=>o.pr_details_id===$&&o.supplier_id===n.id));d.useEffect(()=>{S(1)},[k]);const ce=Math.ceil(Ee.length/T),Se=v*T,ut=Se-T,Ne=Ee.slice(ut,Se),[W,ue]=d.useState({}),ft=(n,o,c)=>{L(c),me.delete(route("bac_approver.delete_quoted"),{data:{pr_id:e.id,pr_details_id:n,supplier_id:o},preserveScroll:!0,onSuccess:()=>{L(null),X(l=>{const f={...l};return delete f[c],f}),ue(l=>{const f={...l};return delete f[c],f}),J(l=>{const f={...l};return Array.isArray(f[n])&&(f[n]=f[n].filter(x=>x!==o),f[n].length===0&&delete f[n]),f}),m({title:"Deleted",description:"Quoted price removed successfully.",variant:"default",setTimeout:3e3}),F({title:"Deleted!"})},onFinish:l=>{L(null),D!=null&&D.message&&(m({title:D.status==="success"?"Deleted":"Error",description:D.message,variant:D.status==="success"?"default":"destructive",setTimeout:3e3}),F({title:D.status==="success"?"Deleted!":"Error!",description:D.message}))},onError:()=>{L(null),m({title:"Error",description:"Could not delete quoted price.",variant:"destructive",setTimeout:3e3}),F({title:"Error!"})}})},[pt,fe]=d.useState(!1),[cr,mt]=d.useState([]);return t.jsxs(vt,{children:[t.jsx(xt,{title:"Enter Quoted Prices"}),t.jsxs("div",{className:"mx-auto px-6 py-10",children:[t.jsx("div",{className:"mb-8",children:t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx(wt,{className:"w-8 h-8 text-indigo-700"}),"Enter Quoted Prices for PR: ",e.pr_number]})}),t.jsx("div",{className:"mb-4",children:t.jsx("a",{type:"button",href:route("bac_approver.for_quotations"),className:"inline-flex items-center px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"← Back"})}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2 border-b pb-2",children:[t.jsx($t,{className:"w-5 h-5 text-indigo-600"}),"Purchase Request Info"]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"PR Number:"})," ",e.pr_number]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Purpose:"})," ",e.purpose]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Requested By:"})," ",e.requester_name]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Division:"})," ",e.division]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Created:"})," ",new Date(e.created_at).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Focal Person:"})," ",(Pe=i==null?void 0:i.focal_person)==null?void 0:Pe.firstname]})]})]}),t.jsxs("div",{className:"xl:col-span-2 space-y-10",children:[e.details.map(n=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("div",{className:"mb-4 border-b pb-3",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-700",children:[n.item,t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",n.specs,")"]})]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-2 grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Unit:"})," ",n.unit]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Quantity:"})," ",n.quantity]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Est. Price per Unit:"})," ₱",Number(n.unit_price||0).toLocaleString()]})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>dt(n.id),className:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm shadow-sm",children:"Choose Supplier"}),t.jsx("button",{onClick:()=>K(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"➕ Add New Supplier"})]}),t.jsx("div",{className:"space-y-6 mt-6",children:Array.isArray(ie[n.id])&&ie[n.id].map(o=>{const c=h.find(C=>C.id===o);if(!c)return null;const l=`${n.id}-${o}`,f=Y===l,x=ot(n.id,o),w=x!==null,y=n.unit_price||0,N=C=>{let A=parseFloat(C.target.value);isNaN(A)&&(A=""),A>y&&(A=y,ee.fire({icon:"warning",title:"Exceeded Unit Price",text:`Quoted price cannot exceed ₱${y.toLocaleString()}.`,timer:2e3,showConfirmButton:!1})),X(pe=>({...pe,[l]:A}))};return t.jsxs("form",{onSubmit:C=>{C.preventDefault();const A=z[l]??"",pe=!!W[l];w&&pe?de(n.id,o,A,l):it(C,n.id,o,A)},className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center mt-4",children:[t.jsxs("div",{className:"md:col-span-4",children:[t.jsx("p",{className:"font-medium text-gray-800",children:c.representative_name}),t.jsx("p",{className:"text-xs text-gray-500",children:c.company_name})]}),t.jsxs("div",{className:"md:col-span-5 relative",children:[t.jsx("input",{type:"number",step:"0.01",placeholder:"₱ Quoted Price",max:y,disabled:w&&!W[l],value:w&&!W[l]?parseFloat(x).toFixed(2):z[l]||"",onChange:N,className:`w-full border rounded-md px-4 py-2 text-sm shadow-sm ${w&&!W[l]?"bg-gray-100 border-gray-300 text-gray-500":"border-gray-300 focus:ring-2 focus:ring-indigo-500"}`}),w&&!W[l]&&t.jsx("span",{className:"absolute top-1/2 right-3 -translate-y-1/2 text-xs font-medium text-green-600",children:"Already submitted"})]}),t.jsx("div",{className:"md:col-span-3 flex gap-2",children:w&&!W[l]?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>{ue(C=>({...C,[l]:!0})),X(C=>({...C,[l]:x}))},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-yellow-500 hover:bg-yellow-600 text-white",children:t.jsx(jt,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",disabled:f,onClick:()=>{F({title:"Confirm Delete",message:"Are you sure you want to delete this quoted price?",type:"confirm",onConfirm:()=>ft(n.id,o,l)})},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-red-600 hover:bg-red-700 text-white",children:t.jsx(Et,{className:"w-4 h-4"})})]}):w?t.jsx("button",{type:"button",disabled:f,onClick:()=>de(n.id,o,z[l]??"",l),className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${f?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(St,{className:"w-4 h-4"})}):t.jsx("button",{type:"submit",disabled:f,className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${f?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(Nt,{className:"w-4 h-4"})})})]},l)})})]},n.id)),g&&t.jsx("div",{className:"mt-6 text-right",children:t.jsx("button",{onClick:at,disabled:Y==="all",className:`inline-flex items-center gap-2 px-6 py-2 text-white text-sm font-semibold rounded-md shadow-sm transition ${Y==="all"?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700"}`,children:Y==="all"?"Submitting All...":"Submit Entire PR Quotes"})})]})]})]}),et&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:t.jsxs("div",{className:"relative w-full max-w-7xl p-6 bg-white/90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-200",children:[t.jsx("button",{onClick:()=>B(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 transition-colors","aria-label":"Close modal",children:"✕"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Select a Supplier"}),t.jsx("div",{className:"flex justify-between items-center mb-5 gap-3",children:t.jsx("input",{type:"text",placeholder:"🔍 Filter suppliers...",value:k,onChange:n=>{Xe(n.target.value),S(1)},className:"w-full max-w-xs border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})}),t.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto rounded-lg border border-gray-200",children:t.jsxs("table",{className:"min-w-full text-sm text-gray-700",children:[t.jsx("thead",{className:"bg-gray-100 text-gray-600 uppercase text-xs tracking-wide",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"ID"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Name"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Company"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Category"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Address"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"TIN"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Action"})]})}),t.jsx("tbody",{children:Ne.length>0?Ne.map(n=>{var o;return t.jsxs("tr",{className:"hover:bg-indigo-50 transition-colors",children:[t.jsx("td",{className:"py-3 px-4",children:n.id}),t.jsx("td",{className:"py-3 px-4",children:n.representative_name}),t.jsx("td",{className:"py-3 px-4",children:n.company_name}),t.jsx("td",{className:"py-3 px-4",children:((o=p.find(c=>String(c.id)===String(n.category_id)))==null?void 0:o.name)||"N/A"}),t.jsx("td",{className:"py-3 px-4",children:n.address}),t.jsx("td",{className:"py-3 px-4",children:n.tin_num}),t.jsxs("td",{className:"py-3 px-4 space-x-2 text-nowrap",children:[t.jsx("button",{disabled:a.some(c=>c.pr_details_id===$&&c.supplier_id===n.id),onClick:()=>{var f,x;const l=($===null?"":oe[$]||"").toString().trim()||((x=(f=e.details)==null?void 0:f.find(w=>w.id===$))==null?void 0:x.unit_price)||"";Z($,n.id,l),ae(w=>({...w,[$]:l})),J(w=>{const y=w[$]||[];return y.includes(n.id)?w:{...w,[$]:[...y,n.id]}}),_(String(n.id)),B(!1)},className:"text-sm bg-indigo-600 text-white hover:bg-indigo-700 px-3 py-1 rounded-lg shadow disabled:opacity-50 disabled:cursor-not-allowed",children:"Select"}),t.jsx("button",{onClick:()=>{const c={...ie},l={...oe},f=[];e.details.forEach(x=>{if(a.some(y=>y.pr_details_id===x.id&&y.supplier_id===n.id))f.push(x.item_description||`Item #${x.id}`);else{const y=x.unit_price||"";l[x.id]=y,Z(x.id,n.id,y);const N=c[x.id]||[];N.includes(n.id)||(c[x.id]=[...N,n.id])}}),ae(l),J(c),_(String(n.id)),E(n.id),B(!1),f.length>0&&(mt(f),fe(!0))},className:"text-sm bg-green-600 text-white hover:bg-green-700 px-3 py-1 rounded-lg shadow",children:"Apply to Entire PR"})]})]},n.id)}):t.jsx("tr",{children:t.jsxs("td",{colSpan:"7",className:"text-center py-6 text-gray-400 italic",children:["No suppliers available for this"," ",rt?"search":"category","."]})})})]})}),t.jsxs("div",{className:"mt-6 border-t pt-4 flex justify-between items-center",children:[t.jsx("button",{onClick:()=>K(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg text-sm shadow-sm",children:"➕ Add New Supplier"}),t.jsx("button",{onClick:()=>{if(!j){ee.fire("Oops!","Please select a supplier first.","warning");return}le("supplier_id",j),B(!1),ee.fire("Saved!","Supplier has been selected.","success")},className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm shadow-sm",children:"Confirm Selection"})]}),t.jsxs("div",{className:"flex justify-between items-center mt-4",children:[t.jsx("button",{onClick:()=>S(n=>Math.max(n-1,1)),disabled:v===1,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"← Prev"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",v," of ",ce]}),t.jsx("button",{onClick:()=>S(n=>Math.min(n+1,ce)),disabled:v===ce,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"Next →"})]})]})}),st&&t.jsx("div",{className:"fixed inset-0 z-[999] bg-black bg-opacity-50 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative",children:[t.jsx("button",{onClick:()=>K(!1),className:"absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold","aria-label":"Close add supplier modal",children:"×"}),t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Supplier"}),t.jsxs("form",{onSubmit:ct,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Representative Name"}),t.jsx("input",{type:"text",required:!0,value:R.representative_name,onChange:n=>I(o=>({...o,representative_name:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),t.jsx("input",{type:"text",required:!0,value:R.company_name,onChange:n=>I(o=>({...o,company_name:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),t.jsx("input",{type:"text",required:!0,value:R.address,onChange:n=>I(o=>({...o,address:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TIN Number"}),t.jsx("input",{type:"text",required:!0,value:R.tin_num,onChange:n=>I(o=>({...o,tin_num:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),t.jsxs("select",{required:!0,value:R.category_id,onChange:n=>I(o=>({...o,category_id:n.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"Select Category"}),p.map(n=>t.jsx("option",{value:n.id,children:n.name},n.id))]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>K(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",children:"Add Supplier"})]})]})]})}),t.jsx(Te,{open:Je,onOpenChange:V,children:t.jsxs(Fe,{children:[t.jsxs(Le,{children:[t.jsx(ke,{className:G.type==="error"?"text-red-600":G.type==="success"?"text-green-600":"",children:G.title}),t.jsx(De,{children:G.message})]}),t.jsx(Ae,{children:G.type==="confirm"?t.jsxs(t.Fragment,{children:[t.jsx(re,{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md",onClick:()=>{V(!1),se(null)},children:"Cancel"}),t.jsx(re,{className:"px-4 py-2 bg-green-600 text-white rounded-md",onClick:()=>{typeof je=="function"&&je(),V(!1),se(null)},children:"Confirm"})]}):t.jsx(re,{className:"px-4 py-2 bg-blue-600 text-white rounded-md",onClick:()=>V(!1),children:"Close"})})]})}),t.jsx(Te,{open:pt,onOpenChange:fe,children:t.jsxs(Fe,{children:[t.jsxs(Le,{children:[t.jsx(ke,{children:"Some Items Skipped"}),t.jsx(De,{children:"This supplier already quoted for some items, so they were skipped:"})]}),t.jsx(Ae,{className:"mt-4",children:t.jsx(re,{onClick:()=>fe(!1),children:"OK"})})]})})]})}export{Ar as default};
