import{a as u,j as e,H as ie,R as ce,L as de,c as E}from"./app-4Pod7gxo.js";import{I as me,C as ue}from"./IssuanceTabs-CQlAXuRA.js";import{S as xe}from"./SupplyOfficerLayout-QQiPTqhi.js";import{B as S}from"./button-4Gr1dIEf.js";import{D as z,a as G,b as U,c as V,d as W,e as J}from"./dialog-Cci81-gQ.js";import{P as pe}from"./printer-check-eAaKA8Aq.js";import{C as he}from"./circle-plus-BYvzwFS8.js";import{F as ye}from"./file-text-DNWG4gJQ.js";import"./createLucideIcon-BEvhKV3k.js";import"./Dropdown-C-56s-Rd.js";import"./transition-DMlcWJtq.js";import"./toaster-7VG6md4U.js";import"./use-toast-CB6HWlEV.js";import"./index-BfYVPKni.js";import"./index-Cit4VXVP.js";import"./utils-C-V6Xxww.js";import"./index-CdoXXacn.js";import"./XMarkIcon-DnTBuP1q.js";import"./clipboard-check-D1Pydy-f.js";import"./package-check-BY0RwSiY.js";import"./trash-BNgLmuZm.js";import"./index-CTRViXCj.js";function Oe({purchaseOrders:ge,inventoryItems:be,par:N,user:fe}){var Y,O;const[g,K]=u.useState(""),[R,X]=u.useState(""),[k,Z]=u.useState(new Date().getFullYear()),[ee,te]=u.useState([]),I=(Y=N==null?void 0:N.data)==null?void 0:Y.filter(t=>{var i,c,d,x,p,f,h,w;const a=(d=(c=(i=t.po)==null?void 0:i.rfq)==null?void 0:c.purchase_request)!=null&&d.focal_person?`${t.po.rfq.purchase_request.focal_person.firstname??""} ${t.po.rfq.purchase_request.focal_person.lastname??""}`:"",r=t.requested_by?`${t.requested_by.firstname??""} ${t.requested_by.lastname??""}`:"",l=g===""||((x=t.par_number)==null?void 0:x.toLowerCase().includes(g.toLowerCase()))||((f=(p=t.inventory_item)==null?void 0:p.item_desc)==null?void 0:f.toLowerCase().includes(g.toLowerCase()))||r.toLowerCase().includes(g.toLowerCase())||a.toLowerCase().includes(g.toLowerCase())||(((w=(h=t.items)==null?void 0:h[0])==null?void 0:w.recipient)??"").toLowerCase().includes(g.toLowerCase()),s=new Date(t.created_at),o=R===""||s.getMonth()+1===Number(R),m=k===""||s.getFullYear()===Number(k);return l&&o&&m});console.log(I);const se=t=>{te(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},[re,D]=u.useState(!1),[j,M]=u.useState(null),[v,C]=u.useState([]),[b,F]=u.useState(""),ae=(t,a)=>{const r=t.target.value;if(t.target.value="",r==="return"){M(a),C([]),F(""),D(!0);return}if(r==="reissuance"||r==="disposal"){const l=r==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";window.location.href=route(l,{id:a.id,type:"par"})}},[le,Q]=u.useState(!1),[$,T]=u.useState([]),[A,H]=u.useState(null);return e.jsxs(xe,{header:"Schools Divisions Office - Ilagan | PAR",children:[e.jsx(ie,{title:"PAR"}),e.jsx(me,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Property Acknowledgement Receipt (PAR)"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>window.location.href=route("supply_officer.generate_par_report",{month:R,year:k,search:g}),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-2 py-1 text-sm",value:R,onChange:t=>X(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),[...Array(12)].map((t,a)=>e.jsx("option",{value:a+1,children:new Date(0,a).toLocaleString("en",{month:"long"})},a))]}),e.jsx("label",{className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-20 text-sm",value:k,onChange:t=>Z(t.target.value)})]}),e.jsx("input",{type:"text",placeholder:"Search PAR number, item...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm",value:g,onChange:t=>K(t.target.value)})]}),e.jsx("div",{className:"overflow-x-auto mt-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-semibold uppercase tracking-wider text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"PAR No."}),e.jsx("th",{className:"px-4 py-3",children:"Division"}),e.jsx("th",{className:"px-4 py-3",children:"Requested By"}),e.jsx("th",{className:"px-4 py-3",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:I&&I.length>0?I.map((t,a)=>{var i,c,d,x,p,f,h,w,_,q,P;const r=((i=t.items)==null?void 0:i.map(n=>{var y;return{description:((y=n.inventory_item)==null?void 0:y.item_desc)??"N/A",quantity:n.quantity,unitCost:Number(n.unit_cost??0),totalCost:Number(n.unit_cost??0)*n.quantity,date:new Date(n.created_at).toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric"})}}))||[],l=ee.includes(t.id),s=l?r:r.slice(0,1),o=((d=(c=t.items)==null?void 0:c[0])==null?void 0:d.recipient)??(t.requested_by?`${t.requested_by.firstname??""} ${t.requested_by.lastname??""}`.trim():"N/A"),m=((p=(x=t.items)==null?void 0:x[0])==null?void 0:p.recipient_division)??((P=(q=(_=(w=(h=(f=t.po)==null?void 0:f.details)==null?void 0:h[0])==null?void 0:w.pr_detail)==null?void 0:_.purchase_request)==null?void 0:q.division)==null?void 0:P.division)??"N/A";return e.jsx(ce.Fragment,{children:s.map((n,y)=>e.jsxs("tr",{className:`transition-all duration-150 ${y%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-50 hover:shadow-sm`,children:[y===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:s.length,className:"px-4 py-3 font-semibold text-gray-800 align-top",children:a+1}),e.jsxs("td",{rowSpan:s.length,className:"px-4 py-3 text-blue-600 font-medium align-top",children:["P-",t.par_number]}),e.jsx("td",{rowSpan:s.length,className:"px-4 py-3 align-top",children:m}),e.jsx("td",{rowSpan:s.length,className:"px-4 py-3 align-top",children:o})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium",children:n.description})}),e.jsx("td",{className:"px-4 py-3 text-center text-gray-800",children:n.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",n.unitCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",n.totalCost.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:n.date}),y===s.length-1&&e.jsxs("td",{rowSpan:s.length,className:"px-4 py-3 text-center align-top",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs("a",{href:route("supply_officer.print_par",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium",children:[e.jsx(pe,{size:14}),"Print"]}),e.jsx(S,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",onClick:()=>{H(t),T([]),Q(!0)},children:"Switch Type"}),e.jsx(S,{type:"button",onClick:L=>ae(L,t),value:"return",className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",children:"Return"})]}),r.length>2&&e.jsx("button",{onClick:()=>se(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{size:14})," Show More"]})})]})]},`${t.id}-${y}`))},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(ye,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No ICS records found"})]})})})})]})}),((O=N==null?void 0:N.links)==null?void 0:O.length)>0&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:N.links.map((t,a)=>e.jsx(de,{href:t.url||"#",className:`px-3 py-1 text-sm rounded-md ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"} ${!t.url&&"opacity-50 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:t.label}},a))})]}),e.jsx(z,{open:re,onOpenChange:D,children:e.jsxs(G,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(U,{className:"pb-3 border-b border-gray-100",children:[e.jsx(V,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Return Items"}),e.jsx(W,{className:"text-sm text-gray-500",children:"Select items to return and specify whether they are for reissuance or disposal."})]}),j?(()=>{const t=j.items||[],a=t.every(r=>r.reissuedItem||r.disposedItem||r.status==="reissued"||r.status==="disposed");return e.jsxs("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:[!a&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2 py-1 rounded-md hover:bg-gray-100",children:[e.jsx("input",{id:"select-all-return",type:"checkbox",checked:t.every(r=>v.includes(r.id))||!1,onChange:r=>{r.target.checked?C(l=>[...new Set([...l,...t.map(s=>s.id)])]):C(l=>l.filter(s=>!t.map(o=>o.id).includes(s)))},className:"h-4 w-4 accent-blue-600"}),e.jsx("label",{htmlFor:"select-all-return",className:"text-sm font-medium text-gray-700 cursor-pointer select-none",children:"Select all"})]}),(()=>{const r=j.items||[];return console.log({lowItems:r}),r.every(s=>{const o=Number(s.quantity??0),m=Number(s.total_reissued_quantity??0),i=Number(s.total_disposed_quantity??0);return m+i>=o})?e.jsxs("div",{className:"p-4 text-center text-gray-500 text-sm italic bg-gray-50 rounded-md border border-gray-200",children:["All items in this issuance have already been"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"reissued"})," or"," ",e.jsx("span",{className:"font-semibold text-rose-600",children:"disposed"}),"."]}):r.map(s=>{var q,P,n,y,L;const o=((P=(q=s.inventoryItem)==null?void 0:q.product)==null?void 0:P.name)??((n=s.inventory_item)==null?void 0:n.item_desc)??"N/A",m=((L=(y=s.inventory_item)==null?void 0:y.product)==null?void 0:L.specs)??"",i=Number(s.quantity??0),c=Number(s.total_reissued_quantity??0),d=Number(s.total_disposed_quantity??0),x=c+d,p=Math.max(i-x,0),f=p===0&&c>0,h=p===0&&d>0,w=p>0&&(c>0||d>0),_=f||h;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${v.includes(s.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"} ${_?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:v.includes(s.id),disabled:_,onChange:ne=>{_||C(B=>ne.target.checked?[...B,s.id]:B.filter(oe=>oe!==s.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-gray-800",children:o}),f||h?e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${h?"bg-rose-100 text-rose-700 border border-rose-300":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:h?"Disposed":"Reissued"}):w?e.jsxs("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-300",children:["Some Items are returned (",x,"/",i,")"]}):e.jsxs("span",{className:"text-xs text-gray-600",children:["Remaining: ",p]})]}),m&&e.jsx("div",{className:"text-gray-500 text-xs",children:m}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",s.quantity," | ₱",Number(s.unit_cost??0).toFixed(2)]}),(c>0||d>0)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Returned:"," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:[c," reissued"]})," ","|"," ",e.jsxs("span",{className:"text-rose-600 font-medium",children:[d," disposed"]})]})]})]},s.id)})})()]})})():e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs("div",{className:"mt-5 border-t pt-4",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${b==="reissuance"?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"reissuance",checked:b==="reissuance",onChange:t=>F(t.target.value),className:"h-4 w-4 accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Reissuance"})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${b==="disposal"?"border-rose-400 bg-rose-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"disposal",checked:b==="disposal",onChange:t=>F(t.target.value),className:"h-4 w-4 accent-rose-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Disposal"})]})]})]}),e.jsxs(J,{className:"pt-5 border-t mt-4",children:[e.jsx(S,{variant:"outline",className:"w-28",onClick:()=>{D(!1),C([]),F(""),M(null)},children:"Cancel"}),e.jsx(S,{className:`w-28 text-white ${b==="disposal"?"bg-rose-600 hover:bg-rose-700":"bg-blue-600 hover:bg-blue-700"}`,disabled:!v.length||!b||j&&(j.items||[]).every(t=>{const a=Number(t.quantity??0),r=Number(t.total_reissued_quantity??0),l=Number(t.total_disposed_quantity??0),s=r+l;return console.log({totalQty:a,reissuedQty:r,disposedQty:l,totalProcessed:s}),s>=a}),onClick:()=>{if((j.items||[]).every(l=>{const s=Number(l.quantity??0),o=Number(l.total_reissued_quantity??0),m=Number(l.total_disposed_quantity??0);return o+m>=s})){toast({title:"All items already processed",description:"There are no items left to return.",variant:"destructive"});return}if(v.length===0){toast({title:"No items selected",description:"Please select at least one item to return.",variant:"destructive"});return}if(!b){toast({title:"No return type chosen",description:"Please specify whether this return is for reissuance or disposal.",variant:"destructive"});return}const r=b==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";E.visit(route(r,{id:j.id,type:"par",items:v.join(",")})),D(!1)},children:"Proceed"})]})]})}),e.jsx(z,{open:le,onOpenChange:Q,children:e.jsxs(G,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(U,{className:"pb-3 border-b border-gray-100",children:[e.jsx(V,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(W,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),A?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(A.items||[]).map(t=>{var l,s,o,m,i;const a=((s=(l=t.inventoryItem)==null?void 0:l.product)==null?void 0:s.name)??((o=t.inventory_item)==null?void 0:o.item_desc)??"N/A",r=((i=(m=t.inventoryItem)==null?void 0:m.product)==null?void 0:i.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${$.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:c=>{T(d=>c.target.checked?[...d,t.id]:d.filter(x=>x!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:a}),r&&e.jsx("div",{className:"text-gray-500 text-xs",children:r}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | ₱",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(J,{className:"pt-5 border-t mt-4",children:[e.jsx(S,{variant:"outline",className:"w-28",onClick:()=>{Q(!1),T([]),H(null)},children:"Cancel"}),e.jsx(S,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!$.length,onClick:()=>{var t;E.visit(route("supply_officer.switch_type",{type:"par",id:A.id,po_id:(t=A.po)==null?void 0:t.id,items:$}))},children:"Continue"})]})]})})]})}export{Oe as default};
