import{u as I,a as n,j as e,H as w,c as k}from"./app-Cs1McY02.js";import{S as A}from"./SupplyOfficerLayout-SWi0o-s2.js";import{P as u}from"./package-check-CNnh4aWJ.js";import"./toaster-CNCOgU5M.js";import"./use-toast-RAxD_qPw.js";import"./index-mEOC90f-.js";import"./index-DmEAzzlf.js";import"./createLucideIcon-CAyUIJle.js";import"./utils-BVseyFTm.js";import"./index-OUqkuChP.js";import"./Dropdown-ckgaHpXR.js";import"./transition-1OrjVXTB.js";import"./XMarkIcon-DDKr4MYC.js";import"./clipboard-check-BH2-nbLx.js";import"./trash-DcaSG3EI.js";function $({inventoryData:p,filters:c}){const{data:o,setData:m,get:x}=I({search:c.search||"",status:c.status||"",date_received:c.date_received||""}),[d,j]=n.useState([]),N=(t,a)=>{a<=0||j(l=>l.includes(t)?l.filter(r=>r!==t):[...l,t])};n.useEffect(()=>{const t=setTimeout(()=>{x(route("supply_officer.inventory"),{preserveState:!0,replace:!0})},300);return()=>clearTimeout(t)},[o.search,o.status,o.date_received]);const h=(t=>{if(!t||!t.data)return[];const a=new Map;return t.data.forEach(l=>{var s;const r=(s=l.po_detail)==null?void 0:s.purchase_order;r&&(a.has(r.id)||a.set(r.id,{po_id:r.id,po:r,requested_by:l.requested_by,items:[]}),a.get(r.id).items.push(l))}),Array.from(a.values())})(p);return e.jsxs(A,{header:"Schools Divisions Office - Ilagan | Inventory",children:[e.jsx(w,{title:"Inventory"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Inventory"}),e.jsxs("form",{onSubmit:t=>t.preventDefault(),className:"flex flex-wrap gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search item or Focal Person",className:"w-64 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:o.search,onChange:t=>m("search",t.target.value)}),e.jsxs("select",{value:o.status,onChange:t=>m("status",t.target.value),className:"border border-gray-300 px-8 py-2 rounded-md",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"Available",children:"Available"}),e.jsx("option",{value:"Issued",children:"Issued"})]})]})]}),d.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>k.visit(route("supply_officer.issuance"),{method:"get",data:{items:d}}),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center gap-2",children:[e.jsx(u,{size:18})," Issue Selected Items (",d.length,")"]})}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"w-full table-auto text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3"})," ",["PO Number","Requested By","Specs","Unit","Remaining Stock","Unit Cost","Total Price","Status","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wide text-center",children:t},t))]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-center",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"py-12 text-gray-500 text-lg font-medium",children:"No Inventory Found."})}):h.map(t=>{var a,l,r;return e.jsxs(n.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-100 font-semibold",children:[e.jsx("td",{}),e.jsx("td",{className:"px-6 py-3 text-blue-700",children:((a=t.po)==null?void 0:a.po_number)??"N/A"}),e.jsx("td",{className:"px-6 py-3",children:t.requested_by?[t.requested_by.firstname,t.requested_by.middlename,t.requested_by.lastname].filter(Boolean).join(" "):"N/A"}),e.jsx("td",{colSpan:"7",className:"text-left px-6 py-3",children:((r=(l=t.po)==null?void 0:l.supplier)==null?void 0:r.name)??""})]}),t.items.map(s=>{var f;const _=((f=s.unit)==null?void 0:f.unit)??"N/A",y=parseFloat(s.unit_cost)||0,v=parseFloat(s.issued_qty)||0,g=parseFloat(s.total_stock)||0,b=Math.max(g-v,0),S=(y*s.total_stock).toFixed(2);let i="Available";return s.total_stock===0?i="Fully Issued":s.total_stock<g&&(i="Partially Issued"),e.jsxs("tr",{className:"hover:bg-blue-50 transition duration-200",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsx("input",{type:"checkbox",checked:d.includes(s.id),disabled:b<=0,onChange:()=>N(s.id,b),className:"w-4 h-4 cursor-pointer disabled:cursor-not-allowed"})}),e.jsx("td",{className:"px-6 py-4"}),e.jsx("td",{className:"px-6 py-4",children:s.item_desc??"No description"}),e.jsx("td",{className:"px-6 py-4",children:_}),e.jsx("td",{className:"px-6 py-4",children:s.total_stock}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",y.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",S]}),e.jsx("td",{className:"px-6 py-4",children:i}),e.jsx("td",{className:"px-6 py-4",children:s.total_stock<=0?e.jsxs("span",{className:"bg-gray-300 text-gray-600 px-3 py-2 rounded cursor-not-allowed flex items-center justify-center gap-1",children:[e.jsx(u,{size:16})," All Items Are Issued"]}):e.jsxs("a",{href:route("supply_officer.issuance",s.id),className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition flex items-center justify-center gap-1",children:[e.jsx(u,{size:16})," Issue Item"]})})]},s.id)})]},t.po_id)})})]})}),e.jsx("div",{className:"mt-6 flex justify-center flex-wrap gap-1",children:p.links.map((t,a)=>e.jsx("button",{disabled:!t.url,onClick:()=>t.url&&x(t.url,{preserveState:!0,preserveScroll:!0}),className:`px-3 py-1 text-sm border rounded-md ${t.active?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,dangerouslySetInnerHTML:{__html:t.label}},a))})]})}export{$ as default};
