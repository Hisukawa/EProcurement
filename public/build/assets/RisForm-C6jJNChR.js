import{u as B,a as u,j as e}from"./app-DIvhqflN.js";import{u as O}from"./use-toast-DOzsFwf_.js";import{D as $,a as H,b as M,c as L,d as P,e as Q}from"./dialog-DRBwyFc1.js";import{B as w}from"./button-CVYlHGPx.js";import{F as U}from"./file-text-DjrBmbHl.js";import{M as Y}from"./minus-0c6ObylH.js";import{S as G}from"./send-horizontal-DsURTK2A.js";import"./index-D6H6XJ45.js";import"./index-sHCL6Saa.js";import"./createLucideIcon-BlLWWl-g.js";import"./utils-DmZEVKAZ.js";import"./index-rNSkqM9E.js";function oe({purchaseOrder:d,inventoryItems:k=[],user:x,risNumber:r}){var g,f,j,v,y,N,_;const t=((f=(g=d==null?void 0:d.detail)==null?void 0:g.pr_detail)==null?void 0:f.purchase_request)??null,S=t?`${((j=t==null?void 0:t.focal_person)==null?void 0:j.firstname)??""} ${((v=t==null?void 0:t.focal_person)==null?void 0:v.middlename)??""} ${((y=t==null?void 0:t.focal_person)==null?void 0:y.lastname)??""}`.trim():"N/A",{data:o,setData:n,post:D,processing:p,errors:b}=B({po_id:(d==null?void 0:d.id)??null,ris_number:r??"",requested_by:((N=t==null?void 0:t.focal_person)==null?void 0:N.id)??null,issued_by:(x==null?void 0:x.id)??null,remarks:"",items:k.map(s=>{var a;return{inventory_item_id:s.id,recipient:"",recipient_division:"",quantity:s.total_stock>0?1:0,unit_cost:s.unit_cost??0,total_cost:s.unit_cost??0,total_stock:s.total_stock??0,description:s.item_desc??((a=s.product)==null?void 0:a.item_description)??"N/A"}})}),[R,m]=u.useState(!1),{toast:h}=O();u.useEffect(()=>{r&&!o.ris_number&&n("ris_number",r)},[r]);const C=(s,a,i)=>{const l=[...o.items];{let c=parseFloat(i)||0;c>l[s].total_stock&&(c=l[s].total_stock),l[s].quantity=c,l[s].total_cost=c*(l[s].unit_cost??0)}n("items",l)},I=s=>{const a=o.items.filter((i,l)=>l!==s);n("items",a)},q=s=>{s.preventDefault(),m(!0)},F=()=>{D(route("supply_officer.store_ris"),{preserveScroll:!0,onSuccess:()=>{m(!1),h({title:"RIS Recorded",description:"Requisition and Issue Slip successfully saved!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{h({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})},[z,A]=u.useState(""),[E,T]=u.useState("");return e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 mb-4 flex items-center gap-2",children:[e.jsx(U,{size:24})," Requisition and Issue Slip (RIS)"]}),Object.keys(b).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(b).map(([s,a])=>e.jsx("li",{children:a},s))})}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"p-5 border rounded-md bg-blue-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-700 mb-4",children:"Requisition Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{value:((_=t==null?void 0:t.division)==null?void 0:_.division)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RIS No."}),e.jsx("input",{type:"text",value:o.ris_number,onChange:s=>n("ris_number",s.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested By"}),e.jsx("input",{value:S,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]})]})]}),o.items.map((s,a)=>e.jsxs("div",{className:"p-5 border rounded-md bg-green-50 relative",children:[o.items.length>1&&e.jsx("button",{type:"button",onClick:()=>I(a),className:"absolute top-2 right-2 text-red-600 hover:text-red-800",children:e.jsx(Y,{size:20})}),e.jsxs("h3",{className:"text-lg font-semibold text-green-700 mb-4",children:["Item ",a+1]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("input",{value:s.description,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{className:"p-5 border rounded-md bg-yellow-50 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-700 mb-4",children:"Default Recipient (applied to all items)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Name"}),e.jsx("input",{type:"text",value:z,onChange:i=>{A(i.target.value),n("items",o.items.map(l=>({...l,recipient:i.target.value})))},placeholder:"Leave blank to issue to requester",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Division"}),e.jsx("input",{type:"text",value:E,onChange:i=>{T(i.target.value),n("items",o.items.map(l=>({...l,recipient_division:i.target.value})))},placeholder:"Optional",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:s.total_stock,value:s.quantity,onChange:i=>C(a,"quantity",i.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),e.jsx("input",{type:"number",value:s.unit_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),e.jsx("input",{type:"number",value:s.total_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm bg-gray-50"})]})]})]})]},a)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:o.remarks,onChange:s=>n("remarks",s.target.value),rows:"4",className:"w-full mt-1 px-3 py-2 border rounded-md shadow-sm",placeholder:"Optional"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",disabled:p,children:[e.jsx(G,{size:16,className:"mr-2"})," ",p?"Saving...":"Submit Issuance"]})})]}),e.jsx($,{open:R,onOpenChange:m,children:e.jsxs(H,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsx(L,{children:"Confirm Issuance"}),e.jsx(P,{children:"Are you sure you want to record this RIS issuance?"})]}),e.jsxs(Q,{className:"mt-4 flex justify-end gap-2",children:[e.jsx(w,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(w,{onClick:F,children:"Yes, Record RIS"})]})]})})]})}export{oe as default};
