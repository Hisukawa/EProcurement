import{u as v,a as N,j as e,H as _}from"./app-CtTXRvSW.js";import{S as w}from"./SupplyOfficerLayout-BkfKkaPs.js";import"./toaster-BHX75O9a.js";import"./use-toast-n7ss-q37.js";import"./index-Bhk03iWx.js";import"./index-Dow8KyZk.js";import"./createLucideIcon-BS5JQiMA.js";import"./utils-_QWm-tM-.js";import"./index-ClPfL8xw.js";import"./Dropdown-BOTfWPms.js";import"./transition-CwMeo9Sp.js";import"./XMarkIcon-B3-C-RCN.js";import"./clipboard-check-CQy8bL28.js";import"./package-check-BilTQm-G.js";import"./trash-CMtWkb3K.js";function T({purchaseRequests:l,filters:o}){const{data:n,setData:c,get:d}=v({search:o.search||"",division:o.division||""});return N.useEffect(()=>{const t=setTimeout(()=>{d(route("supply_officer.purchase_orders"),{preserveState:!0,replace:!0})},300);return()=>clearTimeout(t)},[n.search,n.division]),e.jsxs(w,{header:"Schools Division Office - Ilagan | Create Purchase Order",children:[e.jsx(_,{title:"Purchase Order"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Purchase Requests with Selected Suppliers"}),e.jsxs("form",{onSubmit:t=>t.preventDefault(),className:"flex flex-wrap items-center gap-3",children:[e.jsx("input",{type:"text",name:"search",placeholder:"Search PR number or focal person",className:"w-96 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:n.search,onChange:t=>c("search",t.target.value)}),e.jsxs("select",{value:n.division,onChange:t=>c("division",t.target.value),className:"border border-gray-300 px-10 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Divisions"}),o.divisions.map(t=>e.jsx("option",{value:t.id,children:t.division},t.id))]})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"w-full table-auto text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["PR Number","Focal Person","Division","Item","Specs","Quantity","Unit","Winner Supplier","Quoted Price","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wide text-center whitespace-nowrap",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-center",children:l.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"py-12 text-gray-500 text-lg font-medium",children:"No Purchase Requests with winners found."})}):l.data.map(t=>{var p,u,x,h,g;const s=t.details.filter(a=>{var r;return(r=t.rfqs)==null?void 0:r.flatMap(i=>i.details).some(i=>i.pr_details_id===a.id&&i.is_winner_as_calculated)});if(s.length===0)return null;const m=(p=t.rfqs)==null?void 0:p.flatMap(a=>a.details??[]).filter(a=>s.some(r=>r.id===a.pr_details_id)&&a.is_winner_as_calculated),f=m.reduce((a,r)=>{const i=s.find(j=>j.id===r.pr_details_id),y=(i==null?void 0:i.quantity)??1,b=r.unit_price_edited??r.quoted_price??0;return a+b*y},0);return e.jsxs("tr",{className:"hover:bg-blue-50 transition duration-200",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-blue-700 whitespace-nowrap",children:t.pr_number}),e.jsxs("td",{className:"px-6 py-4",children:[t.focal_person.firstname," ",t.focal_person.lastname]}),e.jsx("td",{className:"px-6 py-4",children:t.division.division}),e.jsxs("td",{className:"px-6 py-4",children:[((u=s[0])==null?void 0:u.item)||"—",s.length>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((x=s[0])==null?void 0:x.specs)||"—",s.length>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((h=s[0])==null?void 0:h.quantity)||"—",new Set(s.map(a=>a.quantity)).size>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((g=s[0])==null?void 0:g.unit)||"—",new Set(s.map(a=>a.product.unit.unit)).size>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsx("td",{className:"px-6 py-4",children:[...new Set(m.map(a=>{var r;return((r=a.supplier)==null?void 0:r.company_name)||"N/A"}))].join(", ")}),e.jsxs("td",{className:"px-6 py-4",children:["₱"," ",f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsx("a",{href:route("supply_officer.create_po",t.id),className:`inline-block px-4 py-2 text-sm font-medium rounded-md transition ${t.has_po?"bg-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,onClick:a=>t.has_po&&a.preventDefault(),children:t.has_po?"PO Generated":"Purchase Order"})})]},`pr-${t.id}`)})})]})}),e.jsx("div",{className:"mt-6 flex justify-center flex-wrap gap-1",children:l.links.map((t,s)=>e.jsx("button",{disabled:!t.url,onClick:()=>t.url&&d(t.url,{data:n,preserveState:!0,preserveScroll:!0}),className:`px-3 py-1 text-sm border rounded-md ${t.active?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,dangerouslySetInnerHTML:{__html:t.label}},s))})]})}export{T as default};
