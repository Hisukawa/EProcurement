import{a as i,b as Y,u as ee,j as e,H as se,L as R,d as F}from"./app-B7_UX2sh.js";import{A as te}from"./AdminLayout-CUt3eKax.js";import{D as M,a as O,b as k,c as H,d as I,e as L}from"./dialog-DohJNFeT.js";import{T as ae,a as ie,b as E,c as d,d as re,e as o}from"./table-Dw_Tp0ub.js";import{B as g}from"./button-BPZKlegq.js";import{I as m}from"./input-3CElz8w-.js";import{u as ne}from"./use-toast-B7jOcQUg.js";import{F as le}from"./PencilSquareIcon-DpPWNhMu.js";import{F as oe}from"./TrashIcon-vjs2xFmH.js";import"./Dropdown-Cr-ssEUb.js";import"./transition-CrNCWD_V.js";import"./toaster-CYWm_-9N.js";import"./index-C9v5eIVZ.js";import"./index-Dbmq-qNg.js";import"./createLucideIcon-Bz5E4J9E.js";import"./utils-3YMp73RZ.js";import"./index-BbZGCgbR.js";import"./users-NfnHRpT6.js";import"./index-Ddce4cKg.js";function de({title:c,titleId:u,...x},v){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:v,"aria-labelledby":u},x),c?i.createElement("title",{id:u},c):null,i.createElement("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z",clipRule:"evenodd"}))}const ce=i.forwardRef(de);function Ue({users:c,filters:u,divisions:x,roles:v}){var T,P;const{props:_}=Y(),j=(T=_.flash)==null?void 0:T.success,w=(P=_.flash)==null?void 0:P.error,{toast:l}=ne(),[B,f]=i.useState(!1),[$,p]=i.useState(!1),[D,A]=i.useState(""),[r,b]=i.useState(null),[y,N]=i.useState(""),[C,U]=i.useState(!1),{data:t,setData:n,put:Z,get:S,reset:q}=ee({search:u.search||"",division:u.division||"",firstname:"",middlename:"",lastname:"",email:"",position:"",division_id:"",role:""});i.useEffect(()=>{const s=setTimeout(()=>{S(route("admin.view_users"),{preserveState:!0,replace:!0})},300);return()=>clearTimeout(s)},[t.search,t.division]),i.useEffect(()=>{j&&l({title:"✅ Success",description:j}),w&&l({title:"❌ Error",description:w,variant:"destructive"})},[j,w]);const V=s=>{A("update"),b(s),N(""),p(!0)},z=s=>{A("delete"),b({id:s}),N(""),p(!0)},G=async()=>{if(!y.trim()){l({title:"⚠️ Required",description:"Please enter your password."});return}U(!0);try{if(!(await F.post(route("admin.verify_password"),{password:y})).data.success){l({title:"❌ Error",description:"Incorrect password. Please try again.",variant:"destructive"});return}D==="update"?J():D==="delete"&&await Q(),p(!1)}catch{l({title:"❌ Error",description:"Something went wrong verifying password.",variant:"destructive"})}finally{U(!1)}},J=()=>{var s,a;r&&(n({firstname:r.firstname,middlename:r.middleinitial,lastname:r.lastname,email:r.email,position:r.position||"",division_id:((s=r.division)==null?void 0:s.id)||"",role:((a=r.roles[0])==null?void 0:a.name)||""}),f(!0))},K=async()=>{var s,a;try{const h=await F.put(route("admin.update_user",r.id),t);l({title:"✅ Success",description:h.data.message||"User updated successfully"}),f(!1),q(),b(null),S(route("admin.view_users"),{preserveState:!0})}catch(h){l({title:"❌ Error",description:((a=(s=h.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong",variant:"destructive"})}},Q=async()=>{try{await Z(route("admin.deactivate_user",r.id),{}),l({title:"✅ Success",description:"User deactivated successfully"}),S(route("admin.view_users"),{preserveState:!0})}catch{l({title:"❌ Error",description:"Something went wrong",variant:"destructive"})}};return e.jsxs(te,{header:"Schools Division Office - Ilagan | Users",children:[e.jsx(se,{title:"Users"}),e.jsx("div",{className:"rounded-lg mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-4 w-full md:w-auto mb-4 md:mb-0",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"flex flex-wrap items-center gap-3",children:[e.jsx("input",{type:"text",placeholder:"Name...",className:"w-96 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.search,onChange:s=>n("search",s.target.value)}),e.jsxs("select",{value:t.division,onChange:s=>n("division",s.target.value),className:"border border-gray-300 px-10 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Divisions"}),x.map(s=>e.jsx("option",{value:s.id,children:s.division},s.id))]})]})}),e.jsx(R,{href:route("admin.create_user_form"),className:"bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition shadow-md text-center",children:"+ Add User"})]})}),e.jsxs("div",{className:"overflow-x-auto bg-white rounded-lg shadow-md",children:[e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsxs(E,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{children:"Name"}),e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Division"}),e.jsx(d,{children:"Position"}),e.jsx(d,{children:"Role"}),e.jsx(d,{className:"text-center",children:"Actions"})]})}),e.jsx(re,{children:c.data.length>0?c.data.map(s=>{var a;return e.jsxs(E,{className:`hover:bg-blue-50 transition duration-150 ${s.account_status==="inactive"?"opacity-50 line-through":""}`,children:[e.jsx(o,{children:s.id}),e.jsxs(o,{className:"flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-gray-400 mr-2"}),s.firstname," ",s.middleinitial," ",s.lastname]}),e.jsx(o,{children:s.email}),e.jsx(o,{children:((a=s.division)==null?void 0:a.division)||e.jsx("span",{className:"text-gray-500 italic",children:"N/A"})}),e.jsx(o,{children:s.position||e.jsx("span",{className:"text-gray-500 italic",children:"N/A"})}),e.jsx(o,{children:s.roles.map((h,W)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:h.name.replace(/_/g," ").replace(/\b\w/g,X=>X.toUpperCase())},W))}),e.jsxs(o,{className:"text-center",children:[e.jsx("button",{onClick:()=>V(s),className:"inline-flex items-center px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 mr-2",title:"Edit User",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(s.id),className:"inline-flex items-center px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",title:"Delete User",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},s.id)}):e.jsx(E,{children:e.jsx(o,{colSpan:7,className:"text-center py-6 text-gray-500",children:"No users found."})})})]}),e.jsx("div",{className:"flex items-center justify-center space-x-1 mt-6",children:c.links.map((s,a)=>e.jsx(R,{href:s.url||"#",className:`min-w-[40px] px-3 py-2 text-sm font-medium rounded-lg transition ${s.active?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border hover:bg-blue-50"}`,dangerouslySetInnerHTML:{__html:s.label}},a))})]}),e.jsx(M,{open:$,onOpenChange:p,children:e.jsxs(O,{children:[e.jsxs(k,{children:[e.jsx(H,{children:"Confirm Admin Action"}),e.jsx(I,{children:"Please enter your admin password to continue."})]}),e.jsx(m,{type:"password",placeholder:"Admin Password",value:y,onChange:s=>N(s.target.value),disabled:C}),e.jsxs(L,{children:[e.jsx(g,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(g,{onClick:G,disabled:C,children:C?"Verifying...":"Submit"})]})]})}),e.jsx(M,{open:B,onOpenChange:f,children:e.jsxs(O,{children:[e.jsxs(k,{children:[e.jsx(H,{children:"Edit User"}),e.jsx(I,{children:"Modify the user’s details below."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"First Name",value:t.firstname,onChange:s=>n("firstname",s.target.value)}),e.jsx(m,{placeholder:"Middle Name",value:t.middlename,onChange:s=>n("middlename",s.target.value)}),e.jsx(m,{placeholder:"Last Name",value:t.lastname,onChange:s=>n("lastname",s.target.value)}),e.jsx(m,{placeholder:"Email",type:"email",value:t.email,onChange:s=>n("email",s.target.value)}),e.jsx(m,{placeholder:"Position",value:t.position,onChange:s=>n("position",s.target.value)}),e.jsxs("select",{value:t.division_id,onChange:s=>n("division_id",s.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Division"}),x.map(s=>e.jsx("option",{value:s.id,children:s.division},s.id))]}),e.jsxs("select",{value:t.role,onChange:s=>n("role",s.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Role"}),v.map((s,a)=>e.jsx("option",{value:s.name,children:s.name},a))]})]}),e.jsxs(L,{children:[e.jsx(g,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(g,{onClick:K,children:"Save Changes"})]})]})})]})}export{Ue as default};
