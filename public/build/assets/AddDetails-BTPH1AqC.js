import{u as V,a,j as e,H as W,c as X}from"./app-CtTXRvSW.js";import{R as Y}from"./RequesterLayout-D1jH-T7d.js";import{D as c,a as x,b as u,c as p,d as h,e as m}from"./dialog-Bx8Sq_PR.js";import{B as n}from"./button-BXv_ZNaU.js";import{F as Z}from"./PencilSquareIcon-CYPeK2bz.js";import{T as $}from"./trash-CMtWkb3K.js";import"./Dropdown-BOTfWPms.js";import"./transition-CwMeo9Sp.js";import"./toaster-BHX75O9a.js";import"./use-toast-n7ss-q37.js";import"./index-Bhk03iWx.js";import"./index-Dow8KyZk.js";import"./createLucideIcon-BS5JQiMA.js";import"./utils-_QWm-tM-.js";import"./index-ClPfL8xw.js";import"./index-BrVwGuKN.js";import"./XMarkIcon-B3-C-RCN.js";import"./index-B2vGw--Q.js";function ye({prId:_,products:S,pr_number:N,prDetails:f,purpose:P,sendBackReason:ee,units:D,rejectionReason:g}){console.log(g);const{data:t,setData:r,post:I,put:w,processing:se,errors:y,reset:O}=V({id:null,pr_number:N,product_id:"",item:"",specs:"",unit_id:"",custom_unit:"",unit_price:"",quantity:"",purpose:P||""}),[E,d]=a.useState(!1),[F,k]=a.useState(!1),[A,j]=a.useState(!1),[q,R]=a.useState(null),[U,v]=a.useState(!1),T=s=>{const l=f.find(i=>i.product_id==s);if(l)r({...t,product_id:l.product_id,item:l.item,specs:l.specs,unit_id:l.unit_id,custom_unit:"",unit_price:l.unit_price,quantity:l.quantity}),d(!0);else{const i=S.find(o=>o.id==s);i&&(r({...t,product_id:i.id,item:i.name,specs:i.specs,unit_id:i.unit_id||"",custom_unit:"",unit_price:i.default_price||"",quantity:""}),d(!0))}},B=()=>{const s=t.custom_unit.trim();if(s){const o=D.find(K=>K.unit.toLowerCase()===s.toLowerCase());o?(r("unit_id",o.id),r("custom_unit","")):r("unit_id","")}else if(!t.unit_id)return;if(!t.quantity)return;const l=t.id?route("requester.update_details",t.id):route("requester.store_details",_);(t.id?w:I)(l,{preserveScroll:!0,data:{...t,purpose:t.purpose},onSuccess:()=>{d(!1),O()}})},H=s=>{r({...t,id:s.id,product_id:s.product_id,item:s.item,specs:s.specs,unit_id:s.unit_id,custom_unit:"",unit_price:s.unit_price,quantity:s.quantity}),d(!0)},L=s=>{s&&s.id?(R(s.id),j(!0)):console.error("Error: Invalid detail provided for deletion")},M=()=>{q?X.delete(route("requester.delete_details",{detailId:q}),{preserveScroll:!0,onSuccess:()=>{j(!1),v(!0)},onError:s=>{console.error("Delete failed:",s),j(!1)}}):console.error("Error: No valid ID provided for deletion.")},Q=()=>{b(!0)},z=()=>{w(route("requester.update_purpose",_),{preserveScroll:!0,data:{purpose:t.purpose},onSuccess:()=>{b(!1),C(!0)},onError:s=>{b(!1),alert("Failed to update purpose.")}})},[G,b]=a.useState(!1),[J,C]=a.useState(!1);return e.jsxs(Y,{header:"Schools Division Office - Ilagan | Add Details",children:[e.jsx(W,{title:"PR Details"}),e.jsxs("div",{className:"mx-auto mt-10 bg-white p-10 shadow-2xl",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-8 text-left text-gray-800",children:["Purchase Request Details — ",e.jsx("span",{className:"text-blue-600",children:N})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Purpose"}),e.jsx("textarea",{value:t.purpose,onChange:s=>r("purpose",s.target.value),className:"w-full border rounded px-3 py-1 mt-2",placeholder:"Enter the purpose of the request"}),y.purpose&&e.jsx("p",{className:"text-red-500 mt-1 text-sm",children:y.purpose}),e.jsx("button",{onClick:Q,className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded",children:"Save Purpose"})]}),g&&g!==null&&e.jsxs("div",{className:"mb-4 p-4 bg-red-200 border-l-4 border-red-600 text-red-800",children:[e.jsx("strong",{children:"Rejection Reason: "}),g]}),e.jsx(c,{open:F,onOpenChange:k,children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Finish PR?"})}),e.jsx(h,{children:"Once you finish, you will go back to the request list."}),e.jsxs(m,{children:[e.jsx(n,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>{window.location.href=route("requester.manage_requests")},children:"Confirm"})]})]})}),e.jsx(c,{open:G,onOpenChange:b,children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Save Purpose"})}),e.jsx(h,{children:"Are you sure you want to save the updated purpose?"}),e.jsxs(m,{children:[e.jsx(n,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(n,{onClick:z,children:"Save"})]})]})}),e.jsx(c,{open:A,onOpenChange:j,children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Are you sure?"})}),e.jsx(h,{children:"Delete item? This action cannot be undone."}),e.jsxs(m,{children:[e.jsx(n,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(n,{onClick:M,children:"Delete"})]})]})}),e.jsx(c,{open:U,onOpenChange:v,children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{className:"text-green-600",children:"Success"})}),e.jsx(h,{children:"Item deleted successfully."}),e.jsx(m,{children:e.jsx(n,{onClick:()=>v(!1),children:"Close"})})]})}),e.jsx(c,{open:J,onOpenChange:C,children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{className:"text-green-600",children:"Success"})}),e.jsx(h,{children:"Purpose saved successfully."}),e.jsx(m,{children:e.jsx(n,{onClick:()=>C(!1),children:"Close"})})]})}),e.jsx(c,{open:E,onOpenChange:d,children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(p,{children:"Edit Item"})}),e.jsx(h,{children:"Edit the details of the selected item."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Item Name"}),e.jsx("input",{type:"text",value:t.item,onChange:s=>r("item",s.target.value),className:"w-full border rounded px-3 py-1 mt-2"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Specifications"}),e.jsx("input",{type:"text",value:t.specs,onChange:s=>r("specs",s.target.value),className:"w-full border rounded px-3 py-1 mt-2"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Unit"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:t.unit_id,onChange:s=>r("unit_id",s.target.value),className:"w-1/2 border rounded px-3 py-1 mt-2",children:[e.jsx("option",{value:"",children:"-- Select Unit --"}),D.map(s=>e.jsx("option",{value:s.id,children:s.unit},s.id))]}),e.jsx("input",{type:"text",value:t.custom_unit,onChange:s=>r("custom_unit",s.target.value),className:"w-1/2 border rounded px-3 py-1 mt-2",placeholder:"Enter custom unit"})]}),y.unit_id&&e.jsx("p",{className:"text-red-500 mt-1 text-sm",children:y.unit_id})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>r("quantity",s.target.value),className:"w-full border rounded px-3 py-1 mt-2"})]}),e.jsxs(m,{children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(n,{onClick:B,children:"Save Changes"})]})]})}),e.jsx("div",{className:"overflow-x-auto mb-10",children:e.jsxs("table",{className:"w-full min-w-[700px] border border-gray-300 shadow rounded-lg text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b",children:"Item"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Specs"}),e.jsx("th",{className:"px-4 py-3 border-b",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Default Unit Price (₱)"}),e.jsx("th",{className:"px-4 py-3 border-b text-right",children:"Total (₱)"}),e.jsx("th",{className:"px-4 py-3 border-b text-center",children:"Actions"})]})}),e.jsx("tbody",{children:f.length>0?f.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 border-b",children:s.item}),e.jsx("td",{className:"px-4 py-3 border-b",children:s.specs}),e.jsx("td",{className:"px-4 py-3 border-b",children:s.unit}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:s.quantity}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:Number(s.unit_price).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:(Number(s.unit_price)*s.quantity).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 border-b text-right",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs("button",{onClick:()=>H(s),className:"inline-flex items-center px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs(n,{onClick:()=>L(s),className:"inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Delete"]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-6 text-gray-500",children:"No items added yet."})})})]})}),e.jsxs("h3",{className:"text-2xl font-semibold mb-6 text-center text-gray-700",children:["Add Item to PR ",e.jsx("span",{className:"text-blue-600",children:N})]}),e.jsx("form",{onSubmit:s=>s.preventDefault(),className:"mx-auto space-y-8",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-800",children:"Select a Product"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border border-gray-300 rounded-lg shadow",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Item"}),e.jsx("th",{className:"px-3 py-2 border",children:"Specifications"}),e.jsx("th",{className:"px-3 py-2 border",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 border",children:"Default Price (₱)"}),e.jsx("th",{className:"px-3 py-2 border text-center",children:"Select"})]})}),e.jsx("tbody",{children:S.map(s=>{var i;const l=f.some(o=>o.product_id===s.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 border",children:s.name}),e.jsx("td",{className:"px-3 py-2 border",children:s.specs}),e.jsx("td",{className:"px-3 py-2 border",children:((i=s.unit)==null?void 0:i.unit)||"-"}),e.jsx("td",{className:"px-3 py-2 border",children:Number(s.default_price).toFixed(2)}),e.jsx("td",{className:"px-3 py-2 border text-center",children:l?e.jsx("span",{className:"text-green-600 font-semibold text-xs",children:"Added"}):e.jsx("button",{type:"button",onClick:()=>T(s.id),className:"bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full text-lg font-bold transition",title:"Add Product",children:"+"})})]},s.id)})})]})})]})})]})]})}export{ye as default};
