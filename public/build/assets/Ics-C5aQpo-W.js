import{a as x,j as e,H as Ie,R as qe,L as Fe,c as me}from"./app-DD2uK0zY.js";import{u as ke}from"./use-toast-ib3QBt3c.js";import{I as De,C as Re}from"./IssuanceTabs-BDIG4NJh.js";import{S as Le}from"./SupplyOfficerLayout-9UUPE-1N.js";import{B as S}from"./button-Bq4k0Ljh.js";import{D as xe,a as ue,b as pe,c as he,d as ye,e as be}from"./dialog-zrxpP4Hw.js";import{P as Qe}from"./printer-check-D_z2ipge.js";import{C as Te}from"./circle-plus-BJQ6wEx1.js";import{F as Me}from"./file-text-BZ7nVK1e.js";import"./createLucideIcon-Bms0I2ee.js";import"./Dropdown-D-UuPbrA.js";import"./transition-o0BzbkQC.js";import"./toaster-C-9VAH0i.js";import"./index-C6PyR5fr.js";import"./index-DVmik40P.js";import"./utils-BvCQ01dZ.js";import"./index-CYMZwvoE.js";import"./XMarkIcon-BochZeBY.js";import"./clipboard-check-BZYbEEj8.js";import"./package-check-CgHON6i4.js";import"./trash-Dc00zV8h.js";import"./index-Br8PWsuU.js";function nt({ics:j,user:Pe,filters:Ae}){var B,J;const[v,ge]=x.useState(""),[R,fe]=x.useState(""),[L,Ne]=x.useState(new Date().getFullYear()),[je,ve]=x.useState([]),{toast:O}=ke(),[we,Q]=x.useState(!1),[T,E]=x.useState(null),[C,I]=x.useState([]),[p,M]=x.useState(""),_e=t=>{ve(i=>i.includes(t)?i.filter(s=>s!==t):[...i,t])},H=(B=j==null?void 0:j.data)==null?void 0:B.filter(t=>{var l,o,c,d,u,m,h,y,b,g,f,w;const i=v===""||((l=t.ics_number)==null?void 0:l.toLowerCase().includes(v.toLowerCase()))||((o=t.items)==null?void 0:o.some(N=>{var _,q,F;return(((q=(_=N.inventoryItem)==null?void 0:_.product)==null?void 0:q.name)??((F=N.inventory_item)==null?void 0:F.item_desc)??"").toLowerCase().includes(v.toLowerCase())}))||((((m=(u=(d=(c=t.po)==null?void 0:c.rfq)==null?void 0:d.purchase_request)==null?void 0:u.focal_person)==null?void 0:m.firstname)??"")+" "+(((g=(b=(y=(h=t.po)==null?void 0:h.rfq)==null?void 0:y.purchase_request)==null?void 0:b.focal_person)==null?void 0:g.lastname)??"")).toLowerCase().includes(v.toLowerCase())||(((w=(f=t.items)==null?void 0:f[0])==null?void 0:w.recipient)??"").toLowerCase().includes(v.toLowerCase()),s=new Date(t.created_at),a=R===""||s.getMonth()+1===Number(R),r=L===""||s.getFullYear()===Number(L);return i&&a&&r}),Ce=(t,i)=>{const s=t.target.value;if(t.target.value="",s==="return"){E(i),I([]),M(""),Q(!0);return}if(s==="reissuance"||s==="disposal"){const a=s==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";window.location.href=route(a,{id:i.id,type:"ics"})}},[Se,Y]=x.useState(!1),[P,z]=x.useState([]),[A,W]=x.useState(null);return e.jsxs(Le,{header:"Schools Divisions Office - Ilagan | Inventory Custodian Slip (ICS) - LOW",children:[e.jsx(Ie,{title:"ICS - LOW"}),e.jsx(De,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Inventory Custodian Slip (ICS) - LOW VALUE"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>window.location.href=route("supply_officer.generate_ics_report",{month:R,year:L,search:v,type:"low"}),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"month-filter",className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{id:"month-filter",className:"border border-gray-300 rounded-md px-2 py-1 text-sm shadow-sm",value:R,onChange:t=>fe(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map((t,i)=>e.jsx("option",{value:i+1,children:t},i))]}),e.jsx("label",{htmlFor:"year-filter",className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{id:"year-filter",type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-24 text-sm shadow-sm",value:L,onChange:t=>Ne(t.target.value)})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search ICS number, item...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm shadow-sm",value:v,onChange:t=>ge(t.target.value)})})]}),e.jsx("div",{className:"mt-6 rounded-xl border border-gray-200 shadow-sm bg-white overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-100 to-gray-50 sticky top-0 z-10 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"#"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"ICS No."}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Division"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Requested By"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:H&&H.length>0?H.map((t,i)=>{var d,u,m,h,y,b,g,f,w,N,_,q,F,U,V,G,K,X,Z,ee,te,se,re,ae,ie,le,ne,oe;const s=((d=t.items)==null?void 0:d.filter(n=>n.type==="low").map(n=>{var $,k,D,ce,de;return{description:((k=($=n.inventoryItem)==null?void 0:$.product)==null?void 0:k.name)??((D=n.inventory_item)==null?void 0:D.item_desc)??"N/A",specs:((de=(ce=n.inventoryItem)==null?void 0:ce.product)==null?void 0:de.specs)??"",quantity:n.quantity,unitCost:Number(n.unit_cost??0),totalCost:Number(n.total_cost??0),date:new Date(n.created_at).toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric"})}}))||[],a=je.includes(t.id),r=s[0]??{description:((h=(m=(u=t.items)==null?void 0:u[0])==null?void 0:m.inventory_item)==null?void 0:h.item_desc)??"N/A",quantity:((b=(y=t.items)==null?void 0:y[0])==null?void 0:b.quantity)??0,unitCost:Number(((w=(f=(g=t.items)==null?void 0:g[0])==null?void 0:f.inventory_item)==null?void 0:w.unit_cost)??0),totalCost:(((_=(N=t.items)==null?void 0:N[0])==null?void 0:_.quantity)??0)*(((U=(F=(q=t.items)==null?void 0:q[0])==null?void 0:F.inventory_item)==null?void 0:U.unit_cost)??0),date:new Date(((G=(V=t.items)==null?void 0:V[0])==null?void 0:G.created_at)??t.created_at).toLocaleDateString("en-PH")},l=s.slice(1),o=((X=(K=t.items)==null?void 0:K[0])==null?void 0:X.recipient)??(t.requested_by?`${t.requested_by.firstname??""} ${t.requested_by.lastname??""}`.trim():"N/A"),c=((ee=(Z=t.items)==null?void 0:Z[0])==null?void 0:ee.recipient_division)??((le=(ie=(ae=(re=(se=(te=t.po)==null?void 0:te.details)==null?void 0:se[0])==null?void 0:re.pr_detail)==null?void 0:ae.purchase_request)==null?void 0:ie.division)==null?void 0:le.division)??"N/A";return e.jsxs(qe.Fragment,{children:[e.jsxs("tr",{className:"bg-white hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800 align-top",children:i+1}),e.jsx("td",{className:"px-4 py-3 text-blue-600 font-medium align-top",children:t.ics_number}),e.jsx("td",{className:"px-4 py-3 align-top",children:c}),e.jsx("td",{className:"px-4 py-3 align-top",children:o}),e.jsx("td",{className:"px-4 py-3 font-medium",children:r.description}),e.jsx("td",{className:"px-4 py-3 text-center",children:r.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",(ne=r.unitCost)==null?void 0:ne.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",(oe=r.totalCost)==null?void 0:oe.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:r.date}),e.jsxs("td",{className:"px-4 py-3 text-center align-top",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center relative z-10",children:[e.jsxs("a",{href:route("supply_officer.print_ics",[t.id,"low"]),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium pointer-events-auto",children:[e.jsx(Qe,{size:14}),"Print"]}),e.jsx(S,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm pointer-events-auto",onClick:()=>{W(t),z([]),Y(!0)},children:"Switch Type"}),e.jsx(S,{type:"button",onClick:n=>Ce(n,t),value:"return",className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm pointer-events-auto",children:"Return"})]}),t.items.length>1&&e.jsx("button",{onClick:()=>_e(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:14})," Show More (",t.items.length-1," more)"]})})]})]}),a&&l.length>0&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:10,className:"px-4 py-3",children:e.jsx("div",{className:"grid gap-2",children:l.map((n,$)=>{var k,D;return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-2 rounded-md border border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n.description}),n.specs&&e.jsx("div",{className:"text-xs text-gray-500",children:n.specs})]}),e.jsx("div",{className:"w-28 text-center text-sm",children:n.quantity}),e.jsxs("div",{className:"w-28 text-right text-sm",children:["₱",(k=n.unitCost)==null?void 0:k.toFixed(2)]}),e.jsxs("div",{className:"w-28 text-right text-sm",children:["₱",(D=n.totalCost)==null?void 0:D.toFixed(2)]}),e.jsx("div",{className:"w-32 text-right text-xs",children:n.date})]},$)})})})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(Me,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No ICS records found"})]})})})})]})})}),((J=j==null?void 0:j.links)==null?void 0:J.length)>3&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:j.links.map((t,i)=>e.jsx(Fe,{href:t.url||"#",className:`
                  px-3 py-1 text-sm rounded-md
                  ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
                  ${!t.url&&"opacity-50 cursor-not-allowed"}
                `,dangerouslySetInnerHTML:{__html:t.label}},i))})]}),e.jsx(xe,{open:we,onOpenChange:Q,children:e.jsxs(ue,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(pe,{className:"pb-3 border-b border-gray-100",children:[e.jsx(he,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Return Items"}),e.jsx(ye,{className:"text-sm text-gray-500",children:"Select items to return and specify whether they are for reissuance or disposal."})]}),T?(()=>{const t=(T.items||[]).filter(s=>s.type==="low"),i=t.every(s=>{const a=Number(s.quantity??0),r=Number(s.total_reissued_quantity??0),l=Number(s.total_disposed_quantity??0);return r+l>=a});return console.log("allItemsProcessed",i),e.jsxs("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:[!i&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2 py-1 rounded-md hover:bg-gray-100",children:[e.jsx("input",{id:"select-all-return",type:"checkbox",checked:t.filter(s=>{const a=Number(s.quantity??0),r=Number(s.total_reissued_quantity??0),l=Number(s.total_disposed_quantity??0);return r+l<a}).every(s=>C.includes(s.id)),onChange:s=>{if(s.target.checked){const a=t.filter(r=>{const l=Number(r.quantity??0),o=Number(r.total_reissued_quantity??0),c=Number(r.total_disposed_quantity??0);return o+c<l}).map(r=>r.id);I(r=>[...new Set([...r,...a])])}else{const a=t.map(r=>r.id);I(r=>r.filter(l=>!a.includes(l)))}},className:"h-4 w-4 accent-blue-600"}),e.jsx("label",{htmlFor:"select-all-return",className:"text-sm font-medium text-gray-700 cursor-pointer select-none",children:"Select all"})]}),i?e.jsxs("div",{className:"p-4 text-center text-gray-500 text-sm italic bg-gray-50 rounded-md border border-gray-200",children:["All items in this issuance have already been"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"reissued"})," or"," ",e.jsx("span",{className:"font-semibold text-rose-600",children:"disposed"}),"."]}):t.map(s=>{var h,y,b,g,f;const a=((y=(h=s.inventoryItem)==null?void 0:h.product)==null?void 0:y.name)??((b=s.inventory_item)==null?void 0:b.item_desc)??"N/A",r=((f=(g=s.inventoryItem)==null?void 0:g.product)==null?void 0:f.specs)??"",l=Number(s.quantity??0),o=Number(s.total_reissued_quantity??0),c=Number(s.total_disposed_quantity??0),d=o+c,u=Math.max(l-d,0),m=d>=l;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${C.includes(s.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"} ${m?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:C.includes(s.id),disabled:m,onChange:w=>{m||I(N=>w.target.checked?[...N,s.id]:N.filter(_=>_!==s.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-gray-800",children:a}),m?e.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 border border-gray-300",children:"Fully processed"}):d>0?e.jsxs("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-300",children:["Some Items are returned (",d,"/",l,")"]}):e.jsxs("span",{className:"text-xs text-gray-600",children:["Remaining: ",u]})]}),r&&e.jsx("div",{className:"text-gray-500 text-xs",children:r}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",s.quantity," | ₱",Number(s.unit_cost??0).toFixed(2)]}),(o>0||c>0)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Returned:"," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:[o," reissued"]})," ","|"," ",e.jsxs("span",{className:"text-rose-600 font-medium",children:[c," disposed"]})]})]})]},s.id)})]})})():e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs("div",{className:"mt-5 border-t pt-4",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${p==="reissuance"?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"reissuance",checked:p==="reissuance",onChange:t=>M(t.target.value),className:"h-4 w-4 accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Reissuance"})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${p==="disposal"?"border-rose-400 bg-rose-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"disposal",checked:p==="disposal",onChange:t=>M(t.target.value),className:"h-4 w-4 accent-rose-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Disposal"})]})]})]}),e.jsxs(be,{className:"pt-5 border-t mt-4",children:[e.jsx(S,{variant:"outline",className:"w-28",onClick:()=>{Q(!1),I([]),M(""),E(null)},children:"Cancel"}),e.jsx(S,{className:`w-28 text-white ${p==="disposal"?"bg-rose-600 hover:bg-rose-700":"bg-blue-600 hover:bg-blue-700"}`,disabled:!C.length||!p,onClick:()=>{if((T.items||[]).filter(a=>a.type==="low").every(a=>{const r=Number(a.quantity??0),l=Number(a.total_reissued_quantity??0),o=Number(a.total_disposed_quantity??0);return l+o>=r})){O({title:"All items already processed",description:"There are no items left to return.",variant:"destructive"});return}if(C.length===0){O({title:"No items selected",description:"Please select at least one item to return.",variant:"destructive"});return}if(!p){O({title:"No return type chosen",description:"Please specify whether this return is for reissuance or disposal.",variant:"destructive"});return}const s=p==="reissuance"?"supply_officer.return_form":"supply_officer.disposal_form";me.visit(route(s,{id:T.id,type:"ics",items:C.join(",")})),Q(!1)},children:"Proceed"})]})]})}),e.jsx(xe,{open:Se,onOpenChange:Y,children:e.jsxs(ue,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(pe,{className:"pb-3 border-b border-gray-100",children:[e.jsx(he,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(ye,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),A?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(A.items||[]).filter(t=>t.type==="low").map(t=>{var a,r,l,o,c;const i=((r=(a=t.inventoryItem)==null?void 0:a.product)==null?void 0:r.name)??((l=t.inventory_item)==null?void 0:l.item_desc)??"N/A",s=((c=(o=t.inventoryItem)==null?void 0:o.product)==null?void 0:c.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${P.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:P.includes(t.id),onChange:d=>{z(u=>d.target.checked?[...u,t.id]:u.filter(m=>m!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:i}),s&&e.jsx("div",{className:"text-gray-500 text-xs",children:s}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | ₱",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(be,{className:"pt-5 border-t mt-4",children:[e.jsx(S,{variant:"outline",className:"w-28",onClick:()=>{Y(!1),z([]),W(null)},children:"Cancel"}),e.jsx(S,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!P.length,onClick:()=>{var t;me.visit(route("supply_officer.switch_type",{type:"ics",id:A.id,po_id:(t=A.po)==null?void 0:t.id,items:P}))},children:"Continue"})]})]})})]})}export{nt as default};
