import{a as m,j as e,H as G,R as V,L as K,c as W}from"./app-duXzzImO.js";import{I as X,C as Z}from"./IssuanceTabs-CQjQBwpW.js";import{S as ee}from"./SupplyOfficerLayout-DAWeFtbK.js";import{B as F}from"./button-D0lWBgCo.js";import{D as te,a as se,b as ae,c as ie,d as ne,e as re}from"./dialog-DS-DoP21.js";import{P as le}from"./printer-check-C7ueVJzn.js";import{C as ce}from"./circle-plus-BrNsblV1.js";import{F as oe}from"./file-text-CrQxbWaj.js";import"./createLucideIcon-CoZQ0qwL.js";import"./Dropdown-BojfYhBj.js";import"./transition-Bfb6yI_i.js";import"./toaster-JLrAUcr0.js";import"./use-toast-D7hdoR5h.js";import"./index-CoOSbRev.js";import"./index-CSqca6Ux.js";import"./utils-C5BPRwjQ.js";import"./index-CceKmL_e.js";import"./XMarkIcon-Ck-zhzh-.js";import"./clipboard-check-BvuVqT1z.js";import"./package-check-B7ZPt8qY.js";import"./trash-DrTsnkm2.js";import"./index-3jnUzLIS.js";function Ae({purchaseOrders:de,inventoryItems:H,ris:i,user:me}){var M,k,A;const[l,Y]=m.useState(""),[y,E]=m.useState(""),[g,O]=m.useState(new Date().getFullYear()),[z,B]=m.useState([]),J=t=>{B(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])};new Map(H.map(t=>{var s;return[`${t.item_desc}_${(s=t.inventory)==null?void 0:s.unit}`,t.inventory]}));const C=new Map;(M=i==null?void 0:i.data)==null||M.forEach(t=>{const s=`${t.po_id}_${t.inventory_item_id}`;C.has(s)||C.set(s,[]),C.get(s).push(t)});const D=((k=i==null?void 0:i.data)==null?void 0:k.map(t=>{var a;const s=(a=t.items)==null?void 0:a.filter(n=>{var j,b,f,N,w;const x=((j=t.ris_number)==null?void 0:j.toLowerCase())??"",c=((b=n.recipient)==null?void 0:b.toLowerCase())??"",o=((f=n.recipient_division)==null?void 0:f.toLowerCase())??"",d=((w=(N=n.inventory_item)==null?void 0:N.item_desc)==null?void 0:w.toLowerCase())??"",p=x.includes(l.toLowerCase())||o.includes(l.toLowerCase())||c.includes(l.toLowerCase())||d.includes(l.toLowerCase()),r=n.created_at?new Date(n.created_at):null,h=y?r&&r.getMonth()+1===parseInt(y):!0,S=g?r&&r.getFullYear()===parseInt(g):!0;return p&&h&&S});return s.length===0?null:{...t,items:s}}).filter(Boolean))||[],[Q,I]=m.useState(!1),[v,R]=m.useState([]),[_,L]=m.useState(null);return e.jsxs(ee,{header:"Schools Divisions Office - Ilagan | Requisition and Issue Slip",children:[e.jsx(G,{title:"RIS"}),e.jsx(X,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Requisition and Issue Slip (RIS)"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>{const t=new URLSearchParams;y&&t.append("month",y),g&&t.append("year",g),l&&t.append("search",l),window.location.href=route("supply_officer.generate_report")+"?"+t.toString()},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-7 py-1 text-sm",value:y,onChange:t=>E(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map((t,s)=>e.jsx("option",{value:s+1,children:t},s))]}),e.jsx("label",{className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-20 text-sm",value:g,onChange:t=>O(t.target.value)})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search Focal Person, RIS number...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm",value:l,onChange:t=>Y(t.target.value)})})]}),e.jsx("div",{className:"overflow-x-auto mt-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-semibold uppercase tracking-wider text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"RIS No."}),e.jsx("th",{className:"px-4 py-3",children:"Division"}),e.jsx("th",{className:"px-4 py-3",children:"Issued To / Focal Person"}),e.jsx("th",{className:"px-4 py-3",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:D&&D.length>0?D.map((t,s)=>{var c,o,d,p,r,h,S,j,b,f,N,w,P;const a=z.includes(t.id);a?t.items:t.items.slice(0,1);const n=((o=(c=t.items)==null?void 0:c[0])==null?void 0:o.recipient)??"N/A",x=((p=(d=t.items)==null?void 0:d[0])==null?void 0:p.recipient_division)??"N/A";return e.jsxs(V.Fragment,{children:[e.jsxs("tr",{className:"bg-white hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-blue-600 font-medium",children:t.ris_number}),e.jsx("td",{className:"px-4 py-3",children:x}),e.jsx("td",{className:"px-4 py-3",children:n}),e.jsx("td",{className:"px-4 py-3 font-medium",children:((h=(r=t.items[0])==null?void 0:r.inventory_item)==null?void 0:h.item_desc)??"N/A"}),e.jsx("td",{className:"px-4 py-3 text-center",children:((S=t.items[0])==null?void 0:S.quantity)??0}),e.jsx("td",{className:"px-4 py-3 text-right",children:Number(((b=(j=t.items[0])==null?void 0:j.inventory_item)==null?void 0:b.unit_cost)??0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:((((f=t.items[0])==null?void 0:f.quantity)??0)*(((w=(N=t.items[0])==null?void 0:N.inventory_item)==null?void 0:w.unit_cost)??0)).toFixed(2)}),e.jsx("td",{className:"px-4 py-3",children:new Date((P=t.items[0])==null?void 0:P.created_at).toLocaleDateString("en-PH")}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs("a",{href:route("supply_officer.print_ris",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium",children:[e.jsx(le,{size:14})," Print"]}),e.jsx(F,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",onClick:()=>{L(t),R([]),I(!0)},children:"Switch Type"})]}),t.items.length>1&&e.jsx("button",{onClick:()=>J(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{size:14})," Show More (",t.items.length-1," more)"]})})]})]}),a&&t.items.slice(1).map((u,U)=>{var T,$,q;return e.jsxs("tr",{className:"bg-gray-50 hover:bg-blue-50 transition",children:[e.jsx("td",{colSpan:"4"}),e.jsx("td",{className:"px-4 py-3 font-medium",children:((T=u.inventory_item)==null?void 0:T.item_desc)??"N/A"}),e.jsx("td",{className:"px-4 py-3 text-center",children:u.quantity}),e.jsx("td",{className:"px-4 py-3 text-right",children:Number((($=u.inventory_item)==null?void 0:$.unit_cost)??0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:((u.quantity??0)*(((q=u.inventory_item)==null?void 0:q.unit_cost)??0)).toFixed(2)}),e.jsx("td",{className:"px-4 py-3",children:new Date(u.created_at).toLocaleDateString("en-PH")}),e.jsx("td",{})]},`${t.id}-${U}`)})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(oe,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No RIS records found"})]})})})})]})}),((A=i==null?void 0:i.links)==null?void 0:A.length)>3&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:i.links.map((t,s)=>e.jsx(K,{href:t.url||"#",className:`
                  px-3 py-1 text-sm rounded-md
                  ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
                  ${!t.url&&"opacity-50 cursor-not-allowed"}
                `,dangerouslySetInnerHTML:{__html:t.label}},s))})]}),e.jsx(te,{open:Q,onOpenChange:I,children:e.jsxs(se,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(ae,{className:"pb-3 border-b border-gray-100",children:[e.jsx(ie,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(ne,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),_?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(_.items||[]).map(t=>{var n,x,c,o,d;const s=((x=(n=t.inventoryItem)==null?void 0:n.product)==null?void 0:x.name)??((c=t.inventory_item)==null?void 0:c.item_desc)??"N/A",a=((d=(o=t.inventoryItem)==null?void 0:o.product)==null?void 0:d.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${v.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:v.includes(t.id),onChange:p=>{R(r=>p.target.checked?[...r,t.id]:r.filter(h=>h!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:s}),a&&e.jsx("div",{className:"text-gray-500 text-xs",children:a}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | â‚±",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(re,{className:"pt-5 border-t mt-4",children:[e.jsx(F,{variant:"outline",className:"w-28",onClick:()=>{I(!1),R([]),L(null)},children:"Cancel"}),e.jsx(F,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!v.length,onClick:()=>{var t;W.visit(route("supply_officer.switch_type",{type:"ris",id:_.id,po_id:(t=_.po)==null?void 0:t.id,items:v}))},children:"Continue"})]})]})})]})}export{Ae as default};
