import{R as He,a as d,u as ft,b as pt,j as t,H as mt,c as fe,d as bt}from"./app-LDdax5iI.js";import{A as gt}from"./ApproverLayout-C6aE8AgB.js";import{D as Pe,a as Te,b as Fe,c as Le,d as ke,e as De}from"./dialog-BptqLqxd.js";import{S as pe}from"./sweetalert2.esm.all-Bj_ZQUAw.js";import{u as xt}from"./use-toast--kWwOmJE.js";import{S as ht}from"./scroll-text-wwENyQ9K.js";import{F as vt}from"./file-plus-2-C3UtPyy2.js";import{F as yt}from"./PencilSquareIcon-DvlGYiVh.js";import{T as wt}from"./trash-2-twcLAB17.js";import{S as $t}from"./save-CvVoZd7p.js";import{C as jt}from"./circle-check-CqM9xjWR.js";import{l as Et,a as St,n as Nt}from"./disabled-DzIZtjFG.js";import{p as _t,o as Ae,Y as Ct,V as Pt,K as Tt}from"./transition-_9UKH1s9.js";import"./Dropdown-C8_SUBrT.js";import"./toaster-BItjg4iY.js";import"./index-GtxlS3ZO.js";import"./index-BDPPaT4y.js";import"./createLucideIcon-DrNxoqAN.js";import"./utils-C-fxeSCl.js";import"./index-DQeU0o6N.js";import"./index-BFDba8cI.js";import"./XMarkIcon-CEFFAdab.js";import"./file-text-B6ni5wgy.js";import"./index-BwQ9obGD.js";const Oe=typeof document<"u"?He.useLayoutEffect:()=>{};var me;const Ft=(me=He.useInsertionEffect)!==null&&me!==void 0?me:Oe;function Lt(e){const r=d.useRef(null);return Ft(()=>{r.current=e},[e]),d.useCallback((...n)=>{const o=r.current;return o==null?void 0:o(...n)},[])}const D=e=>{var r;return(r=e==null?void 0:e.ownerDocument)!==null&&r!==void 0?r:document},A=e=>e&&"window"in e&&e.window===e?e:D(e).defaultView||window;function kt(e){return e!==null&&typeof e=="object"&&"nodeType"in e&&typeof e.nodeType=="number"}function Dt(e){return kt(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"host"in e}let At=!1;function ye(){return At}function Be(e,r){if(!ye())return r&&e?e.contains(r):!1;if(!e||!r)return!1;let n=r;for(;n!==null;){if(n===e)return!0;n.tagName==="SLOT"&&n.assignedSlot?n=n.assignedSlot.parentNode:Dt(n)?n=n.host:n=n.parentNode}return!1}const be=(e=document)=>{var r;if(!ye())return e.activeElement;let n=e.activeElement;for(;n&&"shadowRoot"in n&&(!((r=n.shadowRoot)===null||r===void 0)&&r.activeElement);)n=n.shadowRoot.activeElement;return n};function Re(e){return ye()&&e.target.shadowRoot&&e.composedPath?e.composedPath()[0]:e.target}function Mt(e){var r;if(typeof window>"u"||window.navigator==null)return!1;let n=(r=window.navigator.userAgentData)===null||r===void 0?void 0:r.brands;return Array.isArray(n)&&n.some(o=>e.test(o.brand))||e.test(window.navigator.userAgent)}function Ht(e){var r;return typeof window<"u"&&window.navigator!=null?e.test(((r=window.navigator.userAgentData)===null||r===void 0?void 0:r.platform)||window.navigator.platform):!1}function Ie(e){let r=null;return()=>(r==null&&(r=e()),r)}const Ot=Ie(function(){return Ht(/^Mac/i)}),Bt=Ie(function(){return Mt(/Android/i)});function We(){let e=d.useRef(new Map),r=d.useCallback((a,p,b,u)=>{let m=u!=null&&u.once?(...g)=>{e.current.delete(b),b(...g)}:b;e.current.set(b,{type:p,eventTarget:a,fn:m,options:u}),a.addEventListener(p,m,u)},[]),n=d.useCallback((a,p,b,u)=>{var m;let g=((m=e.current.get(b))===null||m===void 0?void 0:m.fn)||b;a.removeEventListener(p,g,u),e.current.delete(b)},[]),o=d.useCallback(()=>{e.current.forEach((a,p)=>{n(a.eventTarget,a.type,p,a.options)})},[n]);return d.useEffect(()=>o,[o]),{addGlobalListener:r,removeGlobalListener:n,removeAllGlobalListeners:o}}function Rt(e){return e.pointerType===""&&e.isTrusted?!0:Bt()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function Ve(e){let r=e;return r.nativeEvent=e,r.isDefaultPrevented=()=>r.defaultPrevented,r.isPropagationStopped=()=>r.cancelBubble,r.persist=()=>{},r}function It(e,r){Object.defineProperty(e,"target",{value:r}),Object.defineProperty(e,"currentTarget",{value:r})}function Qe(e){let r=d.useRef({isFocused:!1,observer:null});Oe(()=>{const o=r.current;return()=>{o.observer&&(o.observer.disconnect(),o.observer=null)}},[]);let n=Lt(o=>{e==null||e(o)});return d.useCallback(o=>{if(o.target instanceof HTMLButtonElement||o.target instanceof HTMLInputElement||o.target instanceof HTMLTextAreaElement||o.target instanceof HTMLSelectElement){r.current.isFocused=!0;let a=o.target,p=b=>{if(r.current.isFocused=!1,a.disabled){let u=Ve(b);n(u)}r.current.observer&&(r.current.observer.disconnect(),r.current.observer=null)};a.addEventListener("focusout",p,{once:!0}),r.current.observer=new MutationObserver(()=>{if(r.current.isFocused&&a.disabled){var b;(b=r.current.observer)===null||b===void 0||b.disconnect();let u=a===document.activeElement?null:document.activeElement;a.dispatchEvent(new FocusEvent("blur",{relatedTarget:u})),a.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:u}))}}),r.current.observer.observe(a,{attributes:!0,attributeFilter:["disabled"]})}},[n])}let Wt=!1,U=null,ge=new Set,K=new Map,M=!1,xe=!1;const Vt={Tab:!0,Escape:!0};function we(e,r){for(let n of ge)n(e,r)}function Qt(e){return!(e.metaKey||!Ot()&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}function te(e){M=!0,Qt(e)&&(U="keyboard",we("keyboard",e))}function B(e){U="pointer",(e.type==="mousedown"||e.type==="pointerdown")&&(M=!0,we("pointer",e))}function Ge(e){Rt(e)&&(M=!0,U="virtual")}function Ke(e){e.target===window||e.target===document||Wt||!e.isTrusted||(!M&&!xe&&(U="virtual",we("virtual",e)),M=!1,xe=!1)}function Ue(){M=!1,xe=!0}function he(e){if(typeof window>"u"||typeof document>"u"||K.get(A(e)))return;const r=A(e),n=D(e);let o=r.HTMLElement.prototype.focus;r.HTMLElement.prototype.focus=function(){M=!0,o.apply(this,arguments)},n.addEventListener("keydown",te,!0),n.addEventListener("keyup",te,!0),n.addEventListener("click",Ge,!0),r.addEventListener("focus",Ke,!0),r.addEventListener("blur",Ue,!1),typeof PointerEvent<"u"&&(n.addEventListener("pointerdown",B,!0),n.addEventListener("pointermove",B,!0),n.addEventListener("pointerup",B,!0)),r.addEventListener("beforeunload",()=>{qe(e)},{once:!0}),K.set(r,{focus:o})}const qe=(e,r)=>{const n=A(e),o=D(e);r&&o.removeEventListener("DOMContentLoaded",r),K.has(n)&&(n.HTMLElement.prototype.focus=K.get(n).focus,o.removeEventListener("keydown",te,!0),o.removeEventListener("keyup",te,!0),o.removeEventListener("click",Ge,!0),n.removeEventListener("focus",Ke,!0),n.removeEventListener("blur",Ue,!1),typeof PointerEvent<"u"&&(o.removeEventListener("pointerdown",B,!0),o.removeEventListener("pointermove",B,!0),o.removeEventListener("pointerup",B,!0)),K.delete(n))};function Gt(e){const r=D(e);let n;return r.readyState!=="loading"?he(e):(n=()=>{he(e)},r.addEventListener("DOMContentLoaded",n)),()=>qe(e,n)}typeof document<"u"&&Gt();function Ye(){return U!=="pointer"}const Kt=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function Ut(e,r,n){let o=D(n==null?void 0:n.target);const a=typeof window<"u"?A(n==null?void 0:n.target).HTMLInputElement:HTMLInputElement,p=typeof window<"u"?A(n==null?void 0:n.target).HTMLTextAreaElement:HTMLTextAreaElement,b=typeof window<"u"?A(n==null?void 0:n.target).HTMLElement:HTMLElement,u=typeof window<"u"?A(n==null?void 0:n.target).KeyboardEvent:KeyboardEvent;return e=e||o.activeElement instanceof a&&!Kt.has(o.activeElement.type)||o.activeElement instanceof p||o.activeElement instanceof b&&o.activeElement.isContentEditable,!(e&&r==="keyboard"&&n instanceof u&&!Vt[n.key])}function qt(e,r,n){he(),d.useEffect(()=>{let o=(a,p)=>{Ut(!!(n!=null&&n.isTextInput),a,p)&&e(Ye())};return ge.add(o),()=>{ge.delete(o)}},r)}function Yt(e){let{isDisabled:r,onFocus:n,onBlur:o,onFocusChange:a}=e;const p=d.useCallback(m=>{if(m.target===m.currentTarget)return o&&o(m),a&&a(!1),!0},[o,a]),b=Qe(p),u=d.useCallback(m=>{const g=D(m.target),E=g?be(g):be();m.target===m.currentTarget&&E===Re(m.nativeEvent)&&(n&&n(m),a&&a(!0),b(m))},[a,n,b]);return{focusProps:{onFocus:!r&&(n||a||o)?u:void 0,onBlur:!r&&(o||a)?p:void 0}}}function zt(e){let{isDisabled:r,onBlurWithin:n,onFocusWithin:o,onFocusWithinChange:a}=e,p=d.useRef({isFocusWithin:!1}),{addGlobalListener:b,removeAllGlobalListeners:u}=We(),m=d.useCallback(y=>{y.currentTarget.contains(y.target)&&p.current.isFocusWithin&&!y.currentTarget.contains(y.relatedTarget)&&(p.current.isFocusWithin=!1,u(),n&&n(y),a&&a(!1))},[n,a,p,u]),g=Qe(m),E=d.useCallback(y=>{if(!y.currentTarget.contains(y.target))return;const _=D(y.target),$=be(_);if(!p.current.isFocusWithin&&$===Re(y.nativeEvent)){o&&o(y),a&&a(!0),p.current.isFocusWithin=!0,g(y);let S=y.currentTarget;b(_,"focus",x=>{if(p.current.isFocusWithin&&!Be(S,x.target)){let N=new _.defaultView.FocusEvent("blur",{relatedTarget:x.target});It(N,S);let C=Ve(N);m(C)}},{capture:!0})}},[o,a,g,b,m]);return r?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:E,onBlur:m}}}let ve=!1,Z=0;function Xt(){ve=!0,setTimeout(()=>{ve=!1},50)}function Me(e){e.pointerType==="touch"&&Xt()}function Jt(){if(!(typeof document>"u"))return Z===0&&typeof PointerEvent<"u"&&document.addEventListener("pointerup",Me),Z++,()=>{Z--,!(Z>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",Me)}}function Zt(e){let{onHoverStart:r,onHoverChange:n,onHoverEnd:o,isDisabled:a}=e,[p,b]=d.useState(!1),u=d.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;d.useEffect(Jt,[]);let{addGlobalListener:m,removeAllGlobalListeners:g}=We(),{hoverProps:E,triggerHoverEnd:y}=d.useMemo(()=>{let _=(x,N)=>{if(u.pointerType=N,a||N==="touch"||u.isHovered||!x.currentTarget.contains(x.target))return;u.isHovered=!0;let C=x.currentTarget;u.target=C,m(D(x.target),"pointerover",R=>{u.isHovered&&u.target&&!Be(u.target,R.target)&&$(R,R.pointerType)},{capture:!0}),r&&r({type:"hoverstart",target:C,pointerType:N}),n&&n(!0),b(!0)},$=(x,N)=>{let C=u.target;u.pointerType="",u.target=null,!(N==="touch"||!u.isHovered||!C)&&(u.isHovered=!1,g(),o&&o({type:"hoverend",target:C,pointerType:N}),n&&n(!1),b(!1))},S={};return typeof PointerEvent<"u"&&(S.onPointerEnter=x=>{ve&&x.pointerType==="mouse"||_(x,x.pointerType)},S.onPointerLeave=x=>{!a&&x.currentTarget.contains(x.target)&&$(x,x.pointerType)}),{hoverProps:S,triggerHoverEnd:$}},[r,n,o,a,u,m,g]);return d.useEffect(()=>{a&&y({currentTarget:u.target},u.pointerType)},[a]),{hoverProps:E,isHovered:p}}function er(e={}){let{autoFocus:r=!1,isTextInput:n,within:o}=e,a=d.useRef({isFocused:!1,isFocusVisible:r||Ye()}),[p,b]=d.useState(!1),[u,m]=d.useState(()=>a.current.isFocused&&a.current.isFocusVisible),g=d.useCallback(()=>m(a.current.isFocused&&a.current.isFocusVisible),[]),E=d.useCallback($=>{a.current.isFocused=$,b($),g()},[g]);qt($=>{a.current.isFocusVisible=$,g()},[],{isTextInput:n});let{focusProps:y}=Yt({isDisabled:o,onFocusChange:E}),{focusWithinProps:_}=zt({isDisabled:!o,onFocusWithinChange:E});return{isFocused:p,isFocusVisible:u,focusProps:o?_:y}}function tr(e){let r=e.width/2,n=e.height/2;return{top:e.clientY-n,right:e.clientX+r,bottom:e.clientY+n,left:e.clientX-r}}function rr(e,r){return!(!e||!r||e.right<r.left||e.left>r.right||e.bottom<r.top||e.top>r.bottom)}function nr({disabled:e=!1}={}){let r=d.useRef(null),[n,o]=d.useState(!1),a=_t(),p=Ae(()=>{r.current=null,o(!1),a.dispose()}),b=Ae(u=>{if(a.dispose(),r.current===null){r.current=u.currentTarget,o(!0);{let m=Et(u.currentTarget);a.addEventListener(m,"pointerup",p,!1),a.addEventListener(m,"pointermove",g=>{if(r.current){let E=tr(g);o(rr(E,r.current.getBoundingClientRect()))}},!1),a.addEventListener(m,"pointercancel",p,!1)}}});return{pressed:n,pressProps:e?{}:{onPointerDown:b,onPointerUp:p,onClick:p}}}let sr="button";function ir(e,r){var n;let o=St(),{disabled:a=o||!1,autoFocus:p=!1,...b}=e,{isFocusVisible:u,focusProps:m}=er({autoFocus:p}),{isHovered:g,hoverProps:E}=Zt({isDisabled:a}),{pressed:y,pressProps:_}=nr({disabled:a}),$=Pt({ref:r,type:(n=b.type)!=null?n:"button",disabled:a||void 0,autoFocus:p},m,E,_),S=Nt({disabled:a,hover:g,focus:u,active:y,autofocus:p});return Tt()({ourProps:$,theirProps:b,slot:S,defaultTag:sr,name:"Button"})}let ee=Ct(ir);function kr({pr:e,suppliers:r,rfqs:n,purchaseRequest:o,rfq_details:a}){var Ne,_e,Ce;const{toast:p}=xt();d.useEffect(()=>{if(a&&a.length>0){const s={};a.forEach(i=>{s[i.pr_details_id]||(s[i.pr_details_id]=[]),s[i.pr_details_id].includes(i.supplier_id)||s[i.pr_details_id].push(i.supplier_id)}),X(s)}},[a]);const[b,u]=d.useState(""),[m,g]=d.useState(null);d.useRef({});const[E,y]=d.useState(r??[]),[_,$]=d.useState(""),[S,x]=d.useState(1),N=5,[C,R]=d.useState(""),[ze,I]=d.useState(!1),[W,Xe]=d.useState({title:"",message:"",type:"success"}),[$e,re]=d.useState(null),[q,F]=d.useState(null),[Y,z]=d.useState({}),[Je,H]=d.useState(!1),[j,Ze]=d.useState(null),[or,et]=d.useState(!1),[tt,V]=d.useState(!1),[ne,X]=d.useState({}),[Q,G]=d.useState({representative_name:"",company_name:"",address:"",tin_num:""}),[se,ie]=d.useState(()=>{const s={};return e.details&&e.details.forEach(i=>{s[i.id]=i.unit_price||""}),s}),{data:ar,setData:oe}=ft({pr_id:e.id,user_id:((Ne=o==null?void 0:o.focal_person)==null?void 0:Ne.id)??null,supplier_id:"",selections:[]}),T=({title:s,message:i,type:f,onConfirm:l=null})=>{Xe({title:s,message:i,type:f}),re(()=>l),I(!0)},rt=(s,i,f,l)=>{s.preventDefault();const c=l===""?null:l;T({title:"Confirm Submission",message:"Are you sure you want to submit this quoted price?",type:"confirm",onConfirm:()=>ae(i,f,c)})},nt=(s,i)=>{const f=a.find(l=>l.pr_details_id===s&&l.supplier_id===i);return(f==null?void 0:f.quoted_price)??null},ae=(s,i,f,l=null)=>{const c=f===""?null:f,h={pr_id:e.id,pr_details_id:s,supplier_id:i,quoted_price:c},w=l||`${s}-${i}`;F(w),fe.post(route("bac_user.submit_quoted"),h,{preserveScroll:!0,onSuccess:()=>{F(null),l&&de(P=>{const v={...P};return delete v[l],v}),T({title:"Submitted!",message:"Quoted price submitted successfully.",type:"success"})},onError:P=>{F(null),T({title:"Oops!",message:(P==null?void 0:P.quoted_price)||"Something went wrong while submitting.",type:"error"})}})},st=()=>{T({title:"Confirm Bulk Submission",message:"Are you sure you want to submit all quoted prices?",type:"confirm",onConfirm:()=>it()})},it=()=>{if(!m)return;const s=e.details.map(i=>{const f=`${i.id}-${m}`,l=Y[f],c=l===""?null:l;return l!==void 0?{pr_id:e.id,pr_details_id:i.id,supplier_id:m,quoted_price:c}:null}).filter(i=>i!==null);if(s.length===0){T({title:"No Prices to Submit",message:"Please enter at least one quoted price before submitting all.",type:"warning"});return}F("all"),fe.post(route("bac_user.submit_bulk_quoted"),{quotes:s},{preserveScroll:!0,onSuccess:()=>{console.log("Bulk submitted successfully"),z(i=>{const f={...i};return s.forEach(l=>{delete f[`${l.pr_details_id}-${l.supplier_id}`]}),f}),F(null),T({title:"All Quoted Prices Submitted!",message:"All prices for this supplier have been submitted successfully.",type:"success"})},onError:i=>{console.error("Bulk submission failed",i),F(null),T({title:"Oops!",message:(i==null?void 0:i.quoted_price)||"Something went wrong while submitting all prices.",type:"error"})}})},J=(s,i,f)=>{oe(l=>{const c=(l.selections||[]).filter(h=>!(h.pr_detail_id===s&&h.supplier_id===i));return{...l,selections:[...c,{pr_detail_id:s,supplier_id:i,estimated_bid:f}]}})},ot=s=>{Ze(s),et(!1),H(!0);const i=e.details.find(f=>f.id===s);if(i){const f=i.unit_price||"";ie(l=>({...l,[s]:f})),oe(l=>({...l,estimated_bid:f}))}},{flash:L}=pt().props,at=async s=>{var i,f;s.preventDefault();try{const c=(await bt.post(route("bac_user.store_supplier"),Q)).data.supplier;y(v=>[...v,c]),$(String(c.id));const h=c.id,P=(j===null?"":se[j]||"").toString().trim()||((f=(i=e.details)==null?void 0:i.find(v=>v.id===j))==null?void 0:f.unit_price)||"";j!==null?J(j,h,P):e.details.forEach(v=>{const k=v.unit_price||"";J(v.id,h,k)}),G({company_name:"",address:"",tin_num:"",representative_name:""}),V(!1),H(!1)}catch(l){l.response?console.error("Server error:",l.response.data):console.error("Error adding supplier:",l.message),pe.fire("Error","Failed to add supplier. Please try again.","error")}};j&&((_e=e.details)!=null&&_e.length)&&e.details.find(s=>s.id===j);const je=E.filter(s=>{var f,l,c;if(!C)return!0;const i=C.toLowerCase();return((f=s.representative_name)==null?void 0:f.toLowerCase().includes(i))||((l=s.company_name)==null?void 0:l.toLowerCase().includes(i))||((c=s.address)==null?void 0:c.toLowerCase().includes(i))}).filter(s=>!a.some(i=>i.pr_details_id===j&&i.supplier_id===s.id));d.useEffect(()=>{x(1)},[C]);const le=Math.ceil(je.length/N),Ee=S*N,lt=Ee-N,Se=je.slice(lt,Ee),[O,de]=d.useState({}),dt=(s,i,f)=>{F(f),fe.delete(route("bac_user.delete_quoted"),{data:{pr_id:e.id,pr_details_id:s,supplier_id:i},preserveScroll:!0,onSuccess:()=>{F(null),z(l=>{const c={...l};return delete c[f],c}),de(l=>{const c={...l};return delete c[f],c}),X(l=>{const c={...l};return Array.isArray(c[s])&&(c[s]=c[s].filter(h=>h!==i),c[s].length===0&&delete c[s]),c}),p({title:"Deleted",description:"Quoted price removed successfully.",variant:"default",setTimeout:3e3}),T({title:"Deleted!"})},onFinish:l=>{F(null),L!=null&&L.message&&(p({title:L.status==="success"?"Deleted":"Error",description:L.message,variant:L.status==="success"?"default":"destructive",setTimeout:3e3}),T({title:L.status==="success"?"Deleted!":"Error!",description:L.message}))},onError:()=>{F(null),p({title:"Error",description:"Could not delete quoted price.",variant:"destructive",setTimeout:3e3}),T({title:"Error!"})}})},[ct,ce]=d.useState(!1),[lr,ut]=d.useState([]);return t.jsxs(gt,{children:[t.jsx(mt,{title:"Enter Quoted Prices"}),t.jsxs("div",{className:"mx-auto px-6 py-10",children:[t.jsx("div",{className:"mb-8",children:t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx(ht,{className:"w-8 h-8 text-indigo-700"}),"Enter Quoted Prices for PR: ",e.pr_number]})}),t.jsx("div",{className:"mb-4",children:t.jsx("a",{type:"button",href:route("bac_user.for_quotations"),className:"inline-flex items-center px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"â† Back"})}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2 border-b pb-2",children:[t.jsx(vt,{className:"w-5 h-5 text-indigo-600"}),"Purchase Request Info"]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"PR Number:"})," ",e.pr_number]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Purpose:"})," ",e.purpose]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Requested By:"})," ",e.requester_name]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Division:"})," ",e.division]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Created:"})," ",new Date(e.created_at).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Focal Person:"})," ",(Ce=o==null?void 0:o.focal_person)==null?void 0:Ce.firstname]})]})]}),t.jsxs("div",{className:"xl:col-span-2 space-y-10",children:[e.details.map(s=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("div",{className:"mb-4 border-b pb-3",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-700",children:[s.item,t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",s.specs,")"]})]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-2 grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Unit:"})," ",s.unit]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Quantity:"})," ",s.quantity]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Est. Price per Unit:"})," â‚±",Number(s.unit_price||0).toLocaleString()]})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>ot(s.id),className:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm shadow-sm",children:"Choose Supplier"}),t.jsx("button",{onClick:()=>V(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"âž• Add New Supplier"})]}),t.jsx("div",{className:"space-y-6 mt-6",children:Array.isArray(ne[s.id])&&ne[s.id].map(i=>{const f=E.find(v=>v.id===i);if(!f)return null;const l=`${s.id}-${i}`,c=q===l,h=nt(s.id,i),w=h!==null;s.unit_price;const P=v=>{let k=parseFloat(v.target.value);isNaN(k)&&(k=""),z(ue=>({...ue,[l]:k}))};return t.jsxs("form",{onSubmit:v=>{v.preventDefault();const k=Y[l]??"",ue=!!O[l];w&&ue?ae(s.id,i,k,l):rt(v,s.id,i,k)},className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center mt-4",children:[t.jsxs("div",{className:"md:col-span-4",children:[t.jsx("p",{className:"font-medium text-gray-800",children:f.representative_name}),t.jsx("p",{className:"text-xs text-gray-500",children:f.company_name})]}),t.jsxs("div",{className:"md:col-span-5 relative",children:[t.jsx("input",{type:"number",step:"0.01",placeholder:"â‚± Quoted Price",disabled:w&&!O[l],value:w&&!O[l]?parseFloat(h).toFixed(2):Y[l]||"",onWheel:v=>v.currentTarget.blur(),onChange:P,className:`w-full border rounded-md px-4 py-2 text-sm shadow-sm ${w&&!O[l]?"bg-gray-100 border-gray-300 text-gray-500":"border-gray-300 focus:ring-2 focus:ring-indigo-500"}`}),w&&!O[l]&&t.jsx("span",{className:"absolute top-1/2 right-3 -translate-y-1/2 text-xs font-medium text-green-600",children:"Already submitted"})]}),t.jsx("div",{className:"md:col-span-3 flex gap-2",children:w&&!O[l]?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>{de(v=>({...v,[l]:!0})),z(v=>({...v,[l]:h}))},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-yellow-500 hover:bg-yellow-600 text-white",children:t.jsx(yt,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",disabled:c,onClick:()=>{T({title:"Confirm Delete",message:"Are you sure you want to delete this quoted price?",type:"confirm",onConfirm:()=>dt(s.id,i,l)})},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-red-600 hover:bg-red-700 text-white",children:t.jsx(wt,{className:"w-4 h-4"})})]}):w?t.jsx("button",{type:"button",disabled:c,onClick:()=>ae(s.id,i,Y[l]??"",l),className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${c?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx($t,{className:"w-4 h-4"})}):t.jsx("button",{type:"submit",disabled:c,className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${c?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(jt,{className:"w-4 h-4"})})})]},l)})})]},s.id)),m&&t.jsx("div",{className:"mt-6 text-right",children:t.jsx("button",{onClick:st,disabled:q==="all",className:`inline-flex items-center gap-2 px-6 py-2 text-white text-sm font-semibold rounded-md shadow-sm transition ${q==="all"?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700"}`,children:q==="all"?"Submitting All...":"Submit Entire PR Quotes"})})]})]})]}),Je&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:t.jsxs("div",{className:"relative w-full max-w-7xl p-6 bg-white/90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-200",children:[t.jsx("button",{onClick:()=>H(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 transition-colors","aria-label":"Close modal",children:"âœ•"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Select a Supplier"}),t.jsx("div",{className:"flex justify-between items-center mb-5 gap-3",children:t.jsx("input",{type:"text",placeholder:"ðŸ” Filter suppliers...",value:C,onChange:s=>{R(s.target.value),x(1)},className:"w-full max-w-xs border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})}),t.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto rounded-lg border border-gray-200",children:t.jsxs("table",{className:"min-w-full text-sm text-gray-700",children:[t.jsx("thead",{className:"bg-gray-100 text-gray-600 uppercase text-xs tracking-wide",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"ID"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Name"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Company"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Address"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"TIN"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Action"})]})}),t.jsx("tbody",{children:Se.length>0?Se.map(s=>t.jsxs("tr",{className:"hover:bg-indigo-50 transition-colors",children:[t.jsx("td",{className:"py-3 px-4",children:s.id}),t.jsx("td",{className:"py-3 px-4",children:s.representative_name}),t.jsx("td",{className:"py-3 px-4",children:s.company_name}),t.jsx("td",{className:"py-3 px-4",children:s.address}),t.jsx("td",{className:"py-3 px-4",children:s.tin_num}),t.jsxs("td",{className:"py-3 px-4 space-x-2 text-nowrap",children:[t.jsx("button",{disabled:a.some(i=>i.pr_details_id===j&&i.supplier_id===s.id),onClick:()=>{var l,c;const f=(j===null?"":se[j]||"").toString().trim()||((c=(l=e.details)==null?void 0:l.find(h=>h.id===j))==null?void 0:c.unit_price)||"";J(j,s.id,f),ie(h=>({...h,[j]:f})),X(h=>{const w=h[j]||[];return w.includes(s.id)?h:{...h,[j]:[...w,s.id]}}),$(String(s.id)),H(!1)},className:"text-sm bg-indigo-600 text-white hover:bg-indigo-700 px-3 py-1 rounded-lg shadow disabled:opacity-50 disabled:cursor-not-allowed",children:"Select"}),t.jsx("button",{onClick:()=>{const i={...ne},f={...se},l=[];e.details.forEach(c=>{if(a.some(w=>w.pr_details_id===c.id&&w.supplier_id===s.id))l.push(c.item_description||`Item #${c.id}`);else{const w=c.unit_price||"";f[c.id]=w,J(c.id,s.id,w);const P=i[c.id]||[];P.includes(s.id)||(i[c.id]=[...P,s.id])}}),ie(f),X(i),$(String(s.id)),g(s.id),H(!1),l.length>0&&(ut(l),ce(!0))},className:"text-sm bg-green-600 text-white hover:bg-green-700 px-3 py-1 rounded-lg shadow",children:"Apply to Entire PR"})]})]},s.id)):t.jsx("tr",{children:t.jsxs("td",{colSpan:"7",className:"text-center py-6 text-gray-400 italic",children:["No suppliers available for this"," "]})})})]})}),t.jsxs("div",{className:"mt-6 border-t pt-4 flex justify-between items-center",children:[t.jsx("button",{onClick:()=>V(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg text-sm shadow-sm",children:"âž• Add New Supplier"}),t.jsx("button",{onClick:()=>{if(!_){pe.fire("Oops!","Please select a supplier first.","warning");return}oe("supplier_id",_),H(!1),pe.fire("Saved!","Supplier has been selected.","success")},className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm shadow-sm",children:"Confirm Selection"})]}),t.jsxs("div",{className:"flex justify-between items-center mt-4",children:[t.jsx("button",{onClick:()=>x(s=>Math.max(s-1,1)),disabled:S===1,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"â† Prev"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",S," of ",le]}),t.jsx("button",{onClick:()=>x(s=>Math.min(s+1,le)),disabled:S===le,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"Next â†’"})]})]})}),tt&&t.jsx("div",{className:"fixed inset-0 z-[999] bg-black bg-opacity-50 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative",children:[t.jsx("button",{onClick:()=>V(!1),className:"absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold","aria-label":"Close add supplier modal",children:"Ã—"}),t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Supplier"}),t.jsxs("form",{onSubmit:at,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Representative Name"}),t.jsx("input",{type:"text",required:!0,value:Q.representative_name,onChange:s=>G(i=>({...i,representative_name:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),t.jsx("input",{type:"text",required:!0,value:Q.company_name,onChange:s=>G(i=>({...i,company_name:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),t.jsx("input",{type:"text",required:!0,value:Q.address,onChange:s=>G(i=>({...i,address:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TIN Number"}),t.jsx("input",{type:"text",required:!0,value:Q.tin_num,onChange:s=>G(i=>({...i,tin_num:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",children:"Add Supplier"})]})]})]})}),t.jsx(Pe,{open:ze,onOpenChange:I,children:t.jsxs(Te,{children:[t.jsxs(Fe,{children:[t.jsx(Le,{className:W.type==="error"?"text-red-600":W.type==="success"?"text-green-600":"",children:W.title}),t.jsx(ke,{children:W.message})]}),t.jsx(De,{children:W.type==="confirm"?t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md",onClick:()=>{I(!1),re(null)},children:"Cancel"}),t.jsx(ee,{className:"px-4 py-2 bg-green-600 text-white rounded-md",onClick:()=>{typeof $e=="function"&&$e(),I(!1),re(null)},children:"Confirm"})]}):t.jsx(ee,{className:"px-4 py-2 bg-blue-600 text-white rounded-md",onClick:()=>I(!1),children:"Close"})})]})}),t.jsx(Pe,{open:ct,onOpenChange:ce,children:t.jsxs(Te,{children:[t.jsxs(Fe,{children:[t.jsx(Le,{children:"Some Items Skipped"}),t.jsx(ke,{children:"This supplier already quoted for some items, so they were skipped:"})]}),t.jsx(De,{className:"mt-4",children:t.jsx(ee,{onClick:()=>ce(!1),children:"OK"})})]})})]})}export{kr as default};
