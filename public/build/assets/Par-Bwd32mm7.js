import{a as m,j as e,H as ie,R as ce,L as de,c as E}from"./app-CJGPeEqL.js";import{I as me}from"./IssuanceTabs-BL5adN0Q.js";import{S as ue}from"./SupplyOfficerLayout-CrlJ43ok.js";import{B as j}from"./button-CV5IcRIt.js";import{D as z,a as G,b as U,c as V,d as W,e as J}from"./dialog-CXTlGLpV.js";import{P as xe}from"./printer-check-wDSjpFrE.js";import{C as pe}from"./circle-minus-CfJVp1z5.js";import{C as he}from"./circle-plus-BAFo7dtn.js";import{F as ye}from"./file-text-C_7YLipx.js";import"./Dropdown-CRlSc8Sf.js";import"./transition-5zZZNu15.js";import"./toaster-C6XIs2kB.js";import"./use-toast-DrlOWvM6.js";import"./index-Bj-Hhsn1.js";import"./index-nvqwRDlH.js";import"./createLucideIcon-Dy789CsD.js";import"./utils-Bli2D0HZ.js";import"./index-CpXPFYAN.js";import"./XMarkIcon-CwdTtRA1.js";import"./clipboard-check-B0tr7SMJ.js";import"./package-check-FNACoI6f.js";import"./trash-BsTuDtRD.js";import"./index-DfLKD-Dz.js";function Be({purchaseOrders:ge,inventoryItems:be,par:y,user:fe}){var $,L;const[g,K]=m.useState(""),[v,X]=m.useState(""),[_,Z]=m.useState(new Date().getFullYear()),[ee,te]=m.useState([]),S=($=y==null?void 0:y.data)==null?void 0:$.filter(t=>{var o,c,d,u,x,h;const a=(d=(c=(o=t.po)==null?void 0:o.rfq)==null?void 0:c.purchase_request)!=null&&d.focal_person?`${t.po.rfq.purchase_request.focal_person.firstname??""} ${t.po.rfq.purchase_request.focal_person.lastname??""}`:"",r=t.requested_by?`${t.requested_by.firstname??""} ${t.requested_by.lastname??""}`:"",n=g===""||((u=t.par_number)==null?void 0:u.toLowerCase().includes(g.toLowerCase()))||((h=(x=t.inventory_item)==null?void 0:x.item_desc)==null?void 0:h.toLowerCase().includes(g.toLowerCase()))||r.toLowerCase().includes(g.toLowerCase())||a.toLowerCase().includes(g.toLowerCase()),s=new Date(t.created_at),i=v===""||s.getMonth()+1===Number(v),l=_===""||s.getFullYear()===Number(_);return n&&i&&l});console.log(S);const se=t=>{te(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},[re,C]=m.useState(!1),[b,A]=m.useState(null),[N,w]=m.useState([]),[p,q]=m.useState(""),ae=(t,a)=>{const r=t.target.value;if(t.target.value="",r==="return"){A(a),w([]),q(""),C(!0);return}if(r==="reissuance"||r==="disposal"){const n=r==="reissuance"?"supply_officer.reissuance_form":"supply_officer.disposal_form";window.location.href=route(n,{id:a.id,type:"par"})}},[le,k]=m.useState(!1),[P,I]=m.useState([]),[R,Q]=m.useState(null);return e.jsxs(ue,{header:"Schools Divisions Office - Ilagan | PAR",children:[e.jsx(ie,{title:"PAR"}),e.jsx(me,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Property Acknowledgement Receipt (PAR)"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>window.location.href=route("supply_officer.generate_par_report",{month:v,year:_,search:g}),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-2 py-1 text-sm",value:v,onChange:t=>X(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),[...Array(12)].map((t,a)=>e.jsx("option",{value:a+1,children:new Date(0,a).toLocaleString("en",{month:"long"})},a))]}),e.jsx("label",{className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-20 text-sm",value:_,onChange:t=>Z(t.target.value)})]}),e.jsx("input",{type:"text",placeholder:"Search PAR number, item...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm",value:g,onChange:t=>K(t.target.value)})]}),e.jsx("div",{className:"overflow-x-auto mt-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-semibold uppercase tracking-wider text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"PAR No."}),e.jsx("th",{className:"px-4 py-3",children:"Division"}),e.jsx("th",{className:"px-4 py-3",children:"Requested By"}),e.jsx("th",{className:"px-4 py-3",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:S&&S.length>0?S.map((t,a)=>{var i;const r=((i=t.items)==null?void 0:i.map(l=>{var o;return{description:((o=l.inventory_item)==null?void 0:o.item_desc)??"N/A",quantity:l.quantity,unitCost:Number(l.unit_cost??0),totalCost:Number(l.unit_cost??0)*l.quantity,date:new Date(l.created_at).toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric"})}}))||[],n=ee.includes(t.id),s=n?r:r.slice(0,1);return e.jsx(ce.Fragment,{children:s.map((l,o)=>{var c,d,u,x,h,f;return e.jsxs("tr",{className:`transition-all duration-150 ${o%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-50 hover:shadow-sm`,children:[o===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:s.length,className:"px-4 py-3 font-semibold text-gray-800 align-top",children:a+1}),e.jsxs("td",{rowSpan:s.length,className:"px-4 py-3 text-blue-600 font-medium align-top",children:["P-",t.par_number]}),e.jsx("td",{rowSpan:s.length,className:"px-4 py-3 align-top",children:((x=(u=(d=(c=t.po)==null?void 0:c.rfq)==null?void 0:d.purchase_request)==null?void 0:u.division)==null?void 0:x.division)??"N/A"}),e.jsxs("td",{rowSpan:s.length,className:"px-4 py-3 align-top",children:[(h=t.requested_by)==null?void 0:h.firstname," ",(f=t.requested_by)==null?void 0:f.lastname]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium",children:l.description})}),e.jsx("td",{className:"px-4 py-3 text-center text-gray-800",children:l.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",l.unitCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",l.totalCost.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:l.date}),o===s.length-1&&e.jsxs("td",{rowSpan:s.length,className:"px-4 py-3 text-center align-top",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs("a",{href:route("supply_officer.print_par",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium",children:[e.jsx(xe,{size:14}),"Print"]}),e.jsx(j,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",onClick:()=>{Q(t),I([]),k(!0)},children:"Switch Type"}),e.jsx(j,{type:"button",onClick:D=>ae(D,t),value:"return",className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",children:"Return"})]}),r.length>2&&e.jsx("button",{onClick:()=>se(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{size:14})," Show More"]})})]})]},`${t.id}-${o}`)})},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(ye,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No ICS records found"})]})})})})]})}),((L=y==null?void 0:y.links)==null?void 0:L.length)>0&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:y.links.map((t,a)=>e.jsx(de,{href:t.url||"#",className:`px-3 py-1 text-sm rounded-md ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"} ${!t.url&&"opacity-50 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:t.label}},a))})]}),e.jsx(z,{open:re,onOpenChange:C,children:e.jsxs(G,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(U,{className:"pb-3 border-b border-gray-100",children:[e.jsx(V,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Return Items"}),e.jsx(W,{className:"text-sm text-gray-500",children:"Select items to return and specify whether they are for reissuance or disposal."})]}),b?(()=>{const t=b.items||[],a=t.every(r=>r.reissuedItem||r.disposedItem||r.status==="reissued"||r.status==="disposed");return e.jsxs("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:[!a&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2 py-1 rounded-md hover:bg-gray-100",children:[e.jsx("input",{id:"select-all-return",type:"checkbox",checked:t.every(r=>N.includes(r.id))||!1,onChange:r=>{r.target.checked?w(n=>[...new Set([...n,...t.map(s=>s.id)])]):w(n=>n.filter(s=>!t.map(i=>i.id).includes(s)))},className:"h-4 w-4 accent-blue-600"}),e.jsx("label",{htmlFor:"select-all-return",className:"text-sm font-medium text-gray-700 cursor-pointer select-none",children:"Select all"})]}),(()=>{const r=b.items||[];return console.log({lowItems:r}),r.every(s=>{const i=Number(s.quantity??0),l=Number(s.total_reissued_quantity??0),o=Number(s.total_disposed_quantity??0);return l+o>=i})?e.jsxs("div",{className:"p-4 text-center text-gray-500 text-sm italic bg-gray-50 rounded-md border border-gray-200",children:["All items in this issuance have already been"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"reissued"})," or"," ",e.jsx("span",{className:"font-semibold text-rose-600",children:"disposed"}),"."]}):r.map(s=>{var M,T,H,Y,O;const i=((T=(M=s.inventoryItem)==null?void 0:M.product)==null?void 0:T.name)??((H=s.inventory_item)==null?void 0:H.item_desc)??"N/A",l=((O=(Y=s.inventory_item)==null?void 0:Y.product)==null?void 0:O.specs)??"",o=Number(s.quantity??0),c=Number(s.total_reissued_quantity??0),d=Number(s.total_disposed_quantity??0),u=c+d,x=Math.max(o-u,0),h=x===0&&c>0,f=x===0&&d>0,D=x>0&&(c>0||d>0),F=h||f;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${N.includes(s.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"} ${F?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:N.includes(s.id),disabled:F,onChange:ne=>{F||w(B=>ne.target.checked?[...B,s.id]:B.filter(oe=>oe!==s.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-gray-800",children:i}),h||f?e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${f?"bg-rose-100 text-rose-700 border border-rose-300":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:f?"Disposed":"Reissued"}):D?e.jsxs("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-300",children:["Some Items are returned (",u,"/",o,")"]}):e.jsxs("span",{className:"text-xs text-gray-600",children:["Remaining: ",x]})]}),l&&e.jsx("div",{className:"text-gray-500 text-xs",children:l}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",s.quantity," | ₱",Number(s.unit_cost??0).toFixed(2)]}),(c>0||d>0)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Returned:"," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:[c," reissued"]})," ","|"," ",e.jsxs("span",{className:"text-rose-600 font-medium",children:[d," disposed"]})]})]})]},s.id)})})()]})})():e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs("div",{className:"mt-5 border-t pt-4",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${p==="reissuance"?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"reissuance",checked:p==="reissuance",onChange:t=>q(t.target.value),className:"h-4 w-4 accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Reissuance"})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${p==="disposal"?"border-rose-400 bg-rose-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"disposal",checked:p==="disposal",onChange:t=>q(t.target.value),className:"h-4 w-4 accent-rose-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Disposal"})]})]})]}),e.jsxs(J,{className:"pt-5 border-t mt-4",children:[e.jsx(j,{variant:"outline",className:"w-28",onClick:()=>{C(!1),w([]),q(""),A(null)},children:"Cancel"}),e.jsx(j,{className:`w-28 text-white ${p==="disposal"?"bg-rose-600 hover:bg-rose-700":"bg-blue-600 hover:bg-blue-700"}`,disabled:!N.length||!p||b&&(b.items||[]).every(t=>{const a=Number(t.quantity??0),r=Number(t.total_reissued_quantity??0),n=Number(t.total_disposed_quantity??0),s=r+n;return console.log({totalQty:a,reissuedQty:r,disposedQty:n,totalProcessed:s}),s>=a}),onClick:()=>{if((b.items||[]).every(n=>{const s=Number(n.quantity??0),i=Number(n.total_reissued_quantity??0),l=Number(n.total_disposed_quantity??0);return i+l>=s})){toast({title:"All items already processed",description:"There are no items left to return.",variant:"destructive"});return}if(N.length===0){toast({title:"No items selected",description:"Please select at least one item to return.",variant:"destructive"});return}if(!p){toast({title:"No return type chosen",description:"Please specify whether this return is for reissuance or disposal.",variant:"destructive"});return}const r=p==="reissuance"?"supply_officer.reissuance_form":"supply_officer.disposal_form";E.visit(route(r,{id:b.id,type:"par",items:N.join(",")})),C(!1)},children:"Proceed"})]})]})}),e.jsx(z,{open:le,onOpenChange:k,children:e.jsxs(G,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(U,{className:"pb-3 border-b border-gray-100",children:[e.jsx(V,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(W,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),R?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(R.items||[]).map(t=>{var n,s,i,l,o;const a=((s=(n=t.inventoryItem)==null?void 0:n.product)==null?void 0:s.name)??((i=t.inventory_item)==null?void 0:i.item_desc)??"N/A",r=((o=(l=t.inventoryItem)==null?void 0:l.product)==null?void 0:o.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${P.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:P.includes(t.id),onChange:c=>{I(d=>c.target.checked?[...d,t.id]:d.filter(u=>u!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:a}),r&&e.jsx("div",{className:"text-gray-500 text-xs",children:r}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | ₱",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(J,{className:"pt-5 border-t mt-4",children:[e.jsx(j,{variant:"outline",className:"w-28",onClick:()=>{k(!1),I([]),Q(null)},children:"Cancel"}),e.jsx(j,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!P.length,onClick:()=>{var t;E.visit(route("supply_officer.switch_type",{type:"par",id:R.id,po_id:(t=R.po)==null?void 0:t.id,items:P}))},children:"Continue"})]})]})})]})}export{Be as default};
