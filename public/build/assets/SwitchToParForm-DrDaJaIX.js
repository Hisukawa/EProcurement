import{a as le,u as ae,j as s}from"./app-CKujYd7_.js";import{u as re}from"./use-toast-Bax0zrdw.js";import K from"./AutoCompleteInput-C0fAfV-F.js";import{F as oe}from"./file-text-PtfCvhuH.js";import{S as de}from"./send-horizontal-hdpR_W5W.js";import"./createLucideIcon-LguoqwsX.js";function xe({par:n,user:f,ppeOptions:C,type:V}){var A,G,R,q,E,O,$,F,L,T,I,z,D,B,H,M,Q,U,W,Y;const{toast:j}=re(),[X,v]=le.useState(!1);n.po.details;const Z=`${((E=(q=(R=(G=(A=n==null?void 0:n.po)==null?void 0:A.details[0])==null?void 0:G.pr_detail)==null?void 0:R.purchase_request)==null?void 0:q.focal_person)==null?void 0:E.firstname)??""} ${((T=(L=(F=($=(O=n==null?void 0:n.po)==null?void 0:O.details[0])==null?void 0:$.pr_detail)==null?void 0:F.purchase_request)==null?void 0:L.focal_person)==null?void 0:T.middlename)??""} ${((H=(B=(D=(z=(I=n==null?void 0:n.po)==null?void 0:I.details[0])==null?void 0:z.pr_detail)==null?void 0:D.purchase_request)==null?void 0:B.focal_person)==null?void 0:H.lastname)??""}`.trim()||"N/A";(Q=(M=n==null?void 0:n.requested_by)==null?void 0:M.division)==null||Q.division;const{data:d,setData:u,post:ee,processing:k,errors:P}=ae({id:(n==null?void 0:n.id)??"",type:V||"par",po_id:((U=n==null?void 0:n.po)==null?void 0:U.id)??null,par_number:((W=n.po)==null?void 0:W.po_number)??"",requested_by:((Y=n==null?void 0:n.requested_by)==null?void 0:Y.id)??f.id,issued_by:(f==null?void 0:f.id)??null,remarks:"",items:n.items.map(e=>{var l;return{inventory_item_id:((l=e==null?void 0:e.inventory_item)==null?void 0:l.id)??null,inventory_item_number:(e==null?void 0:e.inventory_item_number)??"",quantity:(e==null?void 0:e.quantity)??0,unit_cost:(e==null?void 0:e.unit_cost)??0,total_cost:(e==null?void 0:e.total_cost)??0,ppe_sub_major_account:(e==null?void 0:e.ppe_sub_major_account)??null,general_ledger_account:(e==null?void 0:e.general_ledger_account)??null,office:(e==null?void 0:e.office)??null,school:(e==null?void 0:e.school)??null,series_number:(e==null?void 0:e.series_number)??"0001",generated_number:(e==null?void 0:e.generated_number)??""}})}),se=async e=>{var h,g,y;const l=d.items[e],{ppe:x,gl:p,office:o,school:c}=l;if(!x||!p){j({title:"Missing selection",description:"Please select PPE and GL before generating.",variant:"destructive"});return}try{window.__parGlobalSeriesCache||(window.__parGlobalSeriesCache=null);let i=1;window.__parGlobalSeriesCache?(window.__parGlobalSeriesCache++,i=window.__parGlobalSeriesCache):(i=(await(await fetch("/api/par-next-series")).json()).series||1,window.__parGlobalSeriesCache=i);const _=i.toString().padStart(4,"0"),N=new Date().getFullYear().toString(),t=((h=x.code)==null?void 0:h.padStart(2,"0"))||"00",a=((g=p.code)==null?void 0:g.padStart(2,"0"))||"00",r=((y=o==null?void 0:o.code)==null?void 0:y.padStart(2,"0"))||"",m=(o==null?void 0:o.name)==="Schools"&&(c!=null&&c.code)?c.code.padStart(2,"0"):"",b=[N,t,a,_,r];m&&b.push(m);const w=b.filter(Boolean).join("-");u("items",d.items.map((S,J)=>J===e?{...S,series_number:_,inventory_item_number:w,generated_number:w,ppe_sub_major_account:x.name,general_ledger_account:p.name,office:(o==null?void 0:o.name)??"",school:(c==null?void 0:c.name)??""}:S))}catch(i){console.error(i),j({title:"⚠️ Warning",description:"Failed to fetch next series number for PAR item.",variant:"destructive"})}},te=e=>{e.preventDefault(),v(!0)},ne=()=>{ee(route("supply_officer.switch_to_par"),{preserveScroll:!0,onSuccess:()=>{j({title:"✅ Success",description:"PAR issuance submitted successfully!",className:"bg-green-600 text-white"}),v(!1)},onError:()=>{j({title:"❌ Error",description:"Failed to submit PAR issuance.",variant:"destructive"}),v(!1)}})};return s.jsxs("div",{className:"bg-green-50 p-8 rounded-xl shadow-md",children:[s.jsxs("h2",{className:"text-3xl font-bold text-green-800 mb-1 flex items-center gap-2",children:[s.jsx(oe,{size:24})," Property Acknowledgement Receipt (PAR)"]}),s.jsxs("p",{className:"text-sm text-gray-700 mb-6",children:[s.jsx("strong",{children:"Note:"})," Each item below must have its own PPE, GL, and location details before submission."]}),Object.keys(P).length>0&&s.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:s.jsx("ul",{className:"list-disc list-inside",children:Object.entries(P).map(([e,l])=>s.jsx("li",{children:l},e))})}),s.jsxs("form",{onSubmit:te,className:"space-y-8",children:[d.items.map((e,l)=>{var p,o,c,h,g,y,i,_,N;const x=((o=(p=n.items[l])==null?void 0:p.inventory_item)==null?void 0:o.item_desc)??"N/A";return s.jsxs("div",{className:"border border-gray-300 bg-white rounded-lg p-6 shadow-sm",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 text-green-700",children:["Item ",l+1,": ",x]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),s.jsx("input",{type:"number",value:e.quantity,onChange:t=>u("items",d.items.map((a,r)=>r===l?{...a,quantity:t.target.value}:a)),className:"w-full mt-1 px-3 py-2 border rounded-md"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),s.jsx("input",{type:"number",value:e.unit_cost,onChange:t=>u("items",d.items.map((a,r)=>r===l?{...a,unit_cost:t.target.value}:a)),className:"w-full mt-1 px-3 py-2 border rounded-md"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),s.jsx("input",{type:"number",value:e.total_cost,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md bg-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Received By"}),s.jsx("input",{type:"text",value:Z,readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md bg-gray-100"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PPE Sub-major Account"}),s.jsxs("select",{value:((c=e.ppe)==null?void 0:c.id)||"",onChange:t=>{const a=C.find(r=>r.id==t.target.value);u("items",d.items.map((r,m)=>m===l?{...r,ppe:a,gl:null}:r))},className:"w-full mt-1 px-3 py-2 border rounded-md",children:[s.jsx("option",{value:"",children:"Select PPE"}),C.map(t=>s.jsx("option",{value:t.id,children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"General Ledger Account"}),s.jsxs("select",{value:((h=e.gl)==null?void 0:h.id)||"",onChange:t=>{var r,m;const a=((m=(r=e.ppe)==null?void 0:r.general_ledger_accounts)==null?void 0:m.find(b=>b.id==t.target.value))??null;u("items",d.items.map((b,w)=>w===l?{...b,gl:a}:b))},disabled:!e.ppe,className:"w-full mt-1 px-3 py-2 border rounded-md disabled:bg-gray-100",children:[s.jsx("option",{value:"",children:"Select GL"}),(y=(g=e.ppe)==null?void 0:g.general_ledger_accounts)==null?void 0:y.map(t=>s.jsx("option",{value:t.id,children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),s.jsx(K,{label:"Location Office",apiRoute:"/api/office-search",value:((i=e.office)==null?void 0:i.code)||"",onChange:t=>u("items",d.items.map((a,r)=>r===l?{...a,office:t}:a)),placeholder:"Type Location Office..."}),((_=e.office)==null?void 0:_.name)==="Schools"&&s.jsx(K,{label:"School",apiRoute:"/api/school-search",value:((N=e.school)==null?void 0:N.name)||"",onChange:t=>u("items",d.items.map((a,r)=>r===l?{...a,school:t}:a)),placeholder:"Type School..."}),s.jsx("button",{type:"button",onClick:()=>se(l),disabled:!!e.inventory_item_number,className:`px-3 py-2 text-sm rounded-md ${e.inventory_item_number?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:e.inventory_item_number?"Already Generated":"Generate Inventory No."}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Property No."}),s.jsx("input",{type:"text",value:e.generated_number||e.inventory_item_number||"",readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md bg-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Inventory Item No."}),s.jsx("input",{type:"text",value:e.generated_number||e.inventory_item_number||"",readOnly:!0,className:"w-full mt-1 px-3 py-2 border rounded-md bg-gray-100"})]})]})]})]},l)}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),s.jsx("textarea",{value:d.remarks,onChange:e=>u("remarks",e.target.value),rows:"3",className:"w-full mt-1 px-3 py-2 border rounded-md",placeholder:"Optional remarks..."})]}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsxs("button",{type:"submit",disabled:k,className:"inline-flex items-center px-6 py-2 bg-green-700 text-white rounded-md hover:bg-green-800 disabled:opacity-50",children:[s.jsx(de,{size:16,className:"mr-2"}),k?"Submitting...":"Submit PAR"]})})]}),X&&s.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-md w-full",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Confirm Submission"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to submit this PAR issuance?"}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"}),s.jsx("button",{onClick:ne,className:"px-4 py-2 bg-green-700 text-white rounded-md hover:bg-green-800",children:"Confirm"})]})]})})]})}export{xe as default};
