import{r,a as H,u as Z,j as a,H as L,L as C}from"./app-z2zUCIH2.js";import{A as O}from"./AdminLayout-qIAf_2_o.js";import{D as B,a as M,b as $,c as I,d as P,e as k}from"./dialog-Dc_xfRUc.js";import{T as q,a as z,b as j,c,d as G,e as d}from"./table-jsBWBAfd.js";import{B as J}from"./button-BxtF8k1k.js";import{u as K}from"./use-toast-Byxe34qQ.js";import{F as Q}from"./PencilSquareIcon-B3EJum4P.js";import"./Dropdown-DTp9JO5b.js";import"./transition-Mdjj0t_f.js";import"./toaster-De5hWt1k.js";import"./index-CMYY62sn.js";import"./index-BPRSbHGy.js";import"./createLucideIcon-B5xgoSjl.js";import"./utils-Cf4Ri238.js";import"./index-ZeHC1oZz.js";import"./users-DQf4mAf0.js";import"./ClipboardDocumentIcon-BLqeaTjg.js";import"./index-DDOX9kOw.js";function V({title:l,titleId:n,...m},p){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":n},m),l?r.createElement("title",{id:n},l):null,r.createElement("path",{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"}))}const W=r.forwardRef(V);function X({title:l,titleId:n,...m},p){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":n},m),l?r.createElement("title",{id:n},l):null,r.createElement("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z",clipRule:"evenodd"}))}const Y=r.forwardRef(X);function ve({users:l,filters:n,divisions:m,roles:p}){var N,S;const{props:b}=H(),h=(N=b.flash)==null?void 0:N.success,x=(S=b.flash)==null?void 0:S.error,{toast:u}=K(),[E,g]=r.useState(!1),[D,w]=r.useState(null),{data:t,setData:i,put:_,get:f,processing:y,reset:U}=Z({search:n.search||"",division:n.division||"",firstname:"",middlename:"",lastname:"",email:"",position:"",division_id:"",role:""});r.useEffect(()=>{const e=setTimeout(()=>{f(route("admin.view_users"),{preserveState:!0,replace:!0})},300);return()=>clearTimeout(e)},[t.search,t.division]),r.useEffect(()=>{h&&u({title:"✅ Success",description:h}),x&&u({title:"❌ Error",description:x,variant:"destructive"})},[h,x]);const A=e=>{var s,o;w(e),i({firstname:e.firstname,middlename:e.middleinitial,lastname:e.lastname,email:e.email,position:e.position||"",division_id:((s=e.division)==null?void 0:s.id)||"",role:((o=e.roles[0])==null?void 0:o.name)||""}),g(!0)},R=async()=>{var e,s;try{const o=await axios.put(route("admin.update_user",D.id),t);u({title:"✅ Success",description:o.data.message||"User updated successfully"}),g(!1),U(),w(null),f(route("admin.view_users"),{preserveState:!0})}catch(o){const v=((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||"Something went wrong";u({title:"❌ Error",description:v,variant:"destructive"})}},T=e=>{confirm("Are you sure you want to deactivate this user?")&&_(route("admin.deactivate_user",e),{onSuccess:()=>{u({title:"✅ Success",description:"User deactivated successfully"}),f(route("admin.view_users"),{preserveState:!0})},onError:s=>{u({title:"❌ Error",description:s.message||"Something went wrong",variant:"destructive"})}})};return a.jsxs(O,{header:"Schools Division Office - Ilagan | Users",children:[a.jsx(L,{title:"Users"}),a.jsx("div",{className:"rounded-lg mb-6",children:a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4",children:[a.jsx("div",{className:"flex flex-col md:flex-row gap-4 w-full md:w-auto mb-4 md:mb-0",children:a.jsxs("form",{onSubmit:e=>e.preventDefault(),className:"flex flex-wrap items-center gap-3",children:[a.jsx("input",{type:"text",placeholder:"Name...",className:"w-96 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.search,onChange:e=>i("search",e.target.value)}),a.jsxs("select",{value:t.division,onChange:e=>i("division",e.target.value),className:"border border-gray-300 px-10 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"All Divisions"}),m.map(e=>a.jsx("option",{value:e.id,children:e.division},e.id))]})]})}),a.jsx(C,{href:route("admin.create_user_form"),className:"bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition shadow-md text-center",children:"+ Add User"})]})}),a.jsxs("div",{className:"overflow-x-auto bg-white rounded-lg shadow-md",children:[a.jsxs(q,{children:[a.jsx(z,{children:a.jsxs(j,{children:[a.jsx(c,{children:"ID"}),a.jsx(c,{children:"Name"}),a.jsx(c,{children:"Email"}),a.jsx(c,{children:"Division"}),a.jsx(c,{children:"Position"}),a.jsx(c,{children:"Role"}),a.jsx(c,{className:"text-center",children:"Actions"})]})}),a.jsx(G,{children:l.data.length>0?l.data.map(e=>{var s;return a.jsxs(j,{className:`hover:bg-blue-50 transition duration-150 ${e.account_status==="inactive"?"opacity-50 line-through":""}`,children:[a.jsx(d,{children:e.id}),a.jsxs(d,{className:"flex items-center",children:[a.jsx(Y,{className:"w-5 h-5 text-gray-400 mr-2"}),e.firstname," ",e.middleinitial," ",e.lastname]}),a.jsx(d,{children:e.email}),a.jsx(d,{children:((s=e.division)==null?void 0:s.division)||a.jsx("span",{className:"text-gray-500 italic",children:"N/A"})}),a.jsx(d,{children:e.position||a.jsx("span",{className:"text-gray-500 italic",children:"N/A"})}),a.jsx(d,{children:e.roles.map((o,v)=>a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:o.name.replace(/_/g," ").replace(/\b\w/g,F=>F.toUpperCase())},v))}),a.jsxs(d,{className:"text-center",children:[a.jsx("button",{onClick:()=>A(e),className:"inline-flex items-center px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 mr-2",title:"Edit User",children:a.jsx(Q,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>T(e.id),className:"inline-flex items-center px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",title:"Delete User",children:a.jsx(W,{className:"w-4 h-4"})})]})]},e.id)}):a.jsx(j,{children:a.jsx(d,{colSpan:7,className:"text-center py-6 text-gray-500",children:"No users found."})})})]}),a.jsx("div",{className:"flex items-center justify-center space-x-1 mt-6",children:l.links.map((e,s)=>a.jsx(C,{href:e.url||"#",className:`min-w-[40px] px-3 py-2 text-sm font-medium rounded-lg transition ${e.active?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border hover:bg-blue-50"} ${e.url?"":"cursor-not-allowed opacity-50"}`,dangerouslySetInnerHTML:{__html:e.label}},s))})]}),a.jsx(B,{open:E,onOpenChange:g,children:a.jsxs(M,{children:[a.jsxs($,{children:[a.jsx(I,{children:"Edit User"}),a.jsx(P,{children:"Update the user information below."})]}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),R()},className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx("input",{type:"text",placeholder:"First Name",value:t.firstname,onChange:e=>i("firstname",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm"}),a.jsx("input",{type:"text",placeholder:"Middle Name",value:t.middlename,onChange:e=>i("middlename",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm"}),a.jsx("input",{type:"text",placeholder:"Last Name",value:t.lastname,onChange:e=>i("lastname",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm"})]}),a.jsx("input",{type:"email",placeholder:"Email",value:t.email,onChange:e=>i("email",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm"}),a.jsx("input",{type:"text",placeholder:"Position",value:t.position,onChange:e=>i("position",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm"}),a.jsxs("select",{value:t.division_id,onChange:e=>i("division_id",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm",children:[a.jsx("option",{value:"",children:"Select Division"}),m.map(e=>a.jsx("option",{value:e.id,children:e.division},e.id))]}),a.jsxs("select",{value:t.role,onChange:e=>i("role",e.target.value),className:"w-full border-gray-300 rounded-md shadow-sm",children:[a.jsx("option",{value:"",children:"Select Role"}),p.map(e=>a.jsx("option",{value:e.name,children:e.name.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())},e.id))]}),a.jsx(k,{children:a.jsx(J,{type:"submit",disabled:y,children:y?"Saving...":"Update"})})]})]})})]})}export{ve as default};
