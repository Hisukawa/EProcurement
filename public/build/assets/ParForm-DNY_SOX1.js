import{a as m,u as Z,j as e}from"./app-Dbjf9Oin.js";import{u as I}from"./use-toast-Djn1IHI9.js";import{D as ee,a as te,b as se,c as ae,d as le,e as re}from"./dialog-BeYRoTwT.js";import{B as O}from"./button-EkOwt-dT.js";import B from"./AutoCompleteInput-Du-EYa7O.js";import{F as oe}from"./file-text-CZ-gpBRb.js";import{S as ne}from"./send-horizontal-_MJNfUMS.js";import"./index-BAMceerN.js";import"./index-C4-sA6bS.js";import"./createLucideIcon-CqPQf47s.js";import"./utils-CfLhLATi.js";import"./index-BB_tGL7l.js";function je({purchaseOrder:h,inventoryItem:o,user:b,ppeOptions:y,parNumber:j}){var P,q;const{toast:_}=I(),c=(h==null?void 0:h.detail)??null,x=((P=c==null?void 0:c.pr_detail)==null?void 0:P.purchase_request)??null,[n,U]=m.useState(null),[d,N]=m.useState(null),[a,G]=m.useState(null),[i,z]=m.useState(null),[p,v]=m.useState("0001"),[w,Q]=m.useState(""),H=o?o.item_desc:"N/A",M=x?`${x.focal_person.firstname} ${x.focal_person.middlename} ${x.focal_person.lastname}`:"N/A",S=(n==null?void 0:n.general_ledger_accounts)??[],{data:l,setData:r,post:W,processing:C,errors:k}=Z({po_id:(h==null?void 0:h.id)??null,par_number:j??"",requested_by:((q=x==null?void 0:x.focal_person)==null?void 0:q.id)??"",issued_by:(b==null?void 0:b.id)??null,remarks:"",date_acquired:new Date().toISOString().split("T")[0],items:[{inventory_item_id:(o==null?void 0:o.id)??null,recipient:"",recipient_division:"",estimated_useful_life:null,inventory_item_number:"",ppe_sub_major_account:"",general_ledger_account:"",office:"",quantity:(c==null?void 0:c.quantity)??1,unit_cost:(o==null?void 0:o.unit_cost)??0,total_cost:((o==null?void 0:o.unit_cost)??0)*((c==null?void 0:c.quantity)??1),series_number:p,property_no:""}]});m.useEffect(()=>{!n||!d||fetch(`/api/ics-next-series?ppe=${encodeURIComponent(n.name.trim())}&gl=${encodeURIComponent(d.name.trim())}`).then(t=>t.json()).then(t=>{t.series&&(v(t.series),r("items.0.series_number",t.series))}).catch(()=>{v(1),r("items.0.series_number",1)})},[n,d,a,i]),m.useEffect(()=>{var F,T,L;if(!n||!d||!p)return;const t=new Date().getFullYear().toString(),s=((F=n.code)==null?void 0:F.padStart(2,"0"))||"00",u=((T=d.code)==null?void 0:T.padStart(2,"0"))||"00",f=p==null?void 0:p.toString().padStart(4,"0"),X=((L=a==null?void 0:a.code)==null?void 0:L.padStart(2,"0"))||"",D=(a==null?void 0:a.name)==="Schools"&&(i!=null&&i.code)?i.code.padStart(2,"0"):"";let E=[t,s,u,f,X];D&&E.push(D);const $=E.filter(Boolean).join("-");Q($),r("items.0.inventory_item_number",$),r("items.0.ppe_sub_major_account",n.name||""),r("items.0.general_ledger_account",d.name||""),r("items.0.office",(a==null?void 0:a.name)||""),r("items.0.series_number",parseInt(p,10)),i&&r("items.0.school",i.name||"")},[n,d,a,i,p]);const[Y,g]=m.useState(!1),J=t=>{t.preventDefault(),g(!0)},K=()=>{W(route("supply_officer.store_par"),{preserveScroll:!0,onSuccess:()=>{_({title:"Success",description:"PAR has been saved successfully!",className:"bg-green-600 text-white",duration:3e3}),g(!1),reset()},onError:()=>{_({variant:"destructive",title:"Error",description:"Failed to save PAR. Please check the form."}),g(!1)}})},R=(t,s)=>{r("items",[{...l.items[0],[t]:s,total_cost:t==="quantity"?s*l.items[0].unit_cost:t==="unit_cost"?l.items[0].quantity*s:l.items[0].total_cost}])},V=t=>{let s=parseFloat(t.target.value)||0;const u=o.total_stock;s>u&&(s=u);const f=l.items[0].unit_cost??0;r("items",[{...l.items[0],quantity:s,total_cost:s*f}])},A=(t,s)=>{r("items",[{...l.items[0],[t]:s}])};return e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 mb-1 flex items-center gap-2",children:[e.jsx(oe,{size:24})," Property Acknowledgement Receipt (PAR)"]}),Object.keys(k).length>0&&e.jsx("div",{className:"col-span-2 bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(k).map(([t,s])=>e.jsx("li",{children:s},t))})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-6",children:[e.jsx("strong",{children:"Note:"})," This is the Property Acknowledgement Receipt (PAR) form page. Fill out the details below to record an PAR issuance."]}),e.jsxs("form",{onSubmit:J,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-5 border rounded-md bg-blue-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-700 mb-4",children:"Item Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PAR No."}),e.jsx("input",{type:"text",value:l.par_number,onChange:t=>r("par_number",t.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Auto-generated (",j,") â€” you may edit if needed."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Item"}),e.jsx("input",{value:H,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:o.total_stock,onChange:V,placeholder:`Max: ${o.total_stock}`,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),e.jsx("input",{type:"number",value:l.items[0].unit_cost,onChange:t=>R("unit_cost",Number(t.target.value)),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),e.jsx("input",{type:"text",value:l.items[0].total_cost.toFixed(2),readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested By"}),e.jsx("input",{type:"text",value:M,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Issued By"}),e.jsx("input",{type:"text",value:`${b.firstname} ${b.middlename} ${b.lastname}`,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Property No."}),e.jsx("input",{type:"text",value:w,onChange:t=>R("property_no",t.target.value),placeholder:"Enter property number",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date Acquired"}),e.jsx("input",{type:"date",value:l.date_acquired,onChange:t=>r("date_acquired",t.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]})]})]}),e.jsxs("div",{className:"p-5 border rounded-md bg-green-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-700 mb-4",children:"Acknowledgement"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Name"}),e.jsx("input",{type:"text",value:l.items[0].recipient,onChange:t=>A("recipient",t.target.value),placeholder:"Leave blank to issue to requester",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Office / Division"}),e.jsx("input",{type:"text",value:l.items[0].recipient_division,onChange:t=>A("recipient_division",t.target.value),placeholder:"Optional",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PPE Sub-major Account"}),e.jsxs("select",{value:(n==null?void 0:n.id)||"",onChange:t=>{const s=y.find(u=>u.id==t.target.value);U(s||null),N(null)},className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsx("option",{value:"",children:"Select PPE"}),y.map(t=>e.jsx("option",{value:t.id,children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"General Ledger Account"}),e.jsxs("select",{value:(d==null?void 0:d.id)||"",onChange:t=>{const s=S.find(u=>u.id==t.target.value);N(s||null)},disabled:!n,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select GL"}),S.map(t=>e.jsx("option",{value:t.id,children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),e.jsx(B,{label:"Location Office",apiRoute:"/api/office-search",value:(a==null?void 0:a.code)||"",onChange:G,placeholder:"Type Location Office..."}),(a==null?void 0:a.name)==="Schools"&&e.jsx(B,{label:"School",apiRoute:"/api/school-search",value:(i==null?void 0:i.name)||"",onChange:z,placeholder:"Type School..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Inventory Item No."}),e.jsx("input",{type:"text",value:w,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estimated Useful Life"}),e.jsx("input",{type:"number",value:l.items[0].estimated_useful_life??"",onChange:t=>r("items.0.estimated_useful_life",t.target.value),placeholder:"Enter Estimated Useful Life in years (optional)",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white",onWheel:t=>t.currentTarget.blur()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:l.remarks,onChange:t=>r("remarks",t.target.value),rows:"4",placeholder:"Enter remarks (optional)",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]})]}),e.jsx("div",{className:"col-span-full flex justify-end mt-4",children:e.jsxs("button",{type:"submit",disabled:C,className:"inline-flex items-center px-6 py-2 bg-blue-700 text-white text-sm font-medium rounded-md hover:bg-blue-800 transition disabled:opacity-50",children:[e.jsx(ne,{size:16,className:"mr-2"}),"Save PAR"]})})]}),e.jsx(ee,{open:Y,onOpenChange:g,children:e.jsxs(te,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Confirm Save"}),e.jsx(le,{children:"Are you sure you want to save this Property Acknowledgement Receipt (PAR)?"})]}),e.jsxs(re,{children:[e.jsx(O,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(O,{onClick:K,disabled:C,children:"Confirm Save"})]})]})})]})}export{je as default};
