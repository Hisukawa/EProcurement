import{a as u,j as e,H as le,R as ne,L as ie,c as B}from"./app-CKujYd7_.js";import{I as oe}from"./IssuanceTabs-czqZPtut.js";import{S as ce}from"./SupplyOfficerLayout-BW1geYpU.js";import{B as f}from"./button-BDytyKvn.js";import{D as G,a as J,b as U,c as V,d as W,e as K}from"./dialog-BoAiw6q7.js";import{P as X}from"./printer-check-CKc2N7MP.js";import{F as de}from"./file-text-PtfCvhuH.js";import"./Dropdown-CeA5lpHF.js";import"./transition-GwQ5KLRO.js";import"./toaster-BC5ooZuz.js";import"./use-toast-Bax0zrdw.js";import"./index-BISxdjyy.js";import"./index-Boi0YpkC.js";import"./createLucideIcon-LguoqwsX.js";import"./utils-zLT5xWck.js";import"./index-DK87wXAm.js";import"./XMarkIcon-CQ1f9l2a.js";import"./clipboard-check-D6W4U-7k.js";import"./package-check-EqVpNDj7.js";import"./trash-CVU7oZLJ.js";import"./index-BRvPMNG7.js";function He({ics:N,user:me,filters:xe}){var E,Y;const[j,Z]=u.useState(""),[S,ee]=u.useState(""),[C,te]=u.useState(new Date().getFullYear()),[se,ue]=u.useState([]),L=(E=N==null?void 0:N.data)==null?void 0:E.filter(t=>{var i,c,m,d,x,h,y,g,b;const o=`${((i=t.requested_by)==null?void 0:i.firstname)??""} ${((c=t.requested_by)==null?void 0:c.lastname)??""}`,s=((h=(x=(d=(m=t.po)==null?void 0:m.rfq)==null?void 0:d.purchase_request)==null?void 0:x.focal_person)==null?void 0:h.name)??"",l=j===""||((y=t.ics_number)==null?void 0:y.toLowerCase().includes(j.toLowerCase()))||((b=(g=t.inventory_item)==null?void 0:g.item_desc)==null?void 0:b.toLowerCase().includes(j.toLowerCase()))||o.toLowerCase().includes(j.toLowerCase())||s.toLowerCase().includes(j.toLowerCase()),a=new Date(t.created_at),n=S===""||a.getMonth()+1===Number(S),r=C===""||a.getFullYear()===Number(C);return l&&n&&r}),[re,q]=u.useState(!1),[I,$]=u.useState(null),[w,v]=u.useState([]),[p,k]=u.useState(""),A=(t,o)=>{const s=t.target.value;if(t.target.value="",s==="return"){$(o),v([]),k(""),q(!0);return}if(s==="reissuance"||s==="disposal"){const l=s==="reissuance"?"supply_officer.reissuance_form":"supply_officer.disposal_form";window.location.href=route(l,{id:o.id,type:"ics"})}},[ae,F]=u.useState(!1),[R,D]=u.useState([]),[Q,M]=u.useState(null);return e.jsxs(ce,{header:"Schools Divisions Office - Ilagan | Inventory Custodian Slip (ICS) - HIGH",children:[e.jsx(le,{title:"ICS - HIGH"}),e.jsx(oe,{}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Inventory Custodian Slip (ICS) - HIGH VALUE"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{onClick:()=>window.location.href=route("supply_officer.generate_ics_report_high",{month:S,year:C,search:j,type:"high"}),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm shadow",children:"Generate Report"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"month-filter",className:"text-sm font-medium",children:"Month:"}),e.jsxs("select",{id:"month-filter",className:"border border-gray-300 rounded-md px-2 py-1 text-sm shadow-sm",value:S,onChange:t=>ee(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map((t,o)=>e.jsx("option",{value:o+1,children:t},o))]}),e.jsx("label",{htmlFor:"year-filter",className:"text-sm font-medium ml-4",children:"Year:"}),e.jsx("input",{id:"year-filter",type:"number",className:"border border-gray-300 rounded-md px-2 py-1 w-24 text-sm shadow-sm",value:C,onChange:t=>te(t.target.value)})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search ICS number, item, focal person, receiver...",className:"border border-gray-300 rounded-md px-3 py-2 w-full md:w-64 text-sm shadow-sm",value:j,onChange:t=>Z(t.target.value)})})]}),e.jsx("div",{className:"mt-6 rounded-xl border border-gray-200 shadow-sm bg-white overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-100 to-gray-50 sticky top-0 z-10 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"#"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"ICS No."}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Division"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Requested By"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Item Description"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Total Cost"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:L&&L.length>0?L.map((t,o)=>{var n;const s=((n=t.items)==null?void 0:n.filter(r=>r.type==="high").map(r=>{var i,c,m,d,x;return{description:((c=(i=r.inventoryItem)==null?void 0:i.product)==null?void 0:c.name)??((m=r.inventory_item)==null?void 0:m.item_desc)??"N/A",specs:((x=(d=r.inventoryItem)==null?void 0:d.product)==null?void 0:x.specs)??"",quantity:r.quantity,unitCost:Number(r.unit_cost??0),totalCost:Number(r.total_cost??0),date:new Date(r.created_at).toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric"}),recipient:r.recipient??null}}))||[],l=se.includes(t.id),a=l?s:s.slice(0,1);return e.jsx(ne.Fragment,{children:a.map((r,i)=>{var m,d,x,h,y,g,b,P,_,H,z,O;const c=`transition-all duration-150 ${i%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-50 hover:shadow-sm`;return r.recipient?e.jsxs("tr",{className:c,children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800",children:o+1}),e.jsxs("td",{className:"px-4 py-3 text-blue-600 font-medium",children:["H-",t.ics_number]}),e.jsx("td",{className:"px-4 py-3",children:((h=(x=(d=(m=t.po)==null?void 0:m.rfq)==null?void 0:d.purchase_request)==null?void 0:x.division)==null?void 0:h.division)??"N/A"}),e.jsxs("td",{className:"px-4 py-3",children:[(y=t.requested_by)==null?void 0:y.firstname," ",(g=t.requested_by)==null?void 0:g.lastname]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"font-medium",children:r.description}),r.specs&&e.jsx("span",{className:"block text-xs text-gray-500",children:r.specs})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:r.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",r.unitCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",r.totalCost.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:r.date}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs("a",{href:route("supply_officer.print_ics_all",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium",children:[e.jsx(X,{size:14}),"Print"]}),e.jsx(f,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",onClick:()=>{M(t),D([]),F(!0)},children:"Switch Type"}),e.jsx(f,{type:"button",onClick:T=>A(T,t),value:"return",className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",children:"Return"})]})})]},`${t.id}-${i}`):e.jsxs("tr",{className:c,children:[i===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:a.length,className:"px-4 py-3 font-semibold text-gray-800 align-top",children:o+1}),e.jsxs("td",{rowSpan:a.length,className:"px-4 py-3 text-blue-600 font-medium align-top",children:["H-",t.ics_number]}),e.jsx("td",{rowSpan:a.length,className:"px-4 py-3 align-top",children:((H=(_=(P=(b=t.po)==null?void 0:b.rfq)==null?void 0:P.purchase_request)==null?void 0:_.division)==null?void 0:H.division)??"N/A"}),e.jsxs("td",{rowSpan:a.length,className:"px-4 py-3 align-top",children:[(z=t.requested_by)==null?void 0:z.firstname," ",(O=t.requested_by)==null?void 0:O.lastname]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"font-medium",children:r.description}),r.specs&&e.jsx("span",{className:"block text-xs text-gray-500",children:r.specs})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:r.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",r.unitCost.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["₱",r.totalCost.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:r.date}),i===a.length-1&&e.jsxs("td",{rowSpan:a.length,className:"px-4 py-3 text-center align-top",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs("a",{href:route("supply_officer.print_ics_all",t.id),target:"_blank",className:"inline-flex items-center justify-center gap-1 bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow-sm text-xs font-medium",children:[e.jsx(X,{size:14}),"Print"]}),e.jsx(f,{type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",onClick:()=>{M(t),D([]),F(!0)},children:"Switch Type"}),e.jsx(f,{type:"button",onClick:T=>A(T,t),value:"return",className:"bg-rose-600 hover:bg-rose-700 text-white px-3 py-2 rounded-lg text-xs font-medium shadow-sm",children:"Return"})]}),s.length>2&&e.jsx("button",{onClick:()=>toggleRowExpansion(t.id),className:"mt-2 text-blue-600 hover:underline text-xs flex items-center justify-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(MinusCircle,{size:14})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(PlusCircle,{size:14})," Show More"]})})]})]},`${t.id}-no-recipient-${i}`)})},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-10 text-gray-500 bg-gray-50 italic",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(de,{className:"w-10 h-10 mb-2 text-gray-400"}),e.jsx("span",{children:"No ICS records found"})]})})})})]})})}),((Y=N==null?void 0:N.links)==null?void 0:Y.length)>3&&e.jsx("nav",{className:"mt-4 flex justify-center items-center space-x-2",children:N.links.map((t,o)=>e.jsx(ie,{href:t.url||"#",className:`
                  px-3 py-1 text-sm rounded-md
                  ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
                  ${!t.url&&"opacity-50 cursor-not-allowed"}
                `,dangerouslySetInnerHTML:{__html:t.label}},o))})]}),e.jsx(G,{open:re,onOpenChange:q,children:e.jsxs(J,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(U,{className:"pb-3 border-b border-gray-100",children:[e.jsx(V,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Return Items"}),e.jsx(W,{className:"text-sm text-gray-500",children:"Select items to return and specify whether they are for reissuance or disposal."})]}),I?(()=>{const t=(I.items||[]).filter(s=>s.type==="high"),o=t.every(s=>{const l=Number(s.quantity??0),a=Number(s.total_reissued_quantity??0),n=Number(s.total_disposed_quantity??0);return a+n>=l});return console.log("allItemsProcessed",o),e.jsxs("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:[!o&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2 py-1 rounded-md hover:bg-gray-100",children:[e.jsx("input",{id:"select-all-return",type:"checkbox",checked:t.filter(s=>{const l=Number(s.quantity??0),a=Number(s.total_reissued_quantity??0),n=Number(s.total_disposed_quantity??0);return a+n<l}).every(s=>w.includes(s.id)),onChange:s=>{if(s.target.checked){const l=t.filter(a=>{const n=Number(a.quantity??0),r=Number(a.total_reissued_quantity??0),i=Number(a.total_disposed_quantity??0);return r+i<n}).map(a=>a.id);v(a=>[...new Set([...a,...l])])}else{const l=t.map(a=>a.id);v(a=>a.filter(n=>!l.includes(n)))}},className:"h-4 w-4 accent-blue-600"}),e.jsx("label",{htmlFor:"select-all-return",className:"text-sm font-medium text-gray-700 cursor-pointer select-none",children:"Select all"})]}),o?e.jsxs("div",{className:"p-4 text-center text-gray-500 text-sm italic bg-gray-50 rounded-md border border-gray-200",children:["All items in this issuance have already been"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"reissued"})," or"," ",e.jsx("span",{className:"font-semibold text-rose-600",children:"disposed"}),"."]}):t.map(s=>{var x,h,y,g,b;const l=((h=(x=s.inventoryItem)==null?void 0:x.product)==null?void 0:h.name)??((y=s.inventory_item)==null?void 0:y.item_desc)??"N/A",a=((b=(g=s.inventoryItem)==null?void 0:g.product)==null?void 0:b.specs)??"",n=Number(s.quantity??0),r=Number(s.total_reissued_quantity??0),i=Number(s.total_disposed_quantity??0),c=r+i,m=Math.max(n-c,0),d=c>=n;return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${w.includes(s.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"} ${d?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",checked:w.includes(s.id),disabled:d,onChange:P=>{d||v(_=>P.target.checked?[..._,s.id]:_.filter(H=>H!==s.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-gray-800",children:l}),d?e.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 border border-gray-300",children:"Fully processed"}):c>0?e.jsxs("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-300",children:["Some Items are returned (",c,"/",n,")"]}):e.jsxs("span",{className:"text-xs text-gray-600",children:["Remaining: ",m]})]}),a&&e.jsx("div",{className:"text-gray-500 text-xs",children:a}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",s.quantity," | ₱",Number(s.unit_cost??0).toFixed(2)]}),(r>0||i>0)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Returned:"," ",e.jsxs("span",{className:"text-blue-600 font-medium",children:[r," reissued"]})," ","|"," ",e.jsxs("span",{className:"text-rose-600 font-medium",children:[i," disposed"]})]})]})]},s.id)})]})})():e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs("div",{className:"mt-5 border-t pt-4",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-2",children:"Return Type"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${p==="reissuance"?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"reissuance",checked:p==="reissuance",onChange:t=>k(t.target.value),className:"h-4 w-4 accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Reissuance"})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer px-3 py-2 border rounded-md transition-all ${p==="disposal"?"border-rose-400 bg-rose-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"returnType",value:"disposal",checked:p==="disposal",onChange:t=>k(t.target.value),className:"h-4 w-4 accent-rose-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"For Disposal"})]})]})]}),e.jsxs(K,{className:"pt-5 border-t mt-4",children:[e.jsx(f,{variant:"outline",className:"w-28",onClick:()=>{q(!1),v([]),k(""),$(null)},children:"Cancel"}),e.jsx(f,{className:`w-28 text-white ${p==="disposal"?"bg-rose-600 hover:bg-rose-700":"bg-blue-600 hover:bg-blue-700"}`,disabled:!w.length||!p,onClick:()=>{if((I.items||[]).filter(l=>l.type==="high").every(l=>{const a=Number(l.quantity??0),n=Number(l.total_reissued_quantity??0),r=Number(l.total_disposed_quantity??0);return n+r>=a})){toast({title:"All items already processed",description:"There are no items left to return.",variant:"destructive"});return}if(w.length===0){toast({title:"No items selected",description:"Please select at least one item to return.",variant:"destructive"});return}if(!p){toast({title:"No return type chosen",description:"Please specify whether this return is for reissuance or disposal.",variant:"destructive"});return}const s=p==="reissuance"?"supply_officer.reissuance_form":"supply_officer.disposal_form";B.visit(route(s,{id:I.id,type:"ics",items:w.join(",")})),q(!1)},children:"Proceed"})]})]})}),e.jsx(G,{open:ae,onOpenChange:F,children:e.jsxs(J,{className:"max-w-lg rounded-xl border border-gray-200 shadow-md bg-white",children:[e.jsxs(U,{className:"pb-3 border-b border-gray-100",children:[e.jsx(V,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"Switch Type"}),e.jsxs(W,{className:"text-sm text-gray-500",children:["Select items you want to switch to ",e.jsx("b",{children:"High Value"})," type."]})]}),Q?e.jsx("div",{className:"mt-4 space-y-2 max-h-72 overflow-y-auto p-2 border rounded-md bg-gray-50",children:(Q.items||[]).filter(t=>t.type==="high").map(t=>{var l,a,n,r,i;const o=((a=(l=t.inventoryItem)==null?void 0:l.product)==null?void 0:a.name)??((n=t.inventory_item)==null?void 0:n.item_desc)??"N/A",s=((i=(r=t.inventoryItem)==null?void 0:r.product)==null?void 0:i.specs)??"";return e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-md border transition-colors ${R.includes(t.id)?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",checked:R.includes(t.id),onChange:c=>{D(m=>c.target.checked?[...m,t.id]:m.filter(d=>d!==t.id))},className:"mt-1 h-4 w-4 accent-blue-600"}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:o}),s&&e.jsx("div",{className:"text-gray-500 text-xs",children:s}),e.jsxs("div",{className:"text-gray-500 text-xs mt-0.5",children:["Qty: ",t.quantity," | ₱",Number(t.unit_cost??0).toFixed(2)]})]})]},t.id)})}):e.jsx("p",{className:"text-gray-500 text-sm mt-3 italic",children:"No items available."}),e.jsxs(K,{className:"pt-5 border-t mt-4",children:[e.jsx(f,{variant:"outline",className:"w-28",onClick:()=>{F(!1),D([]),M(null)},children:"Cancel"}),e.jsx(f,{className:"w-28 bg-blue-600 text-white hover:bg-blue-700",disabled:!R.length,onClick:()=>{var t;B.visit(route("supply_officer.switch_type",{type:"ics",id:Q.id,po_id:(t=Q.po)==null?void 0:t.id,items:R}))},children:"Continue"})]})]})})]})}export{He as default};
