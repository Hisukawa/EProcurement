import{a as u,u as Z,j as e}from"./app-Co243ZaK.js";import{u as I}from"./use-toast-DBpKaziH.js";import U from"./AutoCompleteInput-DXeFvv9B.js";import{F as ee}from"./file-text-BDO9e2m7.js";import{S as se}from"./send-horizontal-UCNE4kLo.js";import"./createLucideIcon-B43mRYUV.js";function re({purchaseOrder:p,inventoryItem:a,user:g,ppeOptions:j,icsNumber:y}){var E,R,$,q;const[z,h]=u.useState(!1),{toast:N}=I(),[i,G]=u.useState(null),[d,_]=u.useState(null),[t,O]=u.useState(null),[o,Q]=u.useState(null),[b,w]=u.useState("0001"),[B,H]=u.useState(""),m=(p==null?void 0:p.detail)??null,c=((E=m==null?void 0:m.pr_detail)==null?void 0:E.purchase_request)??null,M=c?`${c.focal_person.firstname} ${c.focal_person.middlename} ${c.focal_person.lastname}`:"N/A",W=a?a.item_desc:"N/A",v=(i==null?void 0:i.general_ledger_accounts)??[],{data:r,setData:l,post:Y,processing:S,errors:C}=Z({po_id:(p==null?void 0:p.id)??null,ics_number:y??"",requested_by:((R=c==null?void 0:c.focal_person)==null?void 0:R.id)??null,received_from:(g==null?void 0:g.id)??null,remarks:"",items:[{inventory_item_id:(a==null?void 0:a.id)??null,recipient:"",recipient_division:"",estimated_useful_life:null,inventory_item_number:"",ppe_sub_major_account:"",general_ledger_account:"",office:"",quantity:(m==null?void 0:m.quantity)??1,unit_cost:(a==null?void 0:a.unit_cost)??0,total_cost:((a==null?void 0:a.unit_cost)??0)*((m==null?void 0:m.quantity)??1),series_number:b}]});r.items[0].unit_cost<=5e3,u.useEffect(()=>{!i||!d||fetch(`/api/ics-next-series?ppe=${encodeURIComponent(i.name.trim())}&gl=${encodeURIComponent(d.name.trim())}`).then(s=>s.json()).then(s=>{s.series&&(w(s.series),l("items.0.series_number",s.series))}).catch(()=>{w(1),l("items.0.series_number",1)})},[i,d,t,o]),u.useEffect(()=>{var T,L,P;if(!i||!d||!b)return;const s=new Date().getFullYear().toString(),n=((T=i.code)==null?void 0:T.padStart(2,"0"))||"00",x=((L=d.code)==null?void 0:L.padStart(2,"0"))||"00",f=b==null?void 0:b.toString().padStart(4,"0"),X=((P=t==null?void 0:t.code)==null?void 0:P.padStart(2,"0"))||"",A=(t==null?void 0:t.name)==="Schools"&&(o!=null&&o.code)?o.code.padStart(2,"0"):"";let F=[s,n,x,f,X];A&&F.push(A);const D=F.filter(Boolean).join("-");H(D),l("items.0.inventory_item_number",D),l("items.0.ppe_sub_major_account",i.name||""),l("items.0.general_ledger_account",d.name||""),l("items.0.office",(t==null?void 0:t.name)||""),l("items.0.series_number",parseInt(b,10)),o&&l("items.0.school",o.name||"")},[i,d,t,o,b]);const J=s=>{s.preventDefault(),h(!0)},K=()=>{Y(route("supply_officer.store_ics"),{preserveScroll:!0,onSuccess:()=>{N({title:"✅ Success",description:"ICS issuance submitted successfully!",className:"bg-green-600 text-white"}),h(!1)},onError:()=>{N({title:"❌ Error",description:"Failed to submit ICS issuance.",variant:"destructive"}),h(!1)}})},V=s=>{let n=parseFloat(s.target.value)||0;const x=a.total_stock;n>x&&(n=x);const f=r.items[0].unit_cost??0;l("items",[{...r.items[0],quantity:n,total_cost:n*f}])},k=(s,n)=>{l("items",[{...r.items[0],[s]:n}])};return e.jsxs("div",{className:"bg-blue-50 p-8 rounded-xl shadow-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-800 mb-1 flex items-center gap-2",children:[e.jsx(ee,{size:24})," Inventory Custodian Slip (ICS)"]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-6",children:[e.jsx("strong",{children:"Note:"})," This is the Inventory Custodian Slip (ICS) form page. Fill out the details below to record an ICS issuance."]}),Object.keys(C).length>0&&e.jsx("div",{className:"col-span-2 bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(C).map(([s,n])=>e.jsx("li",{children:n},s))})}),e.jsxs("form",{onSubmit:J,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{value:(($=c==null?void 0:c.division)==null?void 0:$.division)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ICS No."}),e.jsx("input",{type:"text",value:r.ics_number,onChange:s=>l("ics_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Auto-generated (",y,") — you may edit if needed."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("input",{value:W,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:a.total_stock,onChange:V,placeholder:`Max: ${a.total_stock}`,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit"}),e.jsx("input",{value:((q=a.unit)==null?void 0:q.unit)??"N/A",readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Cost"}),e.jsx("input",{type:"number",value:r.items[0].unit_cost,onChange:s=>l("items.0.unit_cost",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total Cost"}),e.jsx("input",{type:"number",value:r.items[0].total_cost,onChange:s=>l("items.0.total_cost",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested By"}),e.jsx("input",{type:"text",value:M,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Name"}),e.jsx("input",{type:"text",value:r.items[0].recipient,onChange:s=>k("recipient",s.target.value),placeholder:"Leave blank to issue to requester",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Recipient Office / Division"}),e.jsx("input",{type:"text",value:r.items[0].recipient_division,onChange:s=>k("recipient_division",s.target.value),placeholder:"Optional",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PPE Sub-major Account"}),e.jsxs("select",{value:(i==null?void 0:i.id)||"",onChange:s=>{const n=j.find(x=>x.id==s.target.value);G(n||null),_(null)},className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsx("option",{value:"",children:"Select PPE"}),j.map(s=>e.jsx("option",{value:s.id,children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"General Ledger Account"}),e.jsxs("select",{value:(d==null?void 0:d.id)||"",onChange:s=>{const n=v.find(x=>x.id==s.target.value);_(n||null)},disabled:!i,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select GL"}),v.map(s=>e.jsx("option",{value:s.id,children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsx(U,{label:"Location Office",apiRoute:"/api/office-search",value:(t==null?void 0:t.code)||"",onChange:O,placeholder:"Type Location Office..."}),(t==null?void 0:t.name)==="Schools"&&e.jsx(U,{label:"School",apiRoute:"/api/school-search",value:(o==null?void 0:o.name)||"",onChange:Q,placeholder:"Type School..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Inventory Item No."}),e.jsx("input",{type:"text",value:B,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100"})]}),e.jsx("input",{type:"number",value:r.items[0].estimated_useful_life??"",onChange:s=>l("items.0.estimated_useful_life",s.target.value),placeholder:"Enter Estimated Useful Life in years (optional)",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white",onWheel:s=>s.currentTarget.blur()}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:r.remarks,onChange:s=>l("remarks",s.target.value),rows:"4",placeholder:"Enter remarks (optional)",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white"})]})]}),e.jsx("div",{className:"col-span-full flex justify-end mt-4",children:e.jsxs("button",{type:"submit",disabled:S,className:"inline-flex items-center px-6 py-2 bg-blue-700 text-white text-sm font-medium rounded-md hover:bg-blue-800 transition disabled:opacity-50",children:[e.jsx(se,{size:16,className:"mr-2"}),S?"Submitting...":"Submit Issuance"]})})]}),z&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Confirm Submission"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to submit this ICS issuance?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:K,className:"px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",children:"Confirm"})]})]})})]})}export{re as default};
