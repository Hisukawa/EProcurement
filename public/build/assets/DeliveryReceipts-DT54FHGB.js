import{a as o,u as F,j as e,H as q}from"./app-DD2uK0zY.js";import{S as I}from"./SupplyOfficerLayout-9UUPE-1N.js";import{C as P}from"./circle-plus-BJQ6wEx1.js";import{P as f}from"./package-check-CgHON6i4.js";import{P as D}from"./printer-check-D_z2ipge.js";import{X as A}from"./index-DVmik40P.js";import{a as x}from"./transition-o0BzbkQC.js";import{h as b}from"./dialog-DGSvGTgs.js";import"./toaster-C-9VAH0i.js";import"./use-toast-ib3QBt3c.js";import"./index-C6PyR5fr.js";import"./utils-BvCQ01dZ.js";import"./index-CYMZwvoE.js";import"./Dropdown-D-UuPbrA.js";import"./XMarkIcon-BochZeBY.js";import"./clipboard-check-BZYbEEj8.js";import"./createLucideIcon-Bms0I2ee.js";import"./trash-Dc00zV8h.js";import"./with-selector-DvB6bC3H.js";import"./disabled-C2Douwba.js";function te({inventoryData:n,filters:y,units:j}){var g;const[m,N]=o.useState(y.search||""),{data:r,setData:l,get:_,post:v,reset:w}=F({dr_number:"",dr_date:"",remarks:"",quantity:"",unit_id:"",custom_unit:"",item_desc:"",unit_price:""}),[k,c]=o.useState(!1);o.useEffect(()=>{const t=setTimeout(()=>{_(route("supply_officer.delivery_receipts"),{preserveState:!0,replace:!0,data:{search:m}})},300);return()=>clearTimeout(t)},[m]),(t=>{if(!t||!t.data)return[];const a=new Map;return t.data.forEach(i=>{var u;const s=((u=i.po_detail)==null?void 0:u.purchase_order)??null,d=(s==null?void 0:s.id)??`no_po_${i.id}`;a.has(d)||a.set(d,{po_id:(s==null?void 0:s.id)??null,po:s??null,requested_by:i.requested_by??null,items:[]}),a.get(d).items.push(i)}),Array.from(a.values())})(n);const S=t=>{t.preventDefault();const a=new Date,i=r.dr_date||a.toISOString().split("T")[0],s=new Date(i),d=`${s.getFullYear().toString().slice(-2)}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate()}`;v(route("supply_officer.store_central_delivery"),{data:{...r,dr_number:r.dr_number||d,dr_date:r.dr_date||i},onSuccess:()=>{c(!1),w()}})};return e.jsxs(I,{header:"Schools Divisions Office - Ilagan | Inventory",children:[e.jsx(q,{title:"Inventory"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Inventory"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("form",{onSubmit:t=>t.preventDefault(),className:"flex flex-wrap gap-3",children:e.jsx("input",{type:"text",placeholder:"Search item or Focal Person",className:"w-64 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m,onChange:t=>N(t.target.value)})}),e.jsxs("button",{onClick:()=>c(!0),className:"bg-green-600 text-white px-4 py-2 rounded-md shadow hover:bg-green-700 flex items-center gap-2 transition",children:[e.jsx(P,{size:18}),"Add Delivery Receipt"]})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"w-full table-auto text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["DR Number","Requested By","Item Description","Unit","Remaining Stock/Qty","Unit Price","Total Price","Status","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wide text-center",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-center",children:((g=n==null?void 0:n.data)==null?void 0:g.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"py-12 text-gray-500 text-lg font-medium",children:"No Inventory Found."})}):n.data.map(t=>{var h;const a=((h=t.unit)==null?void 0:h.unit)??"N/A",i=parseFloat(t.unit_cost)||0,s=parseFloat(t.issued_qty)||0,d=parseFloat(t.total_stock)||0,u=Math.max(d-s,0),C=(i*t.total_stock).toFixed(2);let p="Available";return t.total_stock===0?p="Fully Issued":t.total_stock<d&&(p="Partially Issued"),e.jsxs("tr",{className:"hover:bg-blue-50 transition duration-200",children:[e.jsx("td",{className:"px-6 py-4",children:t.dr_number??"N/A"}),e.jsx("td",{className:"px-6 py-4",children:t.requested_by?`${t.requested_by.firstname} ${t.requested_by.middlename??""} ${t.requested_by.lastname}`:"N/A"}),e.jsx("td",{className:"px-6 py-4",children:t.item_desc??"No description"}),e.jsx("td",{className:"px-6 py-4",children:a}),e.jsx("td",{className:"px-6 py-4",children:u}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",i.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",C]}),e.jsx("td",{className:"px-6 py-4",children:p}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.total_stock<=0?e.jsxs("span",{className:"bg-gray-300 text-gray-600 px-3 py-2 rounded cursor-not-allowed flex items-center justify-center gap-1",children:[e.jsx(f,{size:16})," All Items Are Issued"]}):e.jsxs("a",{href:route("supply_officer.issuance",{inventory_id:t.id}),className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition flex items-center justify-center gap-1",children:[e.jsx(f,{size:16})," Issue Item"]}),e.jsxs("a",{href:route("supply_officer.print_iar",t.iar_id),className:"bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700 transition flex items-center justify-center gap-1",target:"_blank",children:[e.jsx(D,{size:16})," Print IAR"]})]})})]},t.id)})})]})}),e.jsx(x,{appear:!0,show:k,as:o.Fragment,children:e.jsxs(b,{as:"div",className:"relative z-50",onClose:()=>c(!1),children:[e.jsx(x.Child,{as:o.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(x.Child,{as:o.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(b.Panel,{className:"bg-white w-full max-w-md rounded-xl shadow-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3 mb-4",children:[e.jsx(b.Title,{className:"text-lg font-bold text-gray-800",children:"Add Delivery Receipt"}),e.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(A,{size:20})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"DR Number"}),e.jsx("input",{type:"text",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.dr_number||"",onChange:t=>l("dr_number",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"DR Date"}),e.jsx("input",{type:"date",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.dr_date||"",onChange:t=>{l("dr_date",t.target.value)},required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Item Description"}),e.jsx("textarea",{className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.item_desc||"",onChange:t=>l("item_desc",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.quantity||"",onChange:t=>l("quantity",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Unit"}),e.jsxs("select",{className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 mb-2",value:r.unit_id||"",onChange:t=>{const a=t.target.value;a==="custom"?l("unit_id",""):(l("unit_id",a),l("custom_unit",""))},children:[e.jsx("option",{value:"",children:"Select Unit"}),j.map(t=>e.jsx("option",{value:t.id,children:t.unit},t.id)),e.jsx("option",{value:"custom",children:"Other"})]}),r.unit_id===""&&e.jsx("input",{type:"text",placeholder:"Enter custom unit",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.custom_unit||"",onChange:t=>l("custom_unit",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Unit Price (₱)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.unit_price||"",onChange:t=>l("unit_price",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Remarks"}),e.jsx("textarea",{rows:"2",className:"w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:r.remarks,onChange:t=>l("remarks",t.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save"})]})]})]})})})]})})]})}export{te as default};
