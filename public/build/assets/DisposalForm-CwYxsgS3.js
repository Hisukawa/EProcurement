import{a as C,u as A,j as e,H as Q}from"./app-Cs1McY02.js";import{u as T}from"./use-toast-RAxD_qPw.js";import{D as E,a as H,b as z,c as $,d as M,e as P}from"./dialog-AyJe73wc.js";import{B as k}from"./button-rqNSa_DM.js";import{S as L}from"./SupplyOfficerLayout-SWi0o-s2.js";import{F as U}from"./file-text--pdc2I_9.js";import{S as Y}from"./send-horizontal-CkakJS97.js";import"./index-CnXzlo42.js";import"./index-DmEAzzlf.js";import"./createLucideIcon-CAyUIJle.js";import"./utils-BVseyFTm.js";import"./index-mEOC90f-.js";import"./toaster-CNCOgU5M.js";import"./index-OUqkuChP.js";import"./Dropdown-ckgaHpXR.js";import"./transition-1OrjVXTB.js";import"./XMarkIcon-DDKr4MYC.js";import"./clipboard-check-BH2-nbLx.js";import"./package-check-CNnh4aWJ.js";import"./trash-DcaSG3EI.js";function ye({record:r,user:G,type:J,rrsp_number:q,selected_items:n=[]}){var y;const{toast:d}=T(),[I,l]=C.useState(!1),c=C.useMemo(()=>{var s;return!Array.isArray(n)||n.length===0?(r==null?void 0:r.items)??[]:((s=r==null?void 0:r.items)==null?void 0:s.filter(t=>{var i;return n.includes((i=t.id)==null?void 0:i.toString())}))??[]},[r,n]),F=Array.from(new Set(c.map(s=>{if(s.recipient)return s.recipient;const t=(r==null?void 0:r.requested_by)||(r==null?void 0:r.received_from);return t?`${t.firstname??""} ${t.middlename??""} ${t.lastname??""}`.trim():""}).filter(Boolean))).join(", "),{data:a,setData:m,errors:u,processing:p,post:O}=A({rrsp_number:q??"",ics_number:((y=r==null?void 0:r.po)==null?void 0:y.po_number)??"",items:c.map(s=>{var b,g,f,j,v,N,_,D,w,S;const t=Number(s.quantity??0),i=Number(((b=s.reissued_item)==null?void 0:b.quantity)??0),o=Number(((g=s.disposed_item)==null?void 0:g.quantity)??0),h=Math.max(t-(i+o),0);return{inventory_item_id:s.inventory_item_id,returned_by:s.recipient??"",recipient:"",quantity:h,max_quantity:h,remarks:"",item_desc:((f=s.inventory_item)==null?void 0:f.item_desc)??((v=(j=s.inventoryItem)==null?void 0:j.product)==null?void 0:v.name)??"N/A",unit:((_=(N=s.inventory_item)==null?void 0:N.unit)==null?void 0:_.unit_name)??((S=(w=(D=s.inventoryItem)==null?void 0:D.product)==null?void 0:w.unit)==null?void 0:S.unit_name)??""}})}),R=s=>{s.preventDefault(),l(!0)},B=()=>{const s={ics_number:a.ics_number||null,date_disposed:new Date().toISOString().split("T")[0],items:a.items.map(t=>({inventory_item_id:t.inventory_item_id,returned_by:t.returned_by,quantity:t.quantity,remarks:t.remarks||""}))};O(route("supply_officer.submit_disposal"),s,{preserveScroll:!0,onSuccess:()=>{l(!1),d({title:"Disposal Recorded",description:"Disposal record successfully saved!",duration:3e3,className:"bg-green-600 text-white"})},onError:()=>{d({title:"Save Failed",description:"Please review inputs and try again.",variant:"destructive",duration:4e3})}})},x=(s,t,i)=>{const o=[...a.items];o[s][t]=i,m("items",o)};return e.jsxs(L,{header:"Schools Division Office - Ilagan | Disposal Form",children:[e.jsx(Q,{title:"Disposal Form"}),e.jsx("div",{className:"flex items-center justify-center py-10 px-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg w-full max-w-7xl border border-gray-200",children:[e.jsxs("h2",{className:"text-3xl font-bold text-red-700 mb-4 flex items-center gap-2",children:[e.jsx(U,{size:24})," Disposal Form"]}),Object.keys(u).length>0&&e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(u).map(([s,t])=>e.jsx("li",{children:t},s))})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-6",children:[e.jsx("strong",{children:"Note:"})," This form records items returned for disposal."]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"p-5 border rounded-md bg-red-50 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Returned By / End-User"}),e.jsx("input",{type:"text",value:F,readOnly:!0,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"RRSP No."}),e.jsx("input",{type:"text",value:a.rrsp_number,onChange:s=>m("rrsp_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ICS No."}),e.jsx("input",{type:"text",value:a.ics_number,onChange:s=>m("ics_number",s.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 mb-2",children:"Returned Items"}),a.items.length===0?e.jsx("p",{className:"text-gray-600 text-sm p-2 italic",children:"No items selected for disposal."}):e.jsx("div",{className:"overflow-x-auto border rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-gray-200 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Item Description"}),e.jsx("th",{className:"p-2 border",children:"Quantity"}),e.jsx("th",{className:"p-2 border",children:"Remarks"})]})}),e.jsx("tbody",{children:a.items.map((s,t)=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:s.item_desc}),e.jsx("td",{className:"p-2 border text-center",children:e.jsx("input",{type:"number",value:s.quantity,onChange:i=>x(t,"quantity",i.target.value),className:"w-20 text-center border-gray-300 rounded-md"})}),e.jsx("td",{className:"p-2 border",children:e.jsx("textarea",{value:s.remarks||"",onChange:i=>x(t,"remarks",i.target.value),className:"w-full border-gray-300 rounded-md text-sm p-1"})})]},t))})]})})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-red-700 text-white text-sm font-medium rounded-md hover:bg-red-800 transition",disabled:p,children:[e.jsx(Y,{size:16,className:"mr-2"}),p?"Saving...":"Confirm"]})})]}),e.jsx(E,{open:I,onOpenChange:l,children:e.jsxs(H,{className:"sm:max-w-md",children:[e.jsxs(z,{children:[e.jsx($,{children:"Confirm Disposal"}),e.jsx(M,{children:"Are you sure you want to record this disposal entry?"})]}),e.jsxs(P,{className:"mt-4",children:[e.jsx(k,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),e.jsx(k,{onClick:B,children:"Yes, Record Disposal"})]})]})})]})})]})}export{ye as default};
