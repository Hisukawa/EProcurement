import{a as t,j as e,H as $,c as k}from"./app-B7_UX2sh.js";import"./Dropdown-Cr-ssEUb.js";import"./index-iU02Ez0U.js";import{u as H}from"./use-toast-B7jOcQUg.js";import"./toaster-CYWm_-9N.js";import{D as x,a as h,b as m,c as g,d as u,e as p}from"./dialog-DohJNFeT.js";import{B as a}from"./button-BPZKlegq.js";import{T}from"./textarea-CfGICtRR.js";import{T as U}from"./TwgUserLayout-qxh45U5r.js";import{T as Y}from"./triangle-alert-Bd6noup8.js";import"./transition-CrNCWD_V.js";import"./index-C9v5eIVZ.js";import"./index-Dbmq-qNg.js";import"./createLucideIcon-Bz5E4J9E.js";import"./utils-3YMp73RZ.js";import"./index-BbZGCgbR.js";import"./index-Ddce4cKg.js";import"./XMarkIcon-5mCUXE4W.js";import"./clipboard-check-D0FUKkmt.js";function ce({pr:s}){const[j,R]=t.useState(""),[b,S]=t.useState(""),[_,o]=t.useState(!1),[O,l]=t.useState(!1),{toast:i}=H(),[C,f]=t.useState(!1),[P,y]=t.useState(!1),q=()=>{if(!j.trim()){S("You must provide a reason.");return}y(!0),k.post(route("twg_user.send_back",s.id),{reason:j},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{i({title:"Sent Back!",description:"The PR has been sent back with your reason.",className:"bg-green-500 text-white"}),R(""),o(!1),y(!1)},onError:()=>{i({title:"Error",description:"Failed to send back PR. Please try again.",className:"bg-red-500 text-white"}),y(!1)}})},[n,c]=t.useState({open:!1,success:!0,title:"",text:""}),F=()=>{f(!0),l(!1),k.post(route("twg_user.review",s.id),{},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{f(!1),c({open:!0,success:!0,title:"Reviewed!",text:"The PR has been reviewed."}),i({title:"Reviewed!",description:"The PR has been reviewed.",className:"bg-green-500 text-white"})},onError:()=>{f(!1),c({open:!0,success:!1,title:"Error",text:"Failed to review the PR. Please try again."}),i({title:"Error",description:"Failed to review the PR. Please try again.",className:"bg-red-500 text-white"})}})},[I,d]=t.useState(!1),[v,D]=t.useState(""),[E,w]=t.useState(!1),[N,B]=t.useState(""),L=()=>{if(!v.trim()){B("You must provide a rejection reason.");return}w(!0),k.post(route("twg_user.reject",s.id),{reason:v},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{w(!1),d(!1),D(""),i({title:"Rejected!",description:"The purchase request has been rejected.",className:"bg-red-500 text-white"})},onError:()=>{w(!1),i({title:"Error",description:"Failed to reject PR. Please try again.",className:"bg-red-500 text-white"})}})};return e.jsxs(U,{header:"Schools Divisions Office - Ilagan | View Details",children:[e.jsx($,{title:`PR #${s.pr_number} Details`}),e.jsxs("div",{className:"mx-auto mt-10 p-6 bg-white shadow-xl rounded-xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>window.history.back(),className:`inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg text-sm font-medium transition-colors duration-200 ease-in-out shadow-sm
                       focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back"]})}),e.jsxs("div",{className:"border-b pb-4 mb-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-800",children:["Purchase Request"," ",e.jsxs("span",{className:"text-indigo-600",children:["#",s.pr_number]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Created on ",new Date(s.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 text-base",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Purpose:"})," ",s.purpose]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Status:"}),e.jsx("span",{className:`ml-2 inline-block px-3 py-1 rounded-full text-xs font-semibold
              ${s.status==="Reviewed"?"bg-green-100 text-green-800":s.status==="Pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Requested By:"})," ",s.requester_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Division:"})," ",s.division]})]}),s.approval_image&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Approval Image"}),e.jsx("img",{src:`/storage/${s.approval_image}`,alt:"Approval Form",className:"w-full max-h-[400px] object-contain border border-gray-200 rounded-lg shadow-md"})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Item Details"}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",children:"Item"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",children:"Specs"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 border-r border-gray-200 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total"})]})}),e.jsx("tbody",{children:s.details.map((r,A)=>e.jsxs("tr",{className:`hover:bg-gray-50 ${A%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 py-2 border-r border-gray-200",children:r.item}),e.jsx("td",{className:"px-4 py-2 border-r border-gray-200",children:r.specs}),e.jsx("td",{className:"px-4 py-2 border-r border-gray-200",children:r.unit}),e.jsx("td",{className:"px-4 py-2 border-r border-gray-200 text-center",children:r.quantity}),e.jsxs("td",{className:"px-4 py-2 border-r border-gray-200 text-right",children:["₱",Number(r.unit_price).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2 text-right font-semibold text-gray-800",children:["₱",Number(r.total_price).toFixed(2)]})]},r.id))})]})})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[s.status.toLowerCase()!=="reviewed"&&e.jsx(a,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>l(!0),children:"Mark as Reviewed"}),s.status.toLowerCase()!=="reviewed"&&e.jsx(a,{className:"bg-yellow-500 hover:bg-yellow-600 text-white",onClick:()=>o(!0),children:"Send Back"}),s.status.toLowerCase()==="pending"&&e.jsx(a,{className:"bg-red-500 hover:bg-red-600 text-white",onClick:()=>d(!0),children:"Reject"})]})]}),e.jsx(x,{open:_,onOpenChange:o,children:e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(g,{children:"Send Back Reason"}),e.jsx(u,{children:"Enter your reason for sending back..."})]}),e.jsx(T,{placeholder:"Enter your reason for sending back...","aria-label":"Enter your reason for sending back",value:j,onChange:r=>{R(r.target.value),b&&S("")}}),b&&e.jsx("p",{className:"text-sm text-red-500 mt-2",children:b}),e.jsxs(p,{children:[e.jsx(a,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(a,{onClick:q,disabled:P,children:P?"Sending Back...":"Send Back"})]})]})}),e.jsx(x,{open:O,onOpenChange:l,children:e.jsxs(h,{children:[e.jsxs(m,{className:"flex flex-col items-center text-center",children:[e.jsx(Y,{}),e.jsx(g,{children:"Are you sure?"}),e.jsx(u,{children:"You are about to mark this request as reviewed."})]}),e.jsxs(p,{children:[e.jsx(a,{variant:"destructive",onClick:()=>l(!1),children:"Cancel"}),e.jsx(a,{onClick:F,disabled:C,children:C?"Reviewing...":"Confirm"})]})]})}),e.jsx(x,{open:n.open,onOpenChange:r=>c({...n,open:r}),children:e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsxs(g,{className:n.success?"text-green-600":"text-red-600",children:[n.success?"✅ ":"❌ "," ",n.title]}),e.jsx(u,{children:n.text})]}),e.jsx(p,{children:e.jsx(a,{onClick:()=>c({...n,open:!1}),children:"OK"})})]})}),e.jsx(x,{open:I,onOpenChange:d,children:e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(g,{children:"Reject Purchase Request"}),e.jsx(u,{children:"Provide a reason for rejecting this purchase request."})]}),e.jsx(T,{placeholder:"Enter rejection reason...","aria-label":"Enter rejection reason",value:v,onChange:r=>{D(r.target.value),N&&B("")}}),N&&e.jsx("p",{className:"text-sm text-red-500 mt-2",children:N}),e.jsxs(p,{children:[e.jsx(a,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(a,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:L,disabled:E,children:E?"Rejecting...":"Reject"})]})]})})]})}export{ce as default};
