import{b as K,a as r,c,j as e,H as W}from"./app-2dY0mcfJ.js";import{T as G}from"./Tooltip-D8wa3Qqs.js";import{u as J}from"./use-toast-DLLEHaaE.js";import{R as Q}from"./RequesterLayout-Q1PZDWC9.js";import"./sweetalert2.esm.all-Bj_ZQUAw.js";import{D as v,a as j,b as y,c as w,d as S,e as N}from"./dialog-BOrtGsCV.js";import{B as p}from"./button-lZCF6GJV.js";import{S as X}from"./send-horizontal-1Gp4Ai5E.js";import{c as Z}from"./createLucideIcon-BSM3CWrD.js";import{C as ee}from"./circle-check-Z6vdi_Oy.js";import"./Dropdown-7J_2QaEs.js";import"./transition-CcrEs0gU.js";import"./toaster-CGUaQDjW.js";import"./index-t44Pv__V.js";import"./index-ptG2qq3X.js";import"./utils-C_hDN855.js";import"./index-6nanuBrI.js";import"./index-Cz20RxEC.js";import"./XMarkIcon-3E_2Wiyu.js";import"./BellAlertIcon-DwMWr0_X.js";import"./index-BT060lhp.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],se=Z("printer",te);function Ne({purchaseRequests:i,search:R,month:_}){const{props:h}=K(),[g,A]=r.useState(R||""),[f,M]=r.useState(_||""),[d,C]=r.useState({}),[E,P]=r.useState(!1),[O,q]=r.useState(""),{toast:m}=J(),[F,I]=r.useState(!1),[o,u]=r.useState({open:!1,prId:null,text:""}),[l,b]=r.useState({open:!1,success:!0,title:"",text:""});r.useEffect(()=>{const t=localStorage.getItem("flashSuccess"),s=localStorage.getItem("highlightPrId");t&&(q(t),P(!0),m({title:"PR Submitted",description:t,className:"bg-green-500 text-white",duration:3e3}),localStorage.removeItem("flashSuccess")),s&&(D(Number(s)),localStorage.removeItem("highlightPrId"))},[]);const[T,D]=r.useState(null);r.useEffect(()=>{const t=localStorage.getItem("highlightPrId");t&&h.highlightPrId?(D(t),localStorage.removeItem("highlightPrId")):h.highlightPrId&&D(h.highlightPrId)},[h.highlightPrId]);const H=r.useMemo(()=>Array.from({length:12},(t,s)=>({value:s+1,label:new Date(0,s).toLocaleString("default",{month:"long"})})),[]);r.useCallback((t,s,a)=>{setAlertDialog({open:!0,title:s,text:a,success:t})},[]);const $=r.useCallback((t,s)=>{const a=t.target.files[0];a&&C(n=>({...n,[s]:a}))},[]),L=r.useCallback(t=>{u({open:!0,prId:t,text:"You won't be able to edit this PR after sending."})},[]),U=r.useCallback(()=>{if(!o.prId)return;I(!0);const t=o.prId,s=new FormData;d[t]&&s.append("approval_image",d[t]),c.post(route("requester.pr.send_for_approval",t),s,{forceFormData:!0,preserveScroll:!0,preserveState:!0,onSuccess:()=>{b({open:!0,success:!0,title:"Sent!",text:"The approved PR form has been sent."}),m({title:"PR Sent",description:"PR is sent for approval",className:"bg-green-500 text-white",duration:3e3}),C(a=>{const n={...a};return delete n[t],n}),u({open:!1,prId:null,text:""}),I(!1)},onError:()=>{b({open:!0,success:!1,title:"Error",text:"Failed to send approved PR form."}),u({open:!1,prId:null,text:""}),I(!1)}})},[o.prId,d]),z=r.useCallback(t=>{window.open(route("requester.print",t),"_blank")},[]);r.useEffect(()=>{if(g===(R||"")&&f===(_||""))return;const t=setTimeout(()=>{c.get(route("requester.manage_requests"),{search:g,month:f},{preserveScroll:!0,preserveState:!0,replace:!0})},300);return()=>clearTimeout(t)},[g,f]),r.useEffect(()=>{let t;return(()=>{t=setInterval(()=>{document.visibilityState==="visible"&&c.reload({only:["purchaseRequests"],preserveScroll:!0,preserveState:!0})},1e4)})(),()=>clearInterval(t)},[]);const V=r.useCallback(t=>{if(!d[t]){m({title:"No file selected",description:"Please choose an approved PR form image before uploading.",className:"bg-yellow-500 text-white",duration:3e3});return}const s=new FormData;s.append("approval_image",d[t]),c.post(route("requester.upload_approved_form",t),s,{forceFormData:!0,preserveScroll:!0,preserveState:!0,onSuccess:()=>{m({title:"Form Uploaded",description:"Approved PR form uploaded successfully.",className:"bg-green-500 text-white",duration:3e3}),C(a=>{const n={...a};return delete n[t],n})},onError:()=>{m({title:"Upload Failed",description:"Could not upload approved PR form.",className:"bg-red-500 text-white",duration:3e3})}})},[d]),[Y,k]=r.useState(!1),[x,B]=r.useState(null);return e.jsxs(Q,{header:"Schools Division Office - Ilagan | Manage Requests",children:[e.jsx(W,{title:"Manage Requests"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6 border border-gray-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Your Purchase Requests"}),e.jsx("button",{onClick:()=>c.get(route("requester.create")),className:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-5 py-2 rounded-md shadow",children:"+ Create PR"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-3 mb-5",children:[e.jsxs("p",{className:"text-gray-600 text-sm",children:["Showing ",i.from??0," - ",i.to??0," of ",i.total??0," requests"]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsx("input",{type:"text",value:g,onChange:t=>A(t.target.value),placeholder:"Search PR # or purpose...",className:"px-4 py-2 border border-gray-300 rounded-md text-sm w-full md:w-64"}),e.jsxs("select",{value:f,onChange:t=>M(t.target.value),className:"px-10 py-2 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"",children:"All Months"}),H.map(({value:t,label:s})=>e.jsx("option",{value:t,children:s},t))]})]})]}),e.jsxs("div",{className:"overflow-x-auto rounded-md border border-gray-200 shadow-sm bg-white",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsx("tr",{children:["PR Number","Purpose","Status","Date Created","Signed PR Form","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider",children:t},t))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.data.map(t=>e.jsxs("tr",{id:`pr-${t.id}`,className:`hover:bg-indigo-50 transition duration-200 ${t.id===T?"bg-green-100":""}`,children:[e.jsx("td",{className:"px-6 py-4 text-center text-indigo-600 font-medium",children:t.is_sent===0&&t.status!=="Reviewed"?e.jsx(G,{to:route("requester.add_details",t.id),tooltip:"Edit PR",className:"hover:underline text-indigo-600",children:t.pr_number}):e.jsx("span",{className:"text-gray-500 cursor-not-allowed",children:t.pr_number})}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-700",children:t.purpose}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${t.status==="Reviewed"?"bg-green-100 text-green-800":t.status==="Pending"?"bg-yellow-100 text-yellow-800":t.status==="Rejected"?"bg-red-100 text-red-800":"bg-gray-200 text-gray-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-600 text-sm font-mono",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.status==="Reviewed"?t.approval_image?e.jsx("button",{className:"text-indigo-600 hover:underline text-sm",onClick:()=>{B(t.approval_image),k(!0)},children:"View Uploaded Form"}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:s=>$(s,t.id),className:"text-sm px-2 py-1 border border-gray-300 rounded-md"}),e.jsx(p,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>V(t.id),children:"Upload Form"})]}):t.is_sent===0?e.jsx("span",{className:"text-gray-500 text-sm",children:"Pending send for review"}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Waiting for approval"})}),e.jsxs("td",{className:"px-6 py-4 text-center space-x-2",children:[t.is_sent===0&&e.jsxs("div",{className:"relative group inline-block",children:[e.jsx("button",{onClick:()=>L(t.id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-sm",children:e.jsx(X,{})}),e.jsx("span",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap",children:"Send for Approval"})]}),t.status==="Reviewed"&&e.jsxs("div",{className:"relative group inline-block",children:[e.jsx("button",{onClick:()=>z(t.id),className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded-md text-sm",children:e.jsx(se,{})}),e.jsx("span",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap",children:"Print"})]})]})]},t.id))})]}),i.links.length>3&&e.jsx("div",{className:"flex justify-center items-center gap-2 mt-6 flex-wrap",children:i.links.map((t,s)=>e.jsx("button",{disabled:!t.url,onClick:()=>t.url&&c.visit(t.url,{preserveScroll:!0,preserveState:!0}),className:`px-4 py-2 text-sm rounded-md border transition ${t.active?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 hover:bg-gray-100 border-gray-300"} ${!t.url&&"opacity-50 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:t.label}},s))})]})]}),e.jsx(v,{open:E,onOpenChange:P,children:e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ee,{size:24}),"Success!"]}),e.jsx(S,{className:"pt-4 text-base",children:O})]}),e.jsx(N,{children:e.jsx(p,{onClick:()=>P(!1),children:"OK"})})]})}),e.jsx(v,{open:o.open,onOpenChange:t=>u({...o,open:t}),children:e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"Send for Approval?"}),e.jsx(S,{children:o.text})]}),e.jsxs(N,{className:"flex justify-between gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>u({...o,open:!1}),children:"Cancel"}),e.jsx(p,{onClick:U,disabled:F,children:F?"Sending...":"Confirm"})]})]})}),e.jsx(v,{open:l.open,onOpenChange:t=>b({...l,open:t}),children:e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:l.success?"text-green-600":"text-red-600",children:[l.success?"✅ ":"❌ "," ",l.title]}),e.jsx(S,{children:l.text})]}),e.jsx(N,{children:e.jsx(p,{onClick:()=>b({...l,open:!1}),children:"OK"})})]})}),e.jsx(v,{open:Y,onOpenChange:k,children:e.jsxs(j,{className:"w-full max-w-4xl h-[80vh]",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Approved Form"}),e.jsx(S,{children:"You can view or download the approved PR form here."})]}),e.jsx("div",{className:"mt-4 flex-1 overflow-auto",children:x!=null&&x.endsWith(".pdf")?e.jsx("iframe",{src:`/storage/${x}`,className:"w-full h-[70vh] border rounded-lg",title:"Approved Form"}):e.jsx("img",{src:`/storage/${x}`,alt:"Approved Form",className:"w-full max-h-[70vh] object-contain border rounded-lg"})}),e.jsx(N,{className:"mt-4 flex justify-end gap-2",children:e.jsx(p,{onClick:()=>k(!1),variant:"outline",children:"Close"})})]})})]})}export{Ne as default};
