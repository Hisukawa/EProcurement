import{R as Oe,a as d,u as pt,b as mt,j as t,H as bt,c as me,d as gt}from"./app-DD2uK0zY.js";import{A as xt}from"./ApproverLayout-Drmm5H6a.js";import{D as Te,a as Fe,b as Le,c as ke,d as De,e as Ae}from"./dialog-zrxpP4Hw.js";import{S as ee}from"./sweetalert2.esm.all-Bj_ZQUAw.js";import{u as ht}from"./use-toast-ib3QBt3c.js";import{S as vt}from"./scroll-text-B4cw2cTw.js";import{F as yt}from"./file-plus-2-EmOu17XL.js";import{F as wt}from"./PencilSquareIcon-CnEiHvBB.js";import{T as $t}from"./trash-2-CfHuVEHN.js";import{S as jt}from"./save-B7Yc6mQv.js";import{C as Et}from"./circle-check-roZ2a4lW.js";import{l as St,a as Nt,n as _t}from"./disabled-C2Douwba.js";import{p as Ct,o as Me,Y as Pt,V as Tt,K as Ft}from"./transition-o0BzbkQC.js";import"./Dropdown-D-UuPbrA.js";import"./toaster-C-9VAH0i.js";import"./index-C6PyR5fr.js";import"./index-DVmik40P.js";import"./createLucideIcon-Bms0I2ee.js";import"./utils-BvCQ01dZ.js";import"./index-CYMZwvoE.js";import"./index-CFjd8-1k.js";import"./XMarkIcon-BochZeBY.js";import"./file-text-BZ7nVK1e.js";import"./index-Br8PWsuU.js";const Be=typeof document<"u"?Oe.useLayoutEffect:()=>{};var be;const Lt=(be=Oe.useInsertionEffect)!==null&&be!==void 0?be:Be;function kt(e){const r=d.useRef(null);return Lt(()=>{r.current=e},[e]),d.useCallback((...n)=>{const o=r.current;return o==null?void 0:o(...n)},[])}const D=e=>{var r;return(r=e==null?void 0:e.ownerDocument)!==null&&r!==void 0?r:document},M=e=>e&&"window"in e&&e.window===e?e:D(e).defaultView||window;function Dt(e){return e!==null&&typeof e=="object"&&"nodeType"in e&&typeof e.nodeType=="number"}function At(e){return Dt(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"host"in e}let Mt=!1;function we(){return Mt}function Re(e,r){if(!we())return r&&e?e.contains(r):!1;if(!e||!r)return!1;let n=r;for(;n!==null;){if(n===e)return!0;n.tagName==="SLOT"&&n.assignedSlot?n=n.assignedSlot.parentNode:At(n)?n=n.host:n=n.parentNode}return!1}const ge=(e=document)=>{var r;if(!we())return e.activeElement;let n=e.activeElement;for(;n&&"shadowRoot"in n&&(!((r=n.shadowRoot)===null||r===void 0)&&r.activeElement);)n=n.shadowRoot.activeElement;return n};function Ie(e){return we()&&e.target.shadowRoot&&e.composedPath?e.composedPath()[0]:e.target}function Ht(e){var r;if(typeof window>"u"||window.navigator==null)return!1;let n=(r=window.navigator.userAgentData)===null||r===void 0?void 0:r.brands;return Array.isArray(n)&&n.some(o=>e.test(o.brand))||e.test(window.navigator.userAgent)}function Ot(e){var r;return typeof window<"u"&&window.navigator!=null?e.test(((r=window.navigator.userAgentData)===null||r===void 0?void 0:r.platform)||window.navigator.platform):!1}function We(e){let r=null;return()=>(r==null&&(r=e()),r)}const Bt=We(function(){return Ot(/^Mac/i)}),Rt=We(function(){return Ht(/Android/i)});function Qe(){let e=d.useRef(new Map),r=d.useCallback((a,p,b,u)=>{let m=u!=null&&u.once?(...g)=>{e.current.delete(b),b(...g)}:b;e.current.set(b,{type:p,eventTarget:a,fn:m,options:u}),a.addEventListener(p,m,u)},[]),n=d.useCallback((a,p,b,u)=>{var m;let g=((m=e.current.get(b))===null||m===void 0?void 0:m.fn)||b;a.removeEventListener(p,g,u),e.current.delete(b)},[]),o=d.useCallback(()=>{e.current.forEach((a,p)=>{n(a.eventTarget,a.type,p,a.options)})},[n]);return d.useEffect(()=>o,[o]),{addGlobalListener:r,removeGlobalListener:n,removeAllGlobalListeners:o}}function It(e){return e.pointerType===""&&e.isTrusted?!0:Rt()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function Ve(e){let r=e;return r.nativeEvent=e,r.isDefaultPrevented=()=>r.defaultPrevented,r.isPropagationStopped=()=>r.cancelBubble,r.persist=()=>{},r}function Wt(e,r){Object.defineProperty(e,"target",{value:r}),Object.defineProperty(e,"currentTarget",{value:r})}function Ge(e){let r=d.useRef({isFocused:!1,observer:null});Be(()=>{const o=r.current;return()=>{o.observer&&(o.observer.disconnect(),o.observer=null)}},[]);let n=kt(o=>{e==null||e(o)});return d.useCallback(o=>{if(o.target instanceof HTMLButtonElement||o.target instanceof HTMLInputElement||o.target instanceof HTMLTextAreaElement||o.target instanceof HTMLSelectElement){r.current.isFocused=!0;let a=o.target,p=b=>{if(r.current.isFocused=!1,a.disabled){let u=Ve(b);n(u)}r.current.observer&&(r.current.observer.disconnect(),r.current.observer=null)};a.addEventListener("focusout",p,{once:!0}),r.current.observer=new MutationObserver(()=>{if(r.current.isFocused&&a.disabled){var b;(b=r.current.observer)===null||b===void 0||b.disconnect();let u=a===document.activeElement?null:document.activeElement;a.dispatchEvent(new FocusEvent("blur",{relatedTarget:u})),a.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:u}))}}),r.current.observer.observe(a,{attributes:!0,attributeFilter:["disabled"]})}},[n])}let Qt=!1,q=null,xe=new Set,U=new Map,H=!1,he=!1;const Vt={Tab:!0,Escape:!0};function $e(e,r){for(let n of xe)n(e,r)}function Gt(e){return!(e.metaKey||!Bt()&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}function ne(e){H=!0,Gt(e)&&(q="keyboard",$e("keyboard",e))}function R(e){q="pointer",(e.type==="mousedown"||e.type==="pointerdown")&&(H=!0,$e("pointer",e))}function Ke(e){It(e)&&(H=!0,q="virtual")}function Ue(e){e.target===window||e.target===document||Qt||!e.isTrusted||(!H&&!he&&(q="virtual",$e("virtual",e)),H=!1,he=!1)}function qe(){H=!1,he=!0}function ve(e){if(typeof window>"u"||typeof document>"u"||U.get(M(e)))return;const r=M(e),n=D(e);let o=r.HTMLElement.prototype.focus;r.HTMLElement.prototype.focus=function(){H=!0,o.apply(this,arguments)},n.addEventListener("keydown",ne,!0),n.addEventListener("keyup",ne,!0),n.addEventListener("click",Ke,!0),r.addEventListener("focus",Ue,!0),r.addEventListener("blur",qe,!1),typeof PointerEvent<"u"&&(n.addEventListener("pointerdown",R,!0),n.addEventListener("pointermove",R,!0),n.addEventListener("pointerup",R,!0)),r.addEventListener("beforeunload",()=>{Ye(e)},{once:!0}),U.set(r,{focus:o})}const Ye=(e,r)=>{const n=M(e),o=D(e);r&&o.removeEventListener("DOMContentLoaded",r),U.has(n)&&(n.HTMLElement.prototype.focus=U.get(n).focus,o.removeEventListener("keydown",ne,!0),o.removeEventListener("keyup",ne,!0),o.removeEventListener("click",Ke,!0),n.removeEventListener("focus",Ue,!0),n.removeEventListener("blur",qe,!1),typeof PointerEvent<"u"&&(o.removeEventListener("pointerdown",R,!0),o.removeEventListener("pointermove",R,!0),o.removeEventListener("pointerup",R,!0)),U.delete(n))};function Kt(e){const r=D(e);let n;return r.readyState!=="loading"?ve(e):(n=()=>{ve(e)},r.addEventListener("DOMContentLoaded",n)),()=>Ye(e,n)}typeof document<"u"&&Kt();function ze(){return q!=="pointer"}const Ut=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function qt(e,r,n){let o=D(n==null?void 0:n.target);const a=typeof window<"u"?M(n==null?void 0:n.target).HTMLInputElement:HTMLInputElement,p=typeof window<"u"?M(n==null?void 0:n.target).HTMLTextAreaElement:HTMLTextAreaElement,b=typeof window<"u"?M(n==null?void 0:n.target).HTMLElement:HTMLElement,u=typeof window<"u"?M(n==null?void 0:n.target).KeyboardEvent:KeyboardEvent;return e=e||o.activeElement instanceof a&&!Ut.has(o.activeElement.type)||o.activeElement instanceof p||o.activeElement instanceof b&&o.activeElement.isContentEditable,!(e&&r==="keyboard"&&n instanceof u&&!Vt[n.key])}function Yt(e,r,n){ve(),d.useEffect(()=>{let o=(a,p)=>{qt(!!(n!=null&&n.isTextInput),a,p)&&e(ze())};return xe.add(o),()=>{xe.delete(o)}},r)}function zt(e){let{isDisabled:r,onFocus:n,onBlur:o,onFocusChange:a}=e;const p=d.useCallback(m=>{if(m.target===m.currentTarget)return o&&o(m),a&&a(!1),!0},[o,a]),b=Ge(p),u=d.useCallback(m=>{const g=D(m.target),j=g?ge(g):ge();m.target===m.currentTarget&&j===Ie(m.nativeEvent)&&(n&&n(m),a&&a(!0),b(m))},[a,n,b]);return{focusProps:{onFocus:!r&&(n||a||o)?u:void 0,onBlur:!r&&(o||a)?p:void 0}}}function Xt(e){let{isDisabled:r,onBlurWithin:n,onFocusWithin:o,onFocusWithinChange:a}=e,p=d.useRef({isFocusWithin:!1}),{addGlobalListener:b,removeAllGlobalListeners:u}=Qe(),m=d.useCallback(v=>{v.currentTarget.contains(v.target)&&p.current.isFocusWithin&&!v.currentTarget.contains(v.relatedTarget)&&(p.current.isFocusWithin=!1,u(),n&&n(v),a&&a(!1))},[n,a,p,u]),g=Ge(m),j=d.useCallback(v=>{if(!v.currentTarget.contains(v.target))return;const C=D(v.target),w=ge(C);if(!p.current.isFocusWithin&&w===Ie(v.nativeEvent)){o&&o(v),a&&a(!0),p.current.isFocusWithin=!0,g(v);let S=v.currentTarget;b(C,"focus",x=>{if(p.current.isFocusWithin&&!Re(S,x.target)){let N=new C.defaultView.FocusEvent("blur",{relatedTarget:x.target});Wt(N,S);let P=Ve(N);m(P)}},{capture:!0})}},[o,a,g,b,m]);return r?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:j,onBlur:m}}}let ye=!1,te=0;function Jt(){ye=!0,setTimeout(()=>{ye=!1},50)}function He(e){e.pointerType==="touch"&&Jt()}function Zt(){if(!(typeof document>"u"))return te===0&&typeof PointerEvent<"u"&&document.addEventListener("pointerup",He),te++,()=>{te--,!(te>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",He)}}function er(e){let{onHoverStart:r,onHoverChange:n,onHoverEnd:o,isDisabled:a}=e,[p,b]=d.useState(!1),u=d.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;d.useEffect(Zt,[]);let{addGlobalListener:m,removeAllGlobalListeners:g}=Qe(),{hoverProps:j,triggerHoverEnd:v}=d.useMemo(()=>{let C=(x,N)=>{if(u.pointerType=N,a||N==="touch"||u.isHovered||!x.currentTarget.contains(x.target))return;u.isHovered=!0;let P=x.currentTarget;u.target=P,m(D(x.target),"pointerover",I=>{u.isHovered&&u.target&&!Re(u.target,I.target)&&w(I,I.pointerType)},{capture:!0}),r&&r({type:"hoverstart",target:P,pointerType:N}),n&&n(!0),b(!0)},w=(x,N)=>{let P=u.target;u.pointerType="",u.target=null,!(N==="touch"||!u.isHovered||!P)&&(u.isHovered=!1,g(),o&&o({type:"hoverend",target:P,pointerType:N}),n&&n(!1),b(!1))},S={};return typeof PointerEvent<"u"&&(S.onPointerEnter=x=>{ye&&x.pointerType==="mouse"||C(x,x.pointerType)},S.onPointerLeave=x=>{!a&&x.currentTarget.contains(x.target)&&w(x,x.pointerType)}),{hoverProps:S,triggerHoverEnd:w}},[r,n,o,a,u,m,g]);return d.useEffect(()=>{a&&v({currentTarget:u.target},u.pointerType)},[a]),{hoverProps:j,isHovered:p}}function tr(e={}){let{autoFocus:r=!1,isTextInput:n,within:o}=e,a=d.useRef({isFocused:!1,isFocusVisible:r||ze()}),[p,b]=d.useState(!1),[u,m]=d.useState(()=>a.current.isFocused&&a.current.isFocusVisible),g=d.useCallback(()=>m(a.current.isFocused&&a.current.isFocusVisible),[]),j=d.useCallback(w=>{a.current.isFocused=w,b(w),g()},[g]);Yt(w=>{a.current.isFocusVisible=w,g()},[],{isTextInput:n});let{focusProps:v}=zt({isDisabled:o,onFocusChange:j}),{focusWithinProps:C}=Xt({isDisabled:!o,onFocusWithinChange:j});return{isFocused:p,isFocusVisible:u,focusProps:o?C:v}}function rr(e){let r=e.width/2,n=e.height/2;return{top:e.clientY-n,right:e.clientX+r,bottom:e.clientY+n,left:e.clientX-r}}function nr(e,r){return!(!e||!r||e.right<r.left||e.left>r.right||e.bottom<r.top||e.top>r.bottom)}function sr({disabled:e=!1}={}){let r=d.useRef(null),[n,o]=d.useState(!1),a=Ct(),p=Me(()=>{r.current=null,o(!1),a.dispose()}),b=Me(u=>{if(a.dispose(),r.current===null){r.current=u.currentTarget,o(!0);{let m=St(u.currentTarget);a.addEventListener(m,"pointerup",p,!1),a.addEventListener(m,"pointermove",g=>{if(r.current){let j=rr(g);o(nr(j,r.current.getBoundingClientRect()))}},!1),a.addEventListener(m,"pointercancel",p,!1)}}});return{pressed:n,pressProps:e?{}:{onPointerDown:b,onPointerUp:p,onClick:p}}}let ir="button";function or(e,r){var n;let o=Nt(),{disabled:a=o||!1,autoFocus:p=!1,...b}=e,{isFocusVisible:u,focusProps:m}=tr({autoFocus:p}),{isHovered:g,hoverProps:j}=er({isDisabled:a}),{pressed:v,pressProps:C}=sr({disabled:a}),w=Tt({ref:r,type:(n=b.type)!=null?n:"button",disabled:a||void 0,autoFocus:p},m,j,C),S=_t({disabled:a,hover:g,focus:u,active:v,autofocus:p});return Ft()({ourProps:w,theirProps:b,slot:S,defaultTag:ir,name:"Button"})}let re=Pt(or);function Dr({pr:e,suppliers:r,rfqs:n,purchaseRequest:o,rfq_details:a}){var _e,Ce,Pe;const{toast:p}=ht();d.useEffect(()=>{if(a&&a.length>0){const s={};a.forEach(i=>{s[i.pr_details_id]||(s[i.pr_details_id]=[]),s[i.pr_details_id].includes(i.supplier_id)||s[i.pr_details_id].push(i.supplier_id)}),J(s)}},[a]);const[b,u]=d.useState(""),[m,g]=d.useState(null);d.useRef({});const[j,v]=d.useState(r??[]),[C,w]=d.useState(""),[S,x]=d.useState(1),N=5,[P,I]=d.useState(""),[Xe,W]=d.useState(!1),[Q,Je]=d.useState({title:"",message:"",type:"success"}),[je,se]=d.useState(null),[Y,L]=d.useState(null),[z,X]=d.useState({}),[Ze,O]=d.useState(!1),[$,et]=d.useState(null),[ar,tt]=d.useState(!1),[rt,V]=d.useState(!1),[ie,J]=d.useState({}),[G,K]=d.useState({representative_name:"",company_name:"",address:"",tin_num:""}),[oe,ae]=d.useState(()=>{const s={};return e.details&&e.details.forEach(i=>{s[i.id]=i.unit_price||""}),s}),{data:lr,setData:le}=pt({pr_id:e.id,user_id:((_e=o==null?void 0:o.focal_person)==null?void 0:_e.id)??null,supplier_id:"",selections:[]}),T=({title:s,message:i,type:f,onConfirm:l=null})=>{Je({title:s,message:i,type:f}),se(()=>l),W(!0)},nt=(s,i,f,l)=>{s.preventDefault();const c=l===""?null:l;T({title:"Confirm Submission",message:"Are you sure you want to submit this quoted price?",type:"confirm",onConfirm:()=>de(i,f,c)})},st=(s,i)=>{const f=a.find(l=>l.pr_details_id===s&&l.supplier_id===i);return(f==null?void 0:f.quoted_price)??null},de=(s,i,f,l=null)=>{const c=f===""?null:f,h={pr_id:e.id,pr_details_id:s,supplier_id:i,quoted_price:c},y=l||`${s}-${i}`;L(y),me.post(route("bac_user.submit_quoted"),h,{preserveScroll:!0,onSuccess:()=>{L(null),l&&ue(_=>{const F={..._};return delete F[l],F}),T({title:"Submitted!",message:"Quoted price submitted successfully.",type:"success"})},onError:_=>{L(null),T({title:"Oops!",message:(_==null?void 0:_.quoted_price)||"Something went wrong while submitting.",type:"error"})}})},it=()=>{T({title:"Confirm Bulk Submission",message:"Are you sure you want to submit all quoted prices?",type:"confirm",onConfirm:()=>ot()})},ot=()=>{if(!m)return;const s=e.details.map(i=>{const f=`${i.id}-${m}`,l=z[f],c=l===""?null:l;return l!==void 0?{pr_id:e.id,pr_details_id:i.id,supplier_id:m,quoted_price:c}:null}).filter(i=>i!==null);if(s.length===0){T({title:"No Prices to Submit",message:"Please enter at least one quoted price before submitting all.",type:"warning"});return}L("all"),me.post(route("bac_user.submit_bulk_quoted"),{quotes:s},{preserveScroll:!0,onSuccess:()=>{console.log("Bulk submitted successfully"),X(i=>{const f={...i};return s.forEach(l=>{delete f[`${l.pr_details_id}-${l.supplier_id}`]}),f}),L(null),T({title:"All Quoted Prices Submitted!",message:"All prices for this supplier have been submitted successfully.",type:"success"})},onError:i=>{console.error("Bulk submission failed",i),L(null),T({title:"Oops!",message:(i==null?void 0:i.quoted_price)||"Something went wrong while submitting all prices.",type:"error"})}})},Z=(s,i,f)=>{le(l=>{const c=(l.selections||[]).filter(h=>!(h.pr_detail_id===s&&h.supplier_id===i));return{...l,selections:[...c,{pr_detail_id:s,supplier_id:i,estimated_bid:f}]}})},at=s=>{et(s),tt(!1),O(!0);const i=e.details.find(f=>f.id===s);if(i){const f=i.unit_price||"";ae(l=>({...l,[s]:f})),le(l=>({...l,estimated_bid:f}))}},{flash:k}=mt().props,lt=async s=>{var i,f;s.preventDefault();try{const c=(await gt.post(route("bac_user.store_supplier"),G)).data.supplier;v(F=>[...F,c]),w(String(c.id));const h=c.id,_=($===null?"":oe[$]||"").toString().trim()||((f=(i=e.details)==null?void 0:i.find(F=>F.id===$))==null?void 0:f.unit_price)||"";$!==null?Z($,h,_):e.details.forEach(F=>{const E=F.unit_price||"";Z(F.id,h,E)}),K({company_name:"",address:"",tin_num:"",representative_name:""}),V(!1),O(!1)}catch(l){l.response?console.error("Server error:",l.response.data):console.error("Error adding supplier:",l.message),ee.fire("Error","Failed to add supplier. Please try again.","error")}};$&&((Ce=e.details)!=null&&Ce.length)&&e.details.find(s=>s.id===$);const Ee=j.filter(s=>{var f,l,c;if(!P)return!0;const i=P.toLowerCase();return((f=s.representative_name)==null?void 0:f.toLowerCase().includes(i))||((l=s.company_name)==null?void 0:l.toLowerCase().includes(i))||((c=s.address)==null?void 0:c.toLowerCase().includes(i))}).filter(s=>!a.some(i=>i.pr_details_id===$&&i.supplier_id===s.id));d.useEffect(()=>{x(1)},[P]);const ce=Math.ceil(Ee.length/N),Se=S*N,dt=Se-N,Ne=Ee.slice(dt,Se),[B,ue]=d.useState({}),ct=(s,i,f)=>{L(f),me.delete(route("bac_user.delete_quoted"),{data:{pr_id:e.id,pr_details_id:s,supplier_id:i},preserveScroll:!0,onSuccess:()=>{L(null),X(l=>{const c={...l};return delete c[f],c}),ue(l=>{const c={...l};return delete c[f],c}),J(l=>{const c={...l};return Array.isArray(c[s])&&(c[s]=c[s].filter(h=>h!==i),c[s].length===0&&delete c[s]),c}),p({title:"Deleted",description:"Quoted price removed successfully.",variant:"default",setTimeout:3e3}),T({title:"Deleted!"})},onFinish:l=>{L(null),k!=null&&k.message&&(p({title:k.status==="success"?"Deleted":"Error",description:k.message,variant:k.status==="success"?"default":"destructive",setTimeout:3e3}),T({title:k.status==="success"?"Deleted!":"Error!",description:k.message}))},onError:()=>{L(null),p({title:"Error",description:"Could not delete quoted price.",variant:"destructive",setTimeout:3e3}),T({title:"Error!"})}})},[ut,fe]=d.useState(!1),[dr,ft]=d.useState([]);return t.jsxs(xt,{children:[t.jsx(bt,{title:"Enter Quoted Prices"}),t.jsxs("div",{className:"mx-auto px-6 py-10",children:[t.jsx("div",{className:"mb-8",children:t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx(vt,{className:"w-8 h-8 text-indigo-700"}),"Enter Quoted Prices for PR: ",e.pr_number]})}),t.jsx("div",{className:"mb-4",children:t.jsx("a",{type:"button",href:route("bac_user.for_quotations"),className:"inline-flex items-center px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"â† Back"})}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2 border-b pb-2",children:[t.jsx(yt,{className:"w-5 h-5 text-indigo-600"}),"Purchase Request Info"]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"PR Number:"})," ",e.pr_number]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Purpose:"})," ",e.purpose]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Requested By:"})," ",e.requester_name]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Division:"})," ",e.division]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Created:"})," ",new Date(e.created_at).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Focal Person:"})," ",(Pe=o==null?void 0:o.focal_person)==null?void 0:Pe.firstname]})]})]}),t.jsxs("div",{className:"xl:col-span-2 space-y-10",children:[e.details.map(s=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow",children:[t.jsxs("div",{className:"mb-4 border-b pb-3",children:[t.jsxs("h3",{className:"text-xl font-semibold text-gray-700",children:[s.item,t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",s.specs,")"]})]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-2 grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Unit:"})," ",s.unit]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Quantity:"})," ",s.quantity]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Est. Price per Unit:"})," â‚±",Number(s.unit_price||0).toLocaleString()]})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>at(s.id),className:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-sm shadow-sm",children:"Choose Supplier"}),t.jsx("button",{onClick:()=>V(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md text-sm shadow-sm",children:"âž• Add New Supplier"})]}),t.jsx("div",{className:"space-y-6 mt-6",children:Array.isArray(ie[s.id])&&ie[s.id].map(i=>{const f=j.find(E=>E.id===i);if(!f)return null;const l=`${s.id}-${i}`,c=Y===l,h=st(s.id,i),y=h!==null,_=s.unit_price||0,F=E=>{let A=parseFloat(E.target.value);isNaN(A)&&(A=""),A>_&&ee.fire({icon:"info",title:"Notice",text:`Quoted price is higher than the estimated â‚±${_.toLocaleString()}.`,timer:2e3,showConfirmButton:!1}),X(pe=>({...pe,[l]:A}))};return t.jsxs("form",{onSubmit:E=>{E.preventDefault();const A=z[l]??"",pe=!!B[l];y&&pe?de(s.id,i,A,l):nt(E,s.id,i,A)},className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center mt-4",children:[t.jsxs("div",{className:"md:col-span-4",children:[t.jsx("p",{className:"font-medium text-gray-800",children:f.representative_name}),t.jsx("p",{className:"text-xs text-gray-500",children:f.company_name})]}),t.jsxs("div",{className:"md:col-span-5 relative",children:[t.jsx("input",{type:"number",step:"0.01",placeholder:"â‚± Quoted Price",disabled:y&&!B[l],value:y&&!B[l]?parseFloat(h).toFixed(2):z[l]||"",onWheel:E=>E.currentTarget.blur(),onChange:F,className:`w-full border rounded-md px-4 py-2 text-sm shadow-sm ${y&&!B[l]?"bg-gray-100 border-gray-300 text-gray-500":"border-gray-300 focus:ring-2 focus:ring-indigo-500"}`}),y&&!B[l]&&t.jsx("span",{className:"absolute top-1/2 right-3 -translate-y-1/2 text-xs font-medium text-green-600",children:"Already submitted"})]}),t.jsx("div",{className:"md:col-span-3 flex gap-2",children:y&&!B[l]?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:()=>{ue(E=>({...E,[l]:!0})),X(E=>({...E,[l]:h}))},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-yellow-500 hover:bg-yellow-600 text-white",children:t.jsx(wt,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",disabled:c,onClick:()=>{T({title:"Confirm Delete",message:"Are you sure you want to delete this quoted price?",type:"confirm",onConfirm:()=>ct(s.id,i,l)})},className:"w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md bg-red-600 hover:bg-red-700 text-white",children:t.jsx($t,{className:"w-4 h-4"})})]}):y?t.jsx("button",{type:"button",disabled:c,onClick:()=>de(s.id,i,z[l]??"",l),className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${c?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(jt,{className:"w-4 h-4"})}):t.jsx("button",{type:"submit",disabled:c,className:`w-14 flex justify-center items-center gap-2 py-2 px-4 font-medium text-sm rounded-md ${c?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700 text-white"}`,children:t.jsx(Et,{className:"w-4 h-4"})})})]},l)})})]},s.id)),m&&t.jsx("div",{className:"mt-6 text-right",children:t.jsx("button",{onClick:it,disabled:Y==="all",className:`inline-flex items-center gap-2 px-6 py-2 text-white text-sm font-semibold rounded-md shadow-sm transition ${Y==="all"?"bg-gray-400 cursor-wait":"bg-green-600 hover:bg-green-700"}`,children:Y==="all"?"Submitting All...":"Submit Entire PR Quotes"})})]})]})]}),Ze&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:t.jsxs("div",{className:"relative w-full max-w-7xl p-6 bg-white/90 backdrop-blur-lg rounded-2xl shadow-2xl border border-gray-200",children:[t.jsx("button",{onClick:()=>O(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 transition-colors","aria-label":"Close modal",children:"âœ•"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Select a Supplier"}),t.jsx("div",{className:"flex justify-between items-center mb-5 gap-3",children:t.jsx("input",{type:"text",placeholder:"ðŸ” Filter suppliers...",value:P,onChange:s=>{I(s.target.value),x(1)},className:"w-full max-w-xs border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})}),t.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto rounded-lg border border-gray-200",children:t.jsxs("table",{className:"min-w-full text-sm text-gray-700",children:[t.jsx("thead",{className:"bg-gray-100 text-gray-600 uppercase text-xs tracking-wide",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"ID"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Name"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Company"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Address"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"TIN"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Action"})]})}),t.jsx("tbody",{children:Ne.length>0?Ne.map(s=>t.jsxs("tr",{className:"hover:bg-indigo-50 transition-colors",children:[t.jsx("td",{className:"py-3 px-4",children:s.id}),t.jsx("td",{className:"py-3 px-4",children:s.representative_name}),t.jsx("td",{className:"py-3 px-4",children:s.company_name}),t.jsx("td",{className:"py-3 px-4",children:s.address}),t.jsx("td",{className:"py-3 px-4",children:s.tin_num}),t.jsxs("td",{className:"py-3 px-4 space-x-2 text-nowrap",children:[t.jsx("button",{disabled:a.some(i=>i.pr_details_id===$&&i.supplier_id===s.id),onClick:()=>{var l,c;const f=($===null?"":oe[$]||"").toString().trim()||((c=(l=e.details)==null?void 0:l.find(h=>h.id===$))==null?void 0:c.unit_price)||"";Z($,s.id,f),ae(h=>({...h,[$]:f})),J(h=>{const y=h[$]||[];return y.includes(s.id)?h:{...h,[$]:[...y,s.id]}}),w(String(s.id)),O(!1)},className:"text-sm bg-indigo-600 text-white hover:bg-indigo-700 px-3 py-1 rounded-lg shadow disabled:opacity-50 disabled:cursor-not-allowed",children:"Select"}),t.jsx("button",{onClick:()=>{const i={...ie},f={...oe},l=[];e.details.forEach(c=>{if(a.some(y=>y.pr_details_id===c.id&&y.supplier_id===s.id))l.push(c.item_description||`Item #${c.id}`);else{const y=c.unit_price||"";f[c.id]=y,Z(c.id,s.id,y);const _=i[c.id]||[];_.includes(s.id)||(i[c.id]=[..._,s.id])}}),ae(f),J(i),w(String(s.id)),g(s.id),O(!1),l.length>0&&(ft(l),fe(!0))},className:"text-sm bg-green-600 text-white hover:bg-green-700 px-3 py-1 rounded-lg shadow",children:"Apply to Entire PR"})]})]},s.id)):t.jsx("tr",{children:t.jsxs("td",{colSpan:"7",className:"text-center py-6 text-gray-400 italic",children:["No suppliers available for this"," "]})})})]})}),t.jsxs("div",{className:"mt-6 border-t pt-4 flex justify-between items-center",children:[t.jsx("button",{onClick:()=>V(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg text-sm shadow-sm",children:"âž• Add New Supplier"}),t.jsx("button",{onClick:()=>{if(!C){ee.fire("Oops!","Please select a supplier first.","warning");return}le("supplier_id",C),O(!1),ee.fire("Saved!","Supplier has been selected.","success")},className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm shadow-sm",children:"Confirm Selection"})]}),t.jsxs("div",{className:"flex justify-between items-center mt-4",children:[t.jsx("button",{onClick:()=>x(s=>Math.max(s-1,1)),disabled:S===1,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"â† Prev"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",S," of ",ce]}),t.jsx("button",{onClick:()=>x(s=>Math.min(s+1,ce)),disabled:S===ce,className:"px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50",children:"Next â†’"})]})]})}),rt&&t.jsx("div",{className:"fixed inset-0 z-[999] bg-black bg-opacity-50 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative",children:[t.jsx("button",{onClick:()=>V(!1),className:"absolute top-2 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold","aria-label":"Close add supplier modal",children:"Ã—"}),t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Supplier"}),t.jsxs("form",{onSubmit:lt,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Representative Name"}),t.jsx("input",{type:"text",required:!0,value:G.representative_name,onChange:s=>K(i=>({...i,representative_name:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),t.jsx("input",{type:"text",required:!0,value:G.company_name,onChange:s=>K(i=>({...i,company_name:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),t.jsx("input",{type:"text",required:!0,value:G.address,onChange:s=>K(i=>({...i,address:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TIN Number"}),t.jsx("input",{type:"text",required:!0,value:G.tin_num,onChange:s=>K(i=>({...i,tin_num:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800",children:"Add Supplier"})]})]})]})}),t.jsx(Te,{open:Xe,onOpenChange:W,children:t.jsxs(Fe,{children:[t.jsxs(Le,{children:[t.jsx(ke,{className:Q.type==="error"?"text-red-600":Q.type==="success"?"text-green-600":"",children:Q.title}),t.jsx(De,{children:Q.message})]}),t.jsx(Ae,{children:Q.type==="confirm"?t.jsxs(t.Fragment,{children:[t.jsx(re,{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md",onClick:()=>{W(!1),se(null)},children:"Cancel"}),t.jsx(re,{className:"px-4 py-2 bg-green-600 text-white rounded-md",onClick:()=>{typeof je=="function"&&je(),W(!1),se(null)},children:"Confirm"})]}):t.jsx(re,{className:"px-4 py-2 bg-blue-600 text-white rounded-md",onClick:()=>W(!1),children:"Close"})})]})}),t.jsx(Te,{open:ut,onOpenChange:fe,children:t.jsxs(Fe,{children:[t.jsxs(Le,{children:[t.jsx(ke,{children:"Some Items Skipped"}),t.jsx(De,{children:"This supplier already quoted for some items, so they were skipped:"})]}),t.jsx(Ae,{className:"mt-4",children:t.jsx(re,{onClick:()=>fe(!1),children:"OK"})})]})})]})}export{Dr as default};
