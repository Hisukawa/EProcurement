import{v as y,r as b,j as e,$ as j}from"./app-CdT6Inq3.js";import{S as v}from"./SupplyOfficerLayout-BNaN16r7.js";import"./toaster-CuJZEvbt.js";import"./index-BMneL5eD.js";import"./index-10TgiLhN.js";import"./index-BiygnIGx.js";import"./Dropdown-C0LNKoiI.js";import"./transition-CK0hpB_q.js";import"./XMarkIcon-BoC-vdCd.js";import"./clipboard-check-DmtwyTCG.js";function A({purchaseRequests:n,filters:o}){const{data:i,setData:c,get:d}=y({search:o.search||"",division:o.division||""});return b.useEffect(()=>{const t=setTimeout(()=>{d(route("supply_officer.purchase_orders"),{preserveState:!0,replace:!0})},300);return()=>clearTimeout(t)},[i.search,i.division]),e.jsxs(v,{header:"Schools Division Office - Ilagan | Create Purchase Order",children:[e.jsx(j,{title:"Purchase Order"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Purchase Requests with Selected Suppliers"}),e.jsxs("form",{onSubmit:t=>t.preventDefault(),className:"flex flex-wrap items-center gap-3",children:[e.jsx("input",{type:"text",name:"search",placeholder:"Search PR number or focal person",className:"w-96 border border-gray-300 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:i.search,onChange:t=>c("search",t.target.value)}),e.jsxs("select",{value:i.division,onChange:t=>c("division",t.target.value),className:"border border-gray-300 px-10 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Divisions"}),o.divisions.map(t=>e.jsx("option",{value:t.id,children:t.division},t.id))]})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"w-full table-auto text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["PR Number","Focal Person","Division","Item","Specs","Quantity","Unit","Winner Supplier","Quoted Price","Actions"].map(t=>e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wide text-center whitespace-nowrap",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-center",children:n.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"py-12 text-gray-500 text-lg font-medium",children:"No Purchase Requests with winners found."})}):n.data.map(t=>{var m,u,x,h,g;const s=t.details.filter(r=>{var a;return(a=t.rfqs)==null?void 0:a.flatMap(l=>l.details).some(l=>l.pr_details_id===r.id&&l.is_winner)});if(s.length===0)return null;const p=(m=t.rfqs)==null?void 0:m.flatMap(r=>r.details??[]).filter(r=>s.some(a=>a.id===r.pr_details_id)&&r.is_winner),f=p.reduce((r,a)=>r+parseFloat(a.quoted_price||0),0);return e.jsxs("tr",{className:"hover:bg-blue-50 transition duration-200",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-blue-700 whitespace-nowrap",children:t.pr_number}),e.jsxs("td",{className:"px-6 py-4",children:[t.focal_person.firstname," ",t.focal_person.lastname]}),e.jsx("td",{className:"px-6 py-4",children:t.division.division}),e.jsxs("td",{className:"px-6 py-4",children:[((u=s[0])==null?void 0:u.product.name)||"—",s.length>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((x=s[0])==null?void 0:x.product.specs)||"—",s.length>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((h=s[0])==null?void 0:h.quantity)||"—",new Set(s.map(r=>r.quantity)).size>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[((g=s[0])==null?void 0:g.product.unit.unit)||"—",new Set(s.map(r=>r.product.unit.unit)).size>1&&e.jsxs("span",{className:"text-gray-400 text-xs ml-1 italic",children:["+",s.length-1," more"]})]}),e.jsx("td",{className:"px-6 py-4",children:[...new Set(p.map(r=>{var a;return((a=r.supplier)==null?void 0:a.company_name)||"N/A"}))].join(", ")}),e.jsxs("td",{className:"px-6 py-4",children:["₱ ",f.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsx("a",{href:route("supply_officer.create_po",t.id),className:`inline-block px-4 py-2 text-sm font-medium rounded-md transition ${t.has_po?"bg-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,onClick:r=>t.has_po&&r.preventDefault(),children:t.has_po?"PO Generated":"Purchase Order"})})]},`pr-${t.id}`)})})]})}),e.jsx("div",{className:"mt-6 flex justify-center flex-wrap gap-1",children:n.links.map((t,s)=>e.jsx("button",{disabled:!t.url,onClick:()=>t.url&&d(t.url,{data:i,preserveState:!0,preserveScroll:!0}),className:`px-3 py-1 text-sm border rounded-md ${t.active?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,dangerouslySetInnerHTML:{__html:t.label}},s))})]})}export{A as default};
